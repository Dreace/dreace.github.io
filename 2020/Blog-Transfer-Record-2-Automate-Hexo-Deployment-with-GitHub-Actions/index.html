<!DOCTYPE html>
<html>

<head>
  
  <title>博客迁移日志其二 使用 Github Actions 自动部署 Hexo - DreaceのBlog</title>
  <meta charset="UTF-8">
  <meta name="description" content="一条咸鱼的垂死挣扎">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  

  <link rel="shortcut icon" href="/favicon-32x32.png" type="image/png" />
  <meta name="description" content="上一篇博客博客迁移日志其一 从 WordPress 到 Hexo中已经完成将 WordPress 中的数据迁移到 Hexo，但是每次修改内容后都要手动生成静态网页然后同步到服务器，这些步骤还是很繁琐的。因此需要一个自动化的流程来帮助部署博客，GitHub Actions 可以很好的满足这个需求。">
<meta property="og:type" content="article">
<meta property="og:title" content="博客迁移日志其二 使用 Github Actions 自动部署 Hexo">
<meta property="og:url" content="https://blog.dreace.top/2020/Blog-Transfer-Record-2-Automate-Hexo-Deployment-with-GitHub-Actions/index.html">
<meta property="og:site_name" content="DreaceのBlog">
<meta property="og:description" content="上一篇博客博客迁移日志其一 从 WordPress 到 Hexo中已经完成将 WordPress 中的数据迁移到 Hexo，但是每次修改内容后都要手动生成静态网页然后同步到服务器，这些步骤还是很繁琐的。因此需要一个自动化的流程来帮助部署博客，GitHub Actions 可以很好的满足这个需求。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog.dreace.top/images/Blog-Transfer-Record-2-Automate-Hexo-Deployment-with-GitHub-Actions/image-20200110155500166.png">
<meta property="og:image" content="https://blog.dreace.top/images/Blog-Transfer-Record-2-Automate-Hexo-Deployment-with-GitHub-Actions/image-20200110155919909.png">
<meta property="og:image" content="https://blog.dreace.top/images/Blog-Transfer-Record-2-Automate-Hexo-Deployment-with-GitHub-Actions/image-20200110161901448.png">
<meta property="article:published_time" content="2020-01-10T05:59:18.000Z">
<meta property="article:modified_time" content="2022-02-13T12:31:19.799Z">
<meta property="article:author" content="Dreace">
<meta property="article:tag" content="Hexo">
<meta property="article:tag" content="Github Actions">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.dreace.top/images/Blog-Transfer-Record-2-Automate-Hexo-Deployment-with-GitHub-Actions/image-20200110155500166.png">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdui@0.4.3/dist/css/mdui.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.0.2/styles/github.css">
  
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1038733_0xvrvpg9c0r.css">
  <link rel="stylesheet" href="/css/style.css?v=1644755527918">
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="DreaceのBlog" type="application/atom+xml">
</head>

<body class="mdui-drawer-body-left">
  
  <div id="nexmoe-background">
    <div class="nexmoe-bg" style="background-image: url()"></div>
    <div class="mdui-appbar mdui-shadow-0">
      <div class="mdui-toolbar">
        <a mdui-drawer="{target: '#drawer', swipe: true}" title="menu" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">menu</i></a>
        <div class="mdui-toolbar-spacer"></div>
        <!--<a href="javascript:;" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">search</i></a>-->
        <a href="/" title="Dreace" class="mdui-btn mdui-btn-icon"><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="/images/avatar.png"></a>
       </div>
    </div>
  </div>
  <div id="nexmoe-header">
      <div class="nexmoe-drawer mdui-drawer" id="drawer">
    <div class="nexmoe-avatar mdui-ripple">
        <a href="/" title="Dreace">
            <img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="/images/avatar.png" alt="Dreace">
        </a>
    </div>
    <div class="nexmoe-count">
        <div><span>文章</span>24</div>
        <div><span>标签</span>48</div>
        <div><span>分类</span>14</div>
    </div>
    <ul class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}">
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/friends.html" title="我的朋友">
            <i class="mdui-list-item-icon nexmoefont icon-unorderedlist"></i>
            <div class="mdui-list-item-content">
                我的朋友
            </div>
        </a>
        
    </ul>
    <aside id="nexmoe-sidebar">
  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">文章目录</h3>
    <div class="nexmoe-widget">
      <div id="toc" class="toc-article">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#配置目标服务器"><span class="toc-number">1.</span> <span class="toc-text">配置目标服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#x01-安装-git1"><span class="toc-number">1.1.</span> <span class="toc-text">0x01 安装 Git1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#x02-创建新用户"><span class="toc-number">1.2.</span> <span class="toc-text">0x02 创建新用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#x03-生成-ssh-密钥2"><span class="toc-number">1.3.</span> <span class="toc-text">0x03 生成 SSH 密钥2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#x04-复制-ssh-密钥"><span class="toc-number">1.4.</span> <span class="toc-text">0x04 复制 SSH 密钥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#x05-创建裸仓库"><span class="toc-number">1.5.</span> <span class="toc-text">0x05 创建裸仓库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#x06-创建存放静态网页目录"><span class="toc-number">1.6.</span> <span class="toc-text">0x06 创建存放静态网页目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#x07-配置-git-钩子"><span class="toc-number">1.7.</span> <span class="toc-text">0x07 配置 Git 钩子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#x08-更改仓库目录所有者"><span class="toc-number">1.8.</span> <span class="toc-text">0x08 更改仓库目录所有者</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#x09-禁止-git-用户登录-shell"><span class="toc-number">1.9.</span> <span class="toc-text">0x09 禁止 git 用户登录 shell</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置-github-actions"><span class="toc-number">2.</span> <span class="toc-text">配置 GitHub Actions</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#x01-添加私钥到-github-仓库"><span class="toc-number">2.1.</span> <span class="toc-text">0x01 添加私钥到 GitHub 仓库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#x02-添加-github-actions"><span class="toc-number">2.2.</span> <span class="toc-text">0x02 添加 GitHub Actions</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置-hexo"><span class="toc-number">3.</span> <span class="toc-text">配置 Hexo</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置-nginx"><span class="toc-number">4.</span> <span class="toc-text">配置 Nginx</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#测试"><span class="toc-number">5.</span> <span class="toc-text">测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#最后"><span class="toc-number">6.</span> <span class="toc-text">最后</span></a></li></ol>
      </div>
    </div>
  </div>


  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">联系我</h3>
    <div class="nexmoe-widget nexmoe-social">
        <a class="mdui-ripple" href="https://space.bilibili.com/7686754" target="_blank" mdui-tooltip="{content: '哔哩哔哩'}" style="color: rgb(231, 106, 141);background-color: rgba(231, 106, 141, .15);">
            <i class="nexmoefont icon-bilibili"></i>
        </a><a class="mdui-ripple" href="https://github.com/Dreace" target="_blank" mdui-tooltip="{content: 'GitHub'}" style="color: rgb(25, 23, 23);background-color: rgba(25, 23, 23, .15);">
            <i class="nexmoefont icon-github"></i>
        </a><a class="mdui-ripple" href="https://www.zhihu.com/people/dreace" target="_blank" mdui-tooltip="{content: '知乎'}" style="color: rgb(30, 136, 229);background-color: rgba(30, 136, 229, .15);">
            <i class="nexmoefont icon-zhihu"></i>
        </a><a class="mdui-ripple" href="https://steamcommunity.com/id/Dreace_Dreace/" target="_blank" mdui-tooltip="{content: 'Steam'}" style="color: rgb(37, 116, 196);background-color: rgba(37, 116, 196, .15);">
            <i class="nexmoefont icon-steam"></i>
        </a>
    </div>
</div>
  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">文章分类</h3>
    <div class="nexmoe-widget">

      <ul class="category-list">

        


        

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/C-C/">C/C++</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Docker/">Docker</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Hexo/">Hexo</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Linux/">Linux</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/MySQL/">MySQL</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Python/">Python</a>
          <span class="category-list-count">4</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/TypeScript/">TypeScript</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Vue-js/">Vue.js</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Windows/">Windows</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/建设日志/">建设日志</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/指南/">指南</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/算法/">算法</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/装机/">装机</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/面经/">面经</a>
          <span class="category-list-count">4</span>
        </li>

        
      </ul>

    </div>
  </div>


  
</aside>
    <div class="nexmoe-copyright">
        &copy; 2019 - 2022 Dreace<br>
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
        & <a href="https://nexmoe.com/hexo-theme-nexmoe.html" target="_blank">Nexmoe</a>
    </div>
</div><!-- .nexmoe-drawer -->
  </div>
  <div id="nexmoe-content">
    <div class="nexmoe-primary">
        <div class="nexmoe-post">
    <div class="nexmoe-post-cover"> 

        <h1>博客迁移日志其二 使用 Github Actions 自动部署 Hexo</h1>
    </div>
  <div class="nexmoe-post-meta">
    <a><i class="nexmoefont icon-calendar-fill"></i>2020年01月10日</a>
    <a><i class="nexmoefont icon-areachart"></i>1.2k 字</a>
    <a><i class="nexmoefont icon-time-circle-fill"></i>大概 6 分钟</a>
    
      <a class="nexmoefont icon-appstore-fill -link" href="/categories/%E5%BB%BA%E8%AE%BE%E6%97%A5%E5%BF%97/">建设日志</a>
    
    
      <a class="nexmoefont icon-tag-fill -link" href="/tags/Github-Actions/" rel="tag">Github Actions</a> <a class="nexmoefont icon-tag-fill -link" href="/tags/Hexo/" rel="tag">Hexo</a>
    
  </div>
  <article>
    <p>上一篇博客<a href="/2019/Blog-Transfer-Record-1-From-WordPress-to-Hexo/" title="博客迁移日志其一 从 WordPress 到 Hexo">博客迁移日志其一 从 WordPress 到 Hexo</a>中已经完成将 WordPress 中的数据迁移到 Hexo，但是每次修改内容后都要手动生成静态网页然后同步到服务器，这些步骤还是很繁琐的。因此需要一个自动化的流程来帮助部署博客，<a href="https://github.com/features/actions" target="_blank" rel="noopener">GitHub Actions</a> 可以很好的满足这个需求。</p>
<a id="more"></a>
<h2 id="配置目标服务器">配置目标服务器</h2>
<p>在开始前需要在部署 Hexo 的服务器新建一个空的 Git 仓库，以及设置通过私钥登录。以下使用的命令以 CentOS 为例，其他 Linux 版本同理。</p>
<h3 id="x01-安装-git1">0x01 安装 Git<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></h3>
<p>直接安装：</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">sudo</span> yum install git</span></code></pre></div>
<h3 id="x02-创建新用户">0x02 创建新用户</h3>
<p>为了控制权限，可新建立一个名为 git 的用户：</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">sudo</span> adduser git</span></code></pre></div>
<h3 id="x03-生成-ssh-密钥2">0x03 生成 SSH 密钥<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></h3>
<p>SSH 密钥用于部署时免密登录。使用 <code>ssh-keygen</code> 生成密钥，注意将 <code>your_email@example.com</code> 替换成自己的邮箱。</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">ssh-keygen</span> -t rsa -b 4096 -C <span class="st">&quot;your_email@example.com&quot;</span></span></code></pre></div>
<p>询问存放位置：</p>
<pre><code>Enter file in which to save the key (/root/.ssh/id_rsa): </code></pre>
<p>直接回车使用默认设置即可（<code>/root/.ssh/id_rsa</code>）。</p>
<p>提示输入密码：</p>
<pre><code>Enter passphrase (empty for no passphrase): 
Enter same passphrase again: </code></pre>
<p>输入一个密码并重复，直接回车表示密码留空。</p>
<h3 id="x04-复制-ssh-密钥">0x04 复制 SSH 密钥</h3>
<p>将 <code>~/.ssh/id_rsa.pub</code> 中的内容添加到 <code>/home/git/.ssh/authorized_keys</code> 中，若该文件不存在可以手动创建。</p>
<h3 id="x05-创建裸仓库">0x05 创建裸仓库</h3>
<p>在 <code>/var/repo</code> 新建名为 <code>blog.git</code> 的仓库：</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">sudo</span> mkdir /var/repo</span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="bu">cd</span> /var/repo</span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="fu">sudo</span> git init --bare blog.git</span></code></pre></div>
<p>裸仓库没有工作区，只是为了共享。</p>
<h3 id="x06-创建存放静态网页目录">0x06 创建存放静态网页目录</h3>
<p>创建目录：</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1"></a><span class="bu">cd</span> /var/</span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="fu">sudo</span> mkdir www</span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="bu">cd</span> www</span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="fu">sudo</span> mkdir html</span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="bu">cd</span> html</span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="fu">sudo</span> mkdir hexo</span></code></pre></div>
<p>以后生成的文件将存放在 <code>/var/www/html/hexo</code> 下。</p>
<p>更改权限：</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1"></a><span class="bu">cd</span> /var/</span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="fu">sudo</span> chmod -R 777 www</span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="bu">cd</span> www</span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="fu">sudo</span> chmod -R 777 html</span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="bu">cd</span> html</span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="fu">sudo</span> chmod -R 777 hexo</span></code></pre></div>
<h3 id="x07-配置-git-钩子">0x07 配置 Git 钩子</h3>
<p>进入 <code>/var/repo/blog.git/hooks</code>，创建编辑 <code>post-receive</code> 文件：</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1"></a><span class="bu">cd</span> /var/repo/blog.git/hooks</span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="fu">sudo</span> vim post-receive</span></code></pre></div>
<p>在 <code>post-receive</code> 写入：</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1"></a><span class="fu">git</span> --work-tree=/var/www/html/hexo --git-dir=/var/repo/blog.git checkout -f</span></code></pre></div>
<p>表示每次 <code>push</code> 是文件将存放在 <code>/var/www/html/hexo</code> 下。</p>
<p>保存后赋予 <code>post-receive</code> 可执行权限：</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1"></a><span class="fu">chmod</span> +x post-receive</span></code></pre></div>
<h3 id="x08-更改仓库目录所有者">0x08 更改仓库目录所有者</h3>
<p>将 <code>blog.git</code> 目录的所有者更改为 git 用户：</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1"></a><span class="fu">sudo</span> chown -R git:git blog.git</span></code></pre></div>
<h3 id="x09-禁止-git-用户登录-shell">0x09 禁止 git 用户登录 shell</h3>
<p>编辑 <code>/etc/passwd</code>，找到</p>
<pre><code>git:x:1001:1001:git,,,:/home/git:/bin/bash</code></pre>
<p>修改为：</p>
<pre><code>git:x:1001:1001:,,,:/home/git:/usr/bin/git-shell</code></pre>
<p>这样 git 用户可以通过 SSH 使用 git，但不能使用 shell。</p>
<h2 id="配置-github-actions">配置 GitHub Actions</h2>
<h3 id="x01-添加私钥到-github-仓库">0x01 添加私钥到 GitHub 仓库</h3>
<p>如果存放 Hexo 源文件的仓库是公开的，为了不暴露私钥需要将之前生成的私钥保存到 <code>Secrets</code> 当中，需要时通过环境变量访问。</p>
<figure>
<img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="/images/Blog-Transfer-Record-2-Automate-Hexo-Deployment-with-GitHub-Actions/image-20200110155500166.png" alt><figcaption>添加 Secrets</figcaption>
</figure>
<p><code>Name</code> 填写为 <code>id_rsa</code>， <code>Value</code> 中填写之前生成的 <code>id_rsa</code> 文件中的内容，形如：</p>
<pre><code>-----BEGIN RSA PRIVATE KEY-----
MIIJKQIBAAKCAgEAq0XtV523Wcgs/2DqFAxqicbHb4x0tvwt/mNe7pKBCLzkL551
DyCHEYVoOVUbO3Fu80h5M7Ku4+ojWSZpCXwqabObTn1tTNUrubWi2OIfkqnzGn+T
...
6FEmudj4Bb1+GZPu7muNWYamydlCK8D7cAu6I/iRyC0ya5j9wDZpYXYr2fRzd4Hf
rsTNxNy45COZWr7IBbrb0+WBXlXwTrSx+XioRxEyukk1U79aIk3uvSP6C/4F
-----END RSA PRIVATE KEY-----</code></pre>
<h3 id="x02-添加-github-actions">0x02 添加 GitHub Actions</h3>
<p>首先创建一个新的配置文件：</p>
<figure>
<img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="/images/Blog-Transfer-Record-2-Automate-Hexo-Deployment-with-GitHub-Actions/image-20200110155919909.png" alt><figcaption>新建配置文件</figcaption>
</figure>
<p>写入<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>：</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb16-1"><a href="#cb16-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> Node CI</span></span>
<span id="cb16-2"><a href="#cb16-2"></a></span>
<span id="cb16-3"><a href="#cb16-3"></a><span class="fu">on</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">push</span><span class="kw">]</span></span>
<span id="cb16-4"><a href="#cb16-4"></a></span>
<span id="cb16-5"><a href="#cb16-5"></a><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb16-6"><a href="#cb16-6"></a><span class="at">  </span><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb16-7"><a href="#cb16-7"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span>
<span id="cb16-8"><a href="#cb16-8"></a><span class="at">    </span><span class="fu">strategy</span><span class="kw">:</span></span>
<span id="cb16-9"><a href="#cb16-9"></a><span class="at">      </span><span class="fu">matrix</span><span class="kw">:</span></span>
<span id="cb16-10"><a href="#cb16-10"></a><span class="at">        </span><span class="fu">node-version</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">10.x</span><span class="kw">]</span></span>
<span id="cb16-11"><a href="#cb16-11"></a></span>
<span id="cb16-12"><a href="#cb16-12"></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb16-13"><a href="#cb16-13"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v1</span></span>
<span id="cb16-14"><a href="#cb16-14"></a><span class="kw">      - </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Use Node.js $&lt;!--￼1--</span><span class="ch">&gt;</span></span>
<span id="cb16-15"><a href="#cb16-15"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/setup-node@v1</span></span>
<span id="cb16-16"><a href="#cb16-16"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb16-17"><a href="#cb16-17"></a><span class="fu">          node-version</span><span class="kw">: </span><span class="at">$&lt;!--￼2--</span><span class="ch">&gt;</span></span>
<span id="cb16-18"><a href="#cb16-18"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Configuration environment</span></span>
<span id="cb16-19"><a href="#cb16-19"></a><span class="at">        </span><span class="fu">env</span><span class="kw">:</span></span>
<span id="cb16-20"><a href="#cb16-20"></a><span class="fu">          ID_RSA</span><span class="kw">: </span><span class="at">$&lt;!--￼3--</span><span class="ch">&gt;</span></span>
<span id="cb16-21"><a href="#cb16-21"></a><span class="fu">        run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb16-22"><a href="#cb16-22"></a>          mkdir -p ~/.ssh/</span>
<span id="cb16-23"><a href="#cb16-23"></a>          echo &quot;$ID_RSA&quot; &gt; ~/.ssh/id_rsa</span>
<span id="cb16-24"><a href="#cb16-24"></a>          chmod 600 ~/.ssh/id_rsa</span>
<span id="cb16-25"><a href="#cb16-25"></a>          ssh-keyscan &lt;your_host&gt; &gt;&gt; ~/.ssh/known_hosts</span>
<span id="cb16-26"><a href="#cb16-26"></a>          git config --global user.name &#39;&lt;your_user_name&gt;&#39;</span>
<span id="cb16-27"><a href="#cb16-27"></a>          git config --global user.email &#39;&lt;your_email&gt;&#39;</span>
<span id="cb16-28"><a href="#cb16-28"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Install dependencies</span></span>
<span id="cb16-29"><a href="#cb16-29"></a><span class="fu">        run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb16-30"><a href="#cb16-30"></a>          npm i -g hexo-cli</span>
<span id="cb16-31"><a href="#cb16-31"></a>          npm i</span>
<span id="cb16-32"><a href="#cb16-32"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Deploy hexo</span></span>
<span id="cb16-33"><a href="#cb16-33"></a><span class="fu">        run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb16-34"><a href="#cb16-34"></a>          hexo g -d</span></code></pre></div>
<p>注意将 <code>&lt;your_host&gt;</code>、<code>&lt;your_user_name&gt;</code>、<code>&lt;your_email&gt;</code> 替换成自己的域名、用户名和邮箱。</p>
<h2 id="配置-hexo">配置 Hexo</h2>
<p>修改 Hexo 根目录下的 <code>_config.yml</code> 文件，添加：</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb17-1"><a href="#cb17-1"></a><span class="fu">deploy</span><span class="kw">:</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="at">  </span><span class="fu">type</span><span class="kw">:</span><span class="at"> git</span></span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="at">  </span><span class="fu">repo</span><span class="kw">:</span><span class="at"> git@&lt;your_host&gt;:/var/repo/blog.git</span></span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="at">  </span><span class="fu">branch</span><span class="kw">:</span><span class="at"> master</span></span></code></pre></div>
<p>将 <code>&lt;your_host&gt;</code> 替换成自己的域名。</p>
<p>最后别忘了安装 <a href="https://github.com/hexojs/hexo-deployer-git" target="_blank" rel="noopener">hexo-deployer-git</a> 插件<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>。</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1"></a><span class="ex">npm</span> install hexo-deployer-git --save</span></code></pre></div>
<h2 id="配置-nginx">配置 Nginx</h2>
<p>在 <code>/etc/nginx/conf.d</code> 下新增配置 <code>blog.conf</code>。</p>
<pre class="nginx"><code>server {
    listen 443 ssl;
    server_name &lt;your_host&gt;;
    index index.html;  
    location / {
        root &quot;/var/www/html/hexo&quot;;
    }
}
server {
    listen 80;
    server_name &lt;your_host&gt;;
    rewrite ^(.*) https://$host$1 permanent;
}</code></pre>
<p>将 <code>&lt;your_host&gt;</code> 替换成自己的域名。</p>
<p>如果没有配置 SSL，<code>blog.conf</code> 应该写入：</p>
<pre class="nginx"><code>server {
    listen 80;
    server_name &lt;your_host&gt;;
    index index.html;  
    location / {
        root &quot;/var/www/html/hexo&quot;;
    }
}</code></pre>
<h2 id="测试">测试</h2>
<p>将本地文件推送至远程仓库，可以在 Actions 选项下看到触发了一次 GitHub Actions。</p>
<figure>
<img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="/images/Blog-Transfer-Record-2-Automate-Hexo-Deployment-with-GitHub-Actions/image-20200110161901448.png" alt><figcaption>Actions 执行成功</figcaption>
</figure>
<h2 id="最后">最后</h2>
<p>然后重启 Nginx 即可通过 <code>&lt;your_host&gt;</code> 访问博客。</p>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn1" role="doc-endnote"><p><a href="https://calton007.github.io/2018/05/08/n-deploy-vps/" target="_blank" rel="noopener">https://calton007.github.io/2018/05/08/n-deploy-vps/</a> "使用 Git Hook 自动部署 Hexo 到个人 VPS"<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p><a href="https://help.github.com/en/github/authenticating-to-github/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent" target="_blank" rel="noopener">https://help.github.com/en/github/authenticating-to-github/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent</a> "Generating a new SSH key and adding it to the ssh-agent"<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3" role="doc-endnote"><p><a href="https://suikastar.com/posts/24967/" target="_blank" rel="noopener">https://suikastar.com/posts/24967/</a> "使用 GitHub Actions 自动化部署 Hexo"<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4" role="doc-endnote"><p><a href="https://hexo.io/zh-cn/docs/one-command-deployment.html" target="_blank" rel="noopener">https://hexo.io/zh-cn/docs/one-command-deployment.html</a> "部署"<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

  </article>
  
    
<div class="nexmoe-post-copyright">
<i class="mdui-list-item-icon nexmoefont icon-info-circle"></i>
<strong>本文作者：</strong>Dreace<br>
<strong>本文链接：</strong><a href="https://blog.dreace.top/2020/Blog-Transfer-Record-2-Automate-Hexo-Deployment-with-GitHub-Actions/" title="https:&#x2F;&#x2F;blog.dreace.top&#x2F;2020&#x2F;Blog-Transfer-Record-2-Automate-Hexo-Deployment-with-GitHub-Actions&#x2F;" target="_blank" rel="noopener">https:&#x2F;&#x2F;blog.dreace.top&#x2F;2020&#x2F;Blog-Transfer-Record-2-Automate-Hexo-Deployment-with-GitHub-Actions&#x2F;</a><br>

  <strong>版权声明：</strong>本文采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/deed.zh" target="_blank">CC BY-NC-SA 3.0 CN</a> 协议进行许可

</div>


  
  <section class="nexmoe-comment">
    <!-- Unpkg -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/disqusjs@1.2.6/dist/disqusjs.min.css">
<script src="https://cdn.jsdelivr.net/npm/disqusjs@1.2.6/dist/disqus.min.js"></script>
<div id="disqus_thread"></div>
<script>
var dsqjs = new DisqusJS({
    shortname: 'dreace',
    siteName: 'DreaceのBlog',
    identifier: 'https://blog.dreace.top/2020/Blog-Transfer-Record-2-Automate-Hexo-Deployment-with-GitHub-Actions/',
    url: 'https://blog.dreace.top/2020/Blog-Transfer-Record-2-Automate-Hexo-Deployment-with-GitHub-Actions/',
    title: '博客迁移日志其二 使用 Github Actions 自动部署 Hexo',
    api: 'https://disqus.dreace.top/api/',
    apikey: 'wWzaLh1lIGm4TQtRW4PdoHfZtFBQE4bk7srIXB2J7zRbjZdsLXcboiHY0qHloPgs,1OH6IP9AXbWa1lfMZfSJJCPiCEXUIk9GlNtTTuZ3iJQKyzdwvoWBYrfUm9hIlRDn'.split(","),
    admin: 'Dreace',
    adminLabel: ''
});
</script>
</section>
</div>
        
    <div class="beian" >
        
            <a class="link" href="http://www.beian.miit.gov.cn/" target="_blank">蜀ICP备17035453号-1</a>
        
        
            &nbsp;&nbsp;&nbsp;&nbsp;<a class="link" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=51202202000022" target="_blank"><i class="govimg"></i>川公网安备 51202202000022 号</a>
        
    </div>


    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/mdui@0.4.3/dist/js/mdui.min.js"></script>

<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.0.2/build/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script src="/js/app.js?v=1644755527921"></script>
<script src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.0/lazysizes.min.js"></script>



  
    <!-- Google Analytics -->
<script>
    window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
    ga('create', 'UA-89152702-3', 'auto');
    ga('send', 'pageview');
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>






</body>

</html>
