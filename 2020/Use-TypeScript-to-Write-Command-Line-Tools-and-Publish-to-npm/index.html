<!DOCTYPE html>
<html>

<head>
  
  <title>使用 TypeScript 编写命令行工具并发布到 npm - DreaceのBlog</title>
  <meta charset="UTF-8">
  <meta name="description" content="一条咸鱼的垂死挣扎">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  

  <link rel="shortcut icon" href="/favicon-32x32.png" type="image/png" />
  <meta name="description" content="最近在研究优化在国内访问静态博客的时间，其中有一个方案是将生成的文件存储在对象存储，然后再通过 CDN 回源对象存储。确定方案后使用 七牛云 做一个加速实验，由于要将生成的文件上传，又要将这个过程尽可能自动化，而七牛云只提供 SDK，要上传只能将密钥硬编码在代码中，这是很危险的。 因此有了编写一个命令行工具的想法，由于最近在学习 TypeScript，就决定用它来写。">
<meta property="og:type" content="article">
<meta property="og:title" content="使用 TypeScript 编写命令行工具并发布到 npm">
<meta property="og:url" content="https://blog.dreace.top/2020/Use-TypeScript-to-Write-Command-Line-Tools-and-Publish-to-npm/index.html">
<meta property="og:site_name" content="DreaceのBlog">
<meta property="og:description" content="最近在研究优化在国内访问静态博客的时间，其中有一个方案是将生成的文件存储在对象存储，然后再通过 CDN 回源对象存储。确定方案后使用 七牛云 做一个加速实验，由于要将生成的文件上传，又要将这个过程尽可能自动化，而七牛云只提供 SDK，要上传只能将密钥硬编码在代码中，这是很危险的。 因此有了编写一个命令行工具的想法，由于最近在学习 TypeScript，就决定用它来写。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-07-25T02:01:41.000Z">
<meta property="article:modified_time" content="2020-08-14T09:53:33.249Z">
<meta property="article:author" content="Dreace">
<meta property="article:tag" content="npm">
<meta property="article:tag" content="TypeScript">
<meta name="twitter:card" content="summary">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdui@0.4.3/dist/css/mdui.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.0.2/styles/github.css">
  
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1038733_0xvrvpg9c0r.css">
  <link rel="stylesheet" href="/css/style.css?v=1597398835753">
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="DreaceのBlog" type="application/atom+xml">
</head>

<body class="mdui-drawer-body-left">
  
  <div id="nexmoe-background">
    <div class="nexmoe-bg" style="background-image: url()"></div>
    <div class="mdui-appbar mdui-shadow-0">
      <div class="mdui-toolbar">
        <a mdui-drawer="{target: '#drawer', swipe: true}" title="menu" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">menu</i></a>
        <div class="mdui-toolbar-spacer"></div>
        <!--<a href="javascript:;" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">search</i></a>-->
        <a href="/" title="Dreace" class="mdui-btn mdui-btn-icon"><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/avatar.png"></a>
       </div>
    </div>
  </div>
  <div id="nexmoe-header">
      <div class="nexmoe-drawer mdui-drawer" id="drawer">
    <div class="nexmoe-avatar mdui-ripple">
        <a href="/" title="Dreace">
            <img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/avatar.png" alt="Dreace">
        </a>
    </div>
    <div class="nexmoe-count">
        <div><span>文章</span>18</div>
        <div><span>标签</span>38</div>
        <div><span>分类</span>11</div>
    </div>
    <ul class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}">
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/friends.html" title="我的朋友">
            <i class="mdui-list-item-icon nexmoefont icon-unorderedlist"></i>
            <div class="mdui-list-item-content">
                我的朋友
            </div>
        </a>
        
    </ul>
    <aside id="nexmoe-sidebar">
  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">文章目录</h3>
    <div class="nexmoe-widget">
      <div id="toc" class="toc-article">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#准备环境"><span class="toc-text">准备环境</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#使用-eslint2"><span class="toc-text">使用 ESLint2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用-prettier"><span class="toc-text">使用 Prettier</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#在-webstorm-中启用-eslint-和-prettier"><span class="toc-text">在 WebStorm 中启用 ESLint 和 Prettier</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#启用-eslint"><span class="toc-text">启用 ESLint</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#启用-prettier"><span class="toc-text">启用 Prettier</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用-editorconfig"><span class="toc-text">使用 EditorConfig</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置-typescript"><span class="toc-text">配置 TypeScript</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#编写代码"><span class="toc-text">编写代码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#使用-commander.js"><span class="toc-text">使用 Commander.js</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#编写逻辑代码"><span class="toc-text">编写逻辑代码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#发布-npm-包"><span class="toc-text">发布 npm 包</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#填写包信息"><span class="toc-text">填写包信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#本地测试"><span class="toc-text">本地测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#发布"><span class="toc-text">发布</span></a></li></ol></li></ol>
      </div>
    </div>
  </div>


  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">联系我</h3>
    <div class="nexmoe-widget nexmoe-social">
        <a class="mdui-ripple" href="https://space.bilibili.com/7686754" target="_blank" mdui-tooltip="{content: '哔哩哔哩'}" style="color: rgb(231, 106, 141);background-color: rgba(231, 106, 141, .15);">
            <i class="nexmoefont icon-bilibili"></i>
        </a><a class="mdui-ripple" href="https://github.com/Dreace" target="_blank" mdui-tooltip="{content: 'GitHub'}" style="color: rgb(25, 23, 23);background-color: rgba(25, 23, 23, .15);">
            <i class="nexmoefont icon-github"></i>
        </a><a class="mdui-ripple" href="https://www.zhihu.com/people/dreace" target="_blank" mdui-tooltip="{content: '知乎'}" style="color: rgb(30, 136, 229);background-color: rgba(30, 136, 229, .15);">
            <i class="nexmoefont icon-zhihu"></i>
        </a><a class="mdui-ripple" href="https://steamcommunity.com/id/Dreace_Dreace/" target="_blank" mdui-tooltip="{content: 'Steam'}" style="color: rgb(37, 116, 196);background-color: rgba(37, 116, 196, .15);">
            <i class="nexmoefont icon-steam"></i>
        </a>
    </div>
</div>
  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">文章分类</h3>
    <div class="nexmoe-widget">

      <ul class="category-list">

        


        

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Docker/">Docker</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Hexo/">Hexo</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Linux/">Linux</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/MySQL/">MySQL</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Python/">Python</a>
          <span class="category-list-count">4</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/TypeScript/">TypeScript</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Vue-js/">Vue.js</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Windows/">Windows</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/建设日志/">建设日志</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/算法/">算法</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/面经/">面经</a>
          <span class="category-list-count">1</span>
        </li>

        
      </ul>

    </div>
  </div>


  
</aside>
    <div class="nexmoe-copyright">
        &copy; 2020 Dreace<br>
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
        & <a href="https://nexmoe.com/hexo-theme-nexmoe.html" target="_blank">Nexmoe</a>
    </div>
</div><!-- .nexmoe-drawer -->
  </div>
  <div id="nexmoe-content">
    <div class="nexmoe-primary">
        <div class="nexmoe-post">
    <div class="nexmoe-post-cover"> 

        <h1>使用 TypeScript 编写命令行工具并发布到 npm</h1>
    </div>
  <div class="nexmoe-post-meta">
    <a><i class="nexmoefont icon-calendar-fill"></i>2020年07月25日</a>
    <a><i class="nexmoefont icon-areachart"></i>2.2k 字</a>
    <a><i class="nexmoefont icon-time-circle-fill"></i>大概 10 分钟</a>
    
      <a class="nexmoefont icon-appstore-fill -link" href="/categories/TypeScript/">TypeScript</a>
    
    
      <a class="nexmoefont icon-tag-fill -link" href="/tags/TypeScript/" rel="tag">TypeScript</a> <a class="nexmoefont icon-tag-fill -link" href="/tags/npm/" rel="tag">npm</a>
    
  </div>
  <article>
    <p>最近在研究优化在国内访问静态博客的时间，其中有一个方案是将生成的文件存储在对象存储，然后再通过 CDN 回源对象存储。确定方案后使用 <a href="https://www.qiniu.com/" target="_blank" rel="noopener">七牛云</a> 做一个加速实验，由于要将生成的文件上传，又要将这个过程尽可能自动化，而七牛云只提供 SDK，要上传只能将密钥硬编码在代码中，这是很危险的。</p>
<p>因此有了编写一个命令行工具的想法，由于最近在学习 TypeScript，就决定用它来写。</p>
<a id="more"></a>
<h2 id="准备环境">准备环境</h2>
<p>在开始编写逻辑代码前需要准备一下开发环境。</p>
<p>首先初始化项目<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>：</p>
<pre class="shell"><code>yarn init -y</code></pre>
<p>本文将使用 yarn 作为包管理工具。</p>
<p>安装 TypeScript 支持：</p>
<pre class="shell"><code>yarn add global typescript ts-node-dev</code></pre>
<p><code>ts-node-dev</code> 可以直接启动 <code>.ts</code> 文件，如果使用 <code>tsc &amp;&amp; node "path/to/file.js"</code> 自行编译并启动则不需要这个依赖。</p>
<p>这两个依赖需要全局安装，因为他们分别提供 <code>tsc</code> 和 <code>ts-node-dev</code> 命令。</p>
<p>安装 Node.js 类型声明文件：</p>
<pre class="shell"><code>yarn add --dev @types/node</code></pre>
<p>以上是必备的开发依赖，除此还可以使用 ESLint 和 Prettier 来检查语法和规范格式。</p>
<p>以下配置内容均为可选，可以单独使用或组合使用。</p>
<h3 id="使用-eslint2">使用 ESLint<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></h3>
<p>ESLint 可以静态分析代码，能够尽早发现编码中的错误。</p>
<p>首先安装需要的依赖：</p>
<pre class="shell"><code>yarn add --dev @typescript-eslint/parser @typescript-eslint/eslint-plugin</code></pre>
<p>在根目录下创建 <code>.eslintrc.js</code> 文件并写入：</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1"></a><span class="va">module</span>.<span class="at">exports</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>    <span class="dt">parser</span><span class="op">:</span> <span class="st">&#39;@typescript-eslint/parser&#39;</span><span class="op">,</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>    <span class="dt">extends</span><span class="op">:</span> [<span class="st">&#39;plugin:@typescript-eslint/recommended&#39;</span>]<span class="op">,</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>    <span class="dt">plugins</span><span class="op">:</span> [<span class="st">&#39;@typescript-eslint&#39;</span>]<span class="op">,</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>    <span class="dt">env</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb5-6"><a href="#cb5-6"></a>        <span class="dt">node</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb5-7"><a href="#cb5-7"></a>    <span class="op">}</span></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="op">}</span></span></code></pre></div>
<p>更多的配置可以查看 <a href="https://eslint.org/docs/user-guide/configuring" target="_blank" rel="noopener">Configuring ESLint</a>。</p>
<h3 id="使用-prettier">使用 Prettier</h3>
<p>Prettier 可以通过配置文件来格式化代码，非常适合团队内规范代码。</p>
<p>首先安装 Prettier：</p>
<pre class="shell"><code>yarn add --dev prettier</code></pre>
<p>在根目录下创建 <code>prettier.config.js</code> 文件，并写入<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>：</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb7-1"><a href="#cb7-1"></a><span class="va">module</span>.<span class="at">exports</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>  <span class="co">// 一行最多 100 字符</span></span>
<span id="cb7-3"><a href="#cb7-3"></a>  <span class="dt">printWidth</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>  <span class="co">// 使用 4 个空格缩进</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>  <span class="dt">tabWidth</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb7-6"><a href="#cb7-6"></a>  <span class="co">// 不使用缩进符，而使用空格</span></span>
<span id="cb7-7"><a href="#cb7-7"></a>  <span class="dt">useTabs</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb7-8"><a href="#cb7-8"></a>  <span class="co">// 行尾需要有分号</span></span>
<span id="cb7-9"><a href="#cb7-9"></a>  <span class="dt">semi</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb7-10"><a href="#cb7-10"></a>  <span class="co">// 使用单引号</span></span>
<span id="cb7-11"><a href="#cb7-11"></a>  <span class="dt">singleQuote</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb7-12"><a href="#cb7-12"></a>  <span class="co">// 对象的 key 仅在必要时用引号</span></span>
<span id="cb7-13"><a href="#cb7-13"></a>  <span class="dt">quoteProps</span><span class="op">:</span> <span class="st">&#39;as-needed&#39;</span><span class="op">,</span></span>
<span id="cb7-14"><a href="#cb7-14"></a>  <span class="co">// jsx 不使用单引号，而使用双引号</span></span>
<span id="cb7-15"><a href="#cb7-15"></a>  <span class="dt">jsxSingleQuote</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb7-16"><a href="#cb7-16"></a>  <span class="co">// 末尾不需要逗号</span></span>
<span id="cb7-17"><a href="#cb7-17"></a>  <span class="dt">trailingComma</span><span class="op">:</span> <span class="st">&#39;all&#39;</span><span class="op">,</span></span>
<span id="cb7-18"><a href="#cb7-18"></a>  <span class="co">// 大括号内的首尾需要空格</span></span>
<span id="cb7-19"><a href="#cb7-19"></a>  <span class="dt">bracketSpacing</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb7-20"><a href="#cb7-20"></a>  <span class="co">// jsx 标签的反尖括号需要换行</span></span>
<span id="cb7-21"><a href="#cb7-21"></a>  <span class="dt">jsxBracketSameLine</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb7-22"><a href="#cb7-22"></a>  <span class="co">// 箭头函数，只有一个参数的时候，也需要括号</span></span>
<span id="cb7-23"><a href="#cb7-23"></a>  <span class="dt">arrowParens</span><span class="op">:</span> <span class="st">&#39;always&#39;</span><span class="op">,</span></span>
<span id="cb7-24"><a href="#cb7-24"></a>  <span class="co">// 每个文件格式化的范围是文件的全部内容</span></span>
<span id="cb7-25"><a href="#cb7-25"></a>  <span class="dt">rangeStart</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb7-26"><a href="#cb7-26"></a>  <span class="dt">rangeEnd</span><span class="op">:</span> <span class="kw">Infinity</span><span class="op">,</span></span>
<span id="cb7-27"><a href="#cb7-27"></a>  <span class="co">// 不需要写文件开头的 @prettier</span></span>
<span id="cb7-28"><a href="#cb7-28"></a>  <span class="dt">requirePragma</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb7-29"><a href="#cb7-29"></a>  <span class="co">// 不需要自动在文件开头插入 @prettier</span></span>
<span id="cb7-30"><a href="#cb7-30"></a>  <span class="dt">insertPragma</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb7-31"><a href="#cb7-31"></a>  <span class="co">// 使用默认的折行标准</span></span>
<span id="cb7-32"><a href="#cb7-32"></a>  <span class="dt">proseWrap</span><span class="op">:</span> <span class="st">&#39;preserve&#39;</span><span class="op">,</span></span>
<span id="cb7-33"><a href="#cb7-33"></a>  <span class="co">// 根据显示样式决定 html 要不要折行</span></span>
<span id="cb7-34"><a href="#cb7-34"></a>  <span class="dt">htmlWhitespaceSensitivity</span><span class="op">:</span> <span class="st">&#39;css&#39;</span><span class="op">,</span></span>
<span id="cb7-35"><a href="#cb7-35"></a>  <span class="co">// 换行符使用 lf</span></span>
<span id="cb7-36"><a href="#cb7-36"></a>  <span class="dt">endOfLine</span><span class="op">:</span> <span class="st">&#39;lf&#39;</span><span class="op">,</span></span>
<span id="cb7-37"><a href="#cb7-37"></a><span class="op">};</span></span></code></pre></div>
<p>更多配置可查看 <a href="https://prettier.io/docs/en/index.html" target="_blank" rel="noopener">What is Prettier?</a>。</p>
<h3 id="在-webstorm-中启用-eslint-和-prettier">在 WebStorm 中启用 ESLint 和 Prettier</h3>
<h4 id="启用-eslint">启用 ESLint</h4>
<p>找到 File | Settings | Languages &amp; Frameworks | JavaScript | Code Quality Tools | ESLint 配置项，选择 Automatic ESLint configuration。</p>
<p>WebStorm 会自动查找 ESLint 路径并执行检查。</p>
<h4 id="启用-prettier">启用 Prettier</h4>
<p>找到 File | Settings | Languages &amp; Frameworks | JavaScript | Prettier 配置项，选择 Prettier 路径，可以勾选 Run on save for files，在保存时自动执行检查。</p>
<h4 id="使用-editorconfig">使用 EditorConfig</h4>
<p>EditorConfig 可以通过配置文件来指定不同 IDE 或编辑器的代码格式化行为，在编码期间就能根据团队规范格式化代码。</p>
<p>WebStorm 已经内置实现 EditorConfig 支持，在根目录创建 <code>.editorconfig</code> 文件，并写入：</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode ini"><code class="sourceCode ini"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># http://editorconfig.org</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="dt">root </span><span class="ot">=</span><span class="st"> </span><span class="kw">true</span></span>
<span id="cb8-3"><a href="#cb8-3"></a></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="kw">[*]</span></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="dt">indent_style </span><span class="ot">=</span><span class="st"> space</span></span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="dt">indent_size </span><span class="ot">=</span><span class="st"> </span><span class="dv">2</span></span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="dt">end_of_line </span><span class="ot">=</span><span class="st"> lf</span></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="dt">charset </span><span class="ot">=</span><span class="st"> utf</span><span class="dv">-8</span></span>
<span id="cb8-9"><a href="#cb8-9"></a><span class="dt">trim_trailing_whitespace </span><span class="ot">=</span><span class="st"> </span><span class="kw">true</span></span>
<span id="cb8-10"><a href="#cb8-10"></a><span class="dt">insert_final_newline </span><span class="ot">=</span><span class="st"> </span><span class="kw">true</span></span>
<span id="cb8-11"><a href="#cb8-11"></a></span>
<span id="cb8-12"><a href="#cb8-12"></a><span class="kw">[*.md]</span></span>
<span id="cb8-13"><a href="#cb8-13"></a><span class="dt">trim_trailing_whitespace </span><span class="ot">=</span><span class="st"> </span><span class="kw">false</span></span>
<span id="cb8-14"><a href="#cb8-14"></a></span>
<span id="cb8-15"><a href="#cb8-15"></a><span class="kw">[*.ts]</span></span>
<span id="cb8-16"><a href="#cb8-16"></a><span class="dt">ij_typescript_spaces_within_imports </span><span class="ot">=</span><span class="st"> </span><span class="kw">true</span></span>
<span id="cb8-17"><a href="#cb8-17"></a></span>
<span id="cb8-18"><a href="#cb8-18"></a><span class="kw">[Makefile]</span></span>
<span id="cb8-19"><a href="#cb8-19"></a><span class="dt">indent_style </span><span class="ot">=</span><span class="st"> tab</span></span></code></pre></div>
<p>以上配置效果和 Prettier 相同，更多配置可查看 <a href="https://editorconfig.org/#overview" target="_blank" rel="noopener">EditorConfig</a>。</p>
<h3 id="配置-typescript">配置 TypeScript</h3>
<p>在根目录下创建 <code>tsconfig.json</code> 文件，并写入：</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb9-1"><a href="#cb9-1"></a><span class="fu">{</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>  <span class="dt">&quot;compilerOptions&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>    <span class="dt">&quot;target&quot;</span><span class="fu">:</span> <span class="st">&quot;es5&quot;</span><span class="fu">,</span></span>
<span id="cb9-4"><a href="#cb9-4"></a>    <span class="dt">&quot;module&quot;</span><span class="fu">:</span> <span class="st">&quot;commonjs&quot;</span><span class="fu">,</span></span>
<span id="cb9-5"><a href="#cb9-5"></a>    <span class="dt">&quot;outDir&quot;</span><span class="fu">:</span> <span class="st">&quot;./dist&quot;</span><span class="fu">,</span></span>
<span id="cb9-6"><a href="#cb9-6"></a>    <span class="dt">&quot;strict&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb9-7"><a href="#cb9-7"></a>    <span class="dt">&quot;esModuleInterop&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb9-8"><a href="#cb9-8"></a>    <span class="dt">&quot;skipLibCheck&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb9-9"><a href="#cb9-9"></a>    <span class="dt">&quot;forceConsistentCasingInFileNames&quot;</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb9-10"><a href="#cb9-10"></a>  <span class="fu">}</span></span>
<span id="cb9-11"><a href="#cb9-11"></a><span class="fu">}</span></span></code></pre></div>
<p><code>outDir</code> 指定 <code>tsc</code> 命令编译结果输出路径。</p>
<h2 id="编写代码">编写代码</h2>
<h3 id="使用-commander.js">使用 Commander.js</h3>
<p>要编写的是命令行工具，自然要解析命令行参数，出于不重复造轮子的目的选择 <a href="https://github.com/tj/commander.js" target="_blank" rel="noopener">Commander.js</a> 来解析命令行参数。</p>
<p>安装 Commander.js：</p>
<pre class="shell"><code>yarn add commander</code></pre>
<p>Commander.js 使用很简单，一个例子：</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb11-1"><a href="#cb11-1"></a><span class="im">import</span> <span class="op">{</span> program <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;commander&#39;</span><span class="op">;</span></span>
<span id="cb11-2"><a href="#cb11-2"></a></span>
<span id="cb11-3"><a href="#cb11-3"></a>program</span>
<span id="cb11-4"><a href="#cb11-4"></a>  .<span class="fu">version</span>(<span class="st">&#39;1.0.3&#39;</span>)</span>
<span id="cb11-5"><a href="#cb11-5"></a>  .<span class="fu">name</span>(<span class="st">&#39;upload-to-qiniu&#39;</span>)</span>
<span id="cb11-6"><a href="#cb11-6"></a>  .<span class="fu">requiredOption</span>(<span class="st">&#39;-a, --access-key [ak]&#39;</span><span class="op">,</span> <span class="st">&#39;access key&#39;</span>)</span>
<span id="cb11-7"><a href="#cb11-7"></a>  .<span class="fu">requiredOption</span>(<span class="st">&#39;-s, --secret-key [sk]&#39;</span><span class="op">,</span> <span class="st">&#39;secret key&#39;</span>)</span>
<span id="cb11-8"><a href="#cb11-8"></a>  .<span class="fu">option</span>(<span class="st">&#39;-d, --upload-dir &lt;dir&gt;&#39;</span><span class="op">,</span> <span class="st">&#39;要上传的目录&#39;</span><span class="op">,</span> <span class="st">&#39;./&#39;</span>)</span>
<span id="cb11-9"><a href="#cb11-9"></a>  .<span class="fu">requiredOption</span>(<span class="st">&#39;-b, --bucket [bucket]&#39;</span><span class="op">,</span> <span class="st">&#39;对象存储空间名&#39;</span>)</span>
<span id="cb11-10"><a href="#cb11-10"></a>  .<span class="fu">option</span>(<span class="st">&#39;-e, --exclude-prefix &lt;prefixs...&gt;&#39;</span><span class="op">,</span> <span class="st">&#39;忽略的文件名前缀，可以设置多个&#39;</span>)</span>
<span id="cb11-11"><a href="#cb11-11"></a>  .<span class="fu">parse</span>()<span class="op">;</span></span></code></pre></div>
<p><code>import { program } from 'commander';</code> 导入全局对象，<code>version</code> 指定版本号，<code>name</code> 指定 <code>-h</code> 帮助信息的名称。</p>
<p><code>option</code> 定义选项，一共三个参数：</p>
<ul>
<li>第一个参数指定选项名称，指定选项的短名称和长名称，使用逗号、空格或 <code>|</code> 分割，必选</li>
<li>第二个参数为选项描述，可选</li>
<li>第三个参数为默认值，可选</li>
</ul>
<p><code>option</code> 定义的选项是非必选的，如需要定义必选选项可以使用 <code>requiredOption</code>，如果使用命令行时没有指定必选选项会有报错。</p>
<p>有两种最常用的选项，一类是 boolean 型选项，选项无需配置参数，另一类选项则可以设置参数（使用尖括号声明）。如果在命令行中不指定具体的选项及参数，则会被定义为 <code>undefined</code>。</p>
<p>代码中将长名称转化成小驼峰来获取用户指定的参数值，例如：</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb12-1"><a href="#cb12-1"></a><span class="kw">const</span> mac <span class="op">=</span> <span class="kw">new</span> <span class="va">qiniu</span><span class="op">.</span><span class="va">auth</span><span class="op">.</span><span class="va">digest</span><span class="op">.</span><span class="fu">Mac</span>(<span class="va">program</span><span class="op">.</span><span class="at">accessKey</span><span class="op">,</span> <span class="va">program</span><span class="op">.</span><span class="at">secretKey</span>)<span class="op">;</span></span></code></pre></div>
<p><code>program.accessKey</code> 获取的是 <code>-a</code> 参数指定的值。</p>
<p>定义好选项后可以使用 <code>-h</code> 查看帮助信息：</p>
<pre class="text"><code>&gt; upload-to-qiniu -h
Usage: upload-to-qiniu [options]

Options:
  -V, --version                      output the version number
  -a, --access-key [ak]              access key
  -s, --secret-key [sk]              secret key
  -d, --upload-dir &lt;dir&gt;             要上传的目录 (default: &quot;./&quot;)
  -b, --bucket [bucket]              对象存储空间名
  -e, --exclude-prefix &lt;prefixs...&gt;  忽略的文件名前缀，可以设置多个
  -h, --help                         display help for command</code></pre>
<h3 id="编写逻辑代码">编写逻辑代码</h3>
<p>做了这么多准备终于可以正式开始编写代码了，在根目录创建 <code>src</code> 目录，然后在其中编写代码即可。</p>
<p>每个项目具体细节有很大差异，这里就不写具体细节了，不过有一点要注意，入口文件首行一定要加上 <code>#!/usr/bin/env node</code> 来指定解释器，否则会使用系统解释器，在 Windows 下不能正常使用。</p>
<p>本文涉及的具体代码可以在 <a href="https://github.com/Dreace/upload-to-qiniu" target="_blank" rel="noopener">Dreace/upload-to-qiniu</a> 找到。</p>
<h2 id="发布-npm-包">发布 npm 包</h2>
<h3 id="填写包信息">填写包信息</h3>
<div class="sourceCode" id="cb14"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb14-1"><a href="#cb14-1"></a><span class="fu">{</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>  <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;upload-to-qiniu&quot;</span><span class="fu">,</span></span>
<span id="cb14-3"><a href="#cb14-3"></a>  <span class="dt">&quot;version&quot;</span><span class="fu">:</span> <span class="st">&quot;1.0.4&quot;</span><span class="fu">,</span></span>
<span id="cb14-4"><a href="#cb14-4"></a>  <span class="dt">&quot;license&quot;</span><span class="fu">:</span> <span class="st">&quot;GPL-3.0&quot;</span><span class="fu">,</span></span>
<span id="cb14-5"><a href="#cb14-5"></a>  <span class="dt">&quot;main&quot;</span><span class="fu">:</span> <span class="st">&quot;dist/upload.js&quot;</span><span class="fu">,</span></span>
<span id="cb14-6"><a href="#cb14-6"></a>  <span class="dt">&quot;bin&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb14-7"><a href="#cb14-7"></a>    <span class="dt">&quot;upload-to-qiniu&quot;</span><span class="fu">:</span> <span class="st">&quot;dist/upload.js&quot;</span></span>
<span id="cb14-8"><a href="#cb14-8"></a>  <span class="fu">},</span></span>
<span id="cb14-9"><a href="#cb14-9"></a>  <span class="dt">&quot;scripts&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb14-10"><a href="#cb14-10"></a>    <span class="dt">&quot;lint&quot;</span><span class="fu">:</span> <span class="st">&quot;eslint src --fix --ext .ts&quot;</span></span>
<span id="cb14-11"><a href="#cb14-11"></a>  <span class="fu">},</span></span>
<span id="cb14-12"><a href="#cb14-12"></a>  <span class="dt">&quot;files&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb14-13"><a href="#cb14-13"></a>    <span class="st">&quot;dist/**/*.js&quot;</span></span>
<span id="cb14-14"><a href="#cb14-14"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb14-15"><a href="#cb14-15"></a>  <span class="dt">&quot;dependencies&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb14-16"><a href="#cb14-16"></a>    <span class="dt">&quot;commander&quot;</span><span class="fu">:</span> <span class="st">&quot;^6.0.0&quot;</span><span class="fu">,</span></span>
<span id="cb14-17"><a href="#cb14-17"></a>    <span class="dt">&quot;qiniu&quot;</span><span class="fu">:</span> <span class="st">&quot;^7.3.2&quot;</span></span>
<span id="cb14-18"><a href="#cb14-18"></a>  <span class="fu">},</span></span>
<span id="cb14-19"><a href="#cb14-19"></a>  <span class="dt">&quot;devDependencies&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb14-20"><a href="#cb14-20"></a>    <span class="dt">&quot;@types/node&quot;</span><span class="fu">:</span> <span class="st">&quot;^14.0.24&quot;</span><span class="fu">,</span></span>
<span id="cb14-21"><a href="#cb14-21"></a>    <span class="dt">&quot;@typescript-eslint/eslint-plugin&quot;</span><span class="fu">:</span> <span class="st">&quot;^3.7.0&quot;</span><span class="fu">,</span></span>
<span id="cb14-22"><a href="#cb14-22"></a>    <span class="dt">&quot;@typescript-eslint/parser&quot;</span><span class="fu">:</span> <span class="st">&quot;^3.7.0&quot;</span><span class="fu">,</span></span>
<span id="cb14-23"><a href="#cb14-23"></a>    <span class="dt">&quot;eslint&quot;</span><span class="fu">:</span> <span class="st">&quot;^7.5.0&quot;</span><span class="fu">,</span></span>
<span id="cb14-24"><a href="#cb14-24"></a>    <span class="dt">&quot;eslint-plugin-prettier&quot;</span><span class="fu">:</span> <span class="st">&quot;^3.1.4&quot;</span><span class="fu">,</span></span>
<span id="cb14-25"><a href="#cb14-25"></a>    <span class="dt">&quot;prettier&quot;</span><span class="fu">:</span> <span class="st">&quot;^2.0.5&quot;</span></span>
<span id="cb14-26"><a href="#cb14-26"></a>  <span class="fu">}</span></span>
<span id="cb14-27"><a href="#cb14-27"></a><span class="fu">}</span></span></code></pre></div>
<p><code>name</code> 指定包名，在 npm 中全局唯一，<code>version</code> 指定当前版本，<code>license</code> 指定许可证。</p>
<p><code>bin</code> 指定命令行和要执行的 <code>.js</code> 脚本对应关系，一个包可以提供多个命令行工具。</p>
<p><code>files</code> 指定打包时要包含的文件，除此 <code>README.md</code> 和 <code>LICENSE</code> 也会被打包。</p>
<h3 id="本地测试">本地测试</h3>
<p>编写完代码后需要安装为全局包进行测试。</p>
<pre class="shell"><code>npm i -g .</code></pre>
<p>将当前目录下的文件安装为全局包，安装后可以通过 <code>bin</code> 中指定的名称来使用。</p>
<h3 id="发布">发布</h3>
<p>首先 <a href="https://www.npmjs.com/signup" target="_blank" rel="noopener">注册一个 npm 账号</a>。然后使用 <code>npm login</code> 登录到 npm。</p>
<p>登录后使用 <code>npm publish</code> 发布包，输出信息大致如下：</p>
<pre class="text"><code>&gt; npm publish
npm notice
npm notice package: upload-to-qiniu@1.0.5
npm notice === Tarball Contents ===
npm notice 35.8kB LICENSE
npm notice 6.0kB  dist/upload.js
npm notice 6.6kB  dist/utils.js
npm notice 931B   package.json
npm notice 1.0kB  README.md
npm notice === Tarball Details ===
npm notice name:          upload-to-qiniu
npm notice version:       1.0.5
npm notice package size:  16.4 kB
npm notice unpacked size: 50.4 kB
npm notice shasum:        73b867074f514761f6c6c9a442c38e83bc18aa9a
npm notice integrity:     sha512-qHdhXhV/JjzMv[...]x6wD4OY1ysFnQ==
npm notice total files:   5
npm notice
+ upload-to-qiniu@1.0.5</code></pre>
<p>发布成功后可以在 <a href="https://www.npmjs.com/" target="_blank" rel="noopener">https://www.npmjs.com/</a> 看到包信息。</p>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn1" role="doc-endnote"><p><a href="https://juejin.im/post/5ecdd5185188254329780b0f" target="_blank" rel="noopener">https://juejin.im/post/5ecdd5185188254329780b0f</a> "用 Node.js 写个命令行翻译工具, 发布到 npm"<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p><a href="https://github.com/forthealllight/blog/issues/45" target="_blank" rel="noopener">https://github.com/forthealllight/blog/issues/45</a> "在Typescript项目中，如何优雅的使用ESLint和Prettier"<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3" role="doc-endnote"><p><a href="https://ts.xcatliu.com/engineering/lint.html" target="_blank" rel="noopener">https://ts.xcatliu.com/engineering/lint.html</a> "代码检查 · TypeScript 入门教程"<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

  </article>
  
    
<div class="nexmoe-post-copyright">
<i class="mdui-list-item-icon nexmoefont icon-info-circle"></i>
<strong>本文作者：</strong>Dreace<br>
<strong>本文链接：</strong><a href="https://blog.dreace.top/2020/Use-TypeScript-to-Write-Command-Line-Tools-and-Publish-to-npm/" title="https:&#x2F;&#x2F;blog.dreace.top&#x2F;2020&#x2F;Use-TypeScript-to-Write-Command-Line-Tools-and-Publish-to-npm&#x2F;" target="_blank" rel="noopener">https:&#x2F;&#x2F;blog.dreace.top&#x2F;2020&#x2F;Use-TypeScript-to-Write-Command-Line-Tools-and-Publish-to-npm&#x2F;</a><br>

  <strong>版权声明：</strong>本文采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/deed.zh" target="_blank">CC BY-NC-SA 3.0 CN</a> 协议进行许可

</div>


  
  <section class="nexmoe-comment">
    <!-- Unpkg -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/disqusjs@1.2.6/dist/disqusjs.min.css">
<script src="https://cdn.jsdelivr.net/npm/disqusjs@1.2.6/dist/disqus.min.js"></script>
<div id="disqus_thread"></div>
<script>
var dsqjs = new DisqusJS({
    shortname: 'dreace',
    siteName: 'DreaceのBlog',
    identifier: 'https://blog.dreace.top/2020/Use-TypeScript-to-Write-Command-Line-Tools-and-Publish-to-npm/',
    url: 'https://blog.dreace.top/2020/Use-TypeScript-to-Write-Command-Line-Tools-and-Publish-to-npm/',
    title: '使用 TypeScript 编写命令行工具并发布到 npm',
    api: 'https://disqus.dreace.top/api/',
    apikey: 'wWzaLh1lIGm4TQtRW4PdoHfZtFBQE4bk7srIXB2J7zRbjZdsLXcboiHY0qHloPgs,1OH6IP9AXbWa1lfMZfSJJCPiCEXUIk9GlNtTTuZ3iJQKyzdwvoWBYrfUm9hIlRDn'.split(","),
    admin: 'Dreace',
    adminLabel: '书记！'
});
</script>
</section>
</div>
        
    <div class="beian" >
        
            <a class="link" href="http://www.beian.miit.gov.cn/" target="_blank">蜀ICP备17035453号-1</a>
        
        
            &nbsp;&nbsp;&nbsp;&nbsp;<a class="link" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=51202202000022" target="_blank"><i class="govimg"></i>川公网安备 51202202000022 号</a>
        
    </div>


    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/mdui@0.4.3/dist/js/mdui.min.js"></script>

<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.0.2/build/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script src="/js/app.js?v=1597398835763"></script>
<script src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.0/lazysizes.min.js"></script>



  
    <!-- Google Analytics -->
<script>
    window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
    ga('create', 'UA-89152702-3', 'auto');
    ga('send', 'pageview');
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>




    <!-- Tencent Analytics -->
<script>
    (function() {
        var hm = document.createElement("script");
        hm.src = "//tajs.qq.com/stats?sId=500701683";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>



</body>

</html>
