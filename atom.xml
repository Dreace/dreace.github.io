<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>DreaceのBlog</title>
  
  <subtitle>幻冰の博客</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://blog.dreace.top/"/>
  <updated>2020-08-14T09:53:33.249Z</updated>
  <id>https://blog.dreace.top/</id>
  
  <author>
    <name>Dreace</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>腾讯 CDG 后端面经，共六面（1+3+1+1）</title>
    <link href="https://blog.dreace.top/2020/Tencent-CDG-Back-End-Interview-Experience-a-Total-of-Six-Times-1-3-1-1/"/>
    <id>https://blog.dreace.top/2020/Tencent-CDG-Back-End-Interview-Experience-a-Total-of-Six-Times-1-3-1-1/</id>
    <published>2020-08-14T08:06:26.000Z</published>
    <updated>2020-08-14T09:53:33.249Z</updated>
    
    <content type="html"><![CDATA[<p>8月4日晚上突然接到腾讯的电话，问又没行兴趣做支付方面的 C++ 开发，然后简单问了几个问题说第二天定个时间视频面。就这样到今天（8月14日）稀里糊涂地完成了 HR 面。</p><p>一共经历了 1 次电话面（简历面），3 次技术面，1 次「GM/EVP/面委会」面和 1 次 HR 面，希望可以拿到 Offer，提早结束提心吊胆的秋招。</p><a id="more"></a><h2 id="第-0-面电话面8月4日">第 0 面（电话面）/8月4日</h2><ol type="1"><li>自我介绍</li><li>项目<ol type="1"><li>数据库存密码方案</li></ol></li><li>TCP 三次握手</li><li>服务器超时没有收到第三次握手会发什么报文</li></ol><h2 id="第-1-面8月5日">第 1 面/8月5日</h2><p>没有录音，有些问题想不起来了。</p><ol type="1"><li>实现 <code>atoi</code> 函数</li><li>实现 C++ 单例模式</li><li>实现快排</li><li>说一下 C++ 静态成员</li><li>C++ 静态变量（成员）存放在位置</li><li>TLS 握手过程<ol type="1"><li>证书包含哪些信息</li><li>客户端如何确认服务器身份</li><li>有哪些签名算法</li><li>双向认证</li></ol></li><li>Redis 的事务</li><li>中间人攻击</li><li>DDoS 攻击</li></ol><h2 id="第-2-面8月8日">第 2 面/8月8日</h2><p>对方介绍说是小组 leader，如果拿到 Offer 的话会在他手下干活，最后还说了一下具体的业务。录音出问题，只能回忆起部分问题。</p><ol type="1"><li>实现 TopN 查找</li><li>InnoDB 主键索引和辅助索引结构</li><li>C++ 中 <code>map</code> 与 <code>unordered_map</code> 区别，和适用场景</li><li>家在哪里，能不能接受去深圳</li></ol><p>实际上不止这些问题，如果能想起来再补上。</p><h2 id="第-3-面8月9日">第 3 面/8月9日</h2><ol type="1"><li>项目相关</li><li>是否对编程感兴趣</li><li>做项目的时候怎么选择技术栈</li><li>在团队中什么地位，周围人怎么评价自己</li><li>职业规划</li><li>十亿个 QQ 号判断一个是否在其中，性能达到 10 万 QPS</li><li>设计一个保障服务高可用的模型</li><li>有没有其他 Offer</li><li>有没有业务偏好</li></ol><h2 id="第-4-面总监面8月13日">第 4 面（总监面）/8月13日</h2><p>能感受到对面非常忙，八分钟就结束了。</p><ol type="1"><li>快速自我介绍</li><li>怎么定义「高可用」</li><li>反问</li><li>职业规划</li></ol><h2 id="第-5-面hr-面8月14日">第 5 面（HR 面）/8月14日</h2><ol type="1"><li>自我介绍</li><li>职业规划<ol type="1"><li>什么样的工作算满意</li></ol></li><li>开发方向偏好</li><li>短板，有没有去补足</li><li>有没有其他 Offer</li><li>和前面面试官聊得怎么样</li><li>没有实习吗</li><li>最有成就感的事</li><li>在深圳工作有问题吗，家里人支不支持</li></ol><p>最后问了一下 HR 什么时候出结果，回答说等其他人面试完，一到两周尽快给反馈。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;8月4日晚上突然接到腾讯的电话，问又没行兴趣做支付方面的 C++ 开发，然后简单问了几个问题说第二天定个时间视频面。就这样到今天（8月14日）稀里糊涂地完成了 HR 面。&lt;/p&gt;
&lt;p&gt;一共经历了 1 次电话面（简历面），3 次技术面，1 次「GM/EVP/面委会」面和 1 次 HR 面，希望可以拿到 Offer，提早结束提心吊胆的秋招。&lt;/p&gt;
    
    </summary>
    
    
      <category term="面经" scheme="https://blog.dreace.top/categories/%E9%9D%A2%E7%BB%8F/"/>
    
    
      <category term="面经" scheme="https://blog.dreace.top/tags/%E9%9D%A2%E7%BB%8F/"/>
    
      <category term="腾讯" scheme="https://blog.dreace.top/tags/%E8%85%BE%E8%AE%AF/"/>
    
  </entry>
  
  <entry>
    <title>解决 hexo-katex 错误地将中文编码为 HTML 字符实体</title>
    <link href="https://blog.dreace.top/2020/Solve-the-Problem-That-hexo-katex-Incorrectly-Encodes-Chinese-As-HTML-Character-Entities/"/>
    <id>https://blog.dreace.top/2020/Solve-the-Problem-That-hexo-katex-Incorrectly-Encodes-Chinese-As-HTML-Character-Entities/</id>
    <published>2020-08-01T12:32:12.000Z</published>
    <updated>2020-08-14T09:53:33.249Z</updated>
    
    <content type="html"><![CDATA[<p>偶然发现博客正文中的中文都被编码成了 <a href="https://zh.wikipedia.org/wiki/%E5%AD%97%E7%AC%A6%E5%AE%9E%E4%BD%93%E5%BC%95%E7%94%A8" target="_blank" rel="noopener">HTML 字符实体</a>，也就是中文「静」被编码为 <code>&amp;#x9759;</code>，在 UTF-8 中一个中文字符由三个字符编码，而转成 HTML 字符实体后一个中文字符占 8 个字节，增加了 167%。一篇博客正文占据主要部分，四舍五入，转换后 HTML 文件体积比直接使用 UFT-8 编码大了一倍。</p><a id="more"></a><h2 id="定位问题">定位问题</h2><p>查阅资料得知可能是 cheerio 引起的问题<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>，在 node_modules 下查找发现 hexo-katex 引入了 cheerio 并设置了要编码实体，</p><p>定位到的代码（node_modules/hexo-katex/index.js:16）：</p><div class="sourceCode" id="cb1"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">var</span> $ <span class="op">=</span> <span class="va">cheerio</span>.<span class="at">load</span>(<span class="va">data</span>.<span class="at">content</span><span class="op">,</span> <span class="op">{</span> <span class="dt">decodeEntities</span><span class="op">:</span> <span class="kw">true</span> <span class="op">}</span>)</span></code></pre></div><h2 id="解决">解决</h2><p>既然问题找到了，解决办法也很简单，将 <code>true</code> 改为 <code>false</code>：</p><div class="sourceCode" id="cb2"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">var</span> $ <span class="op">=</span> <span class="va">cheerio</span>.<span class="at">load</span>(<span class="va">data</span>.<span class="at">content</span><span class="op">,</span> <span class="op">{</span> <span class="dt">decodeEntities</span><span class="op">:</span> <span class="kw">false</span> <span class="op">}</span>)</span></code></pre></div><p>但是，直接修改 node_modules 下的文件可能会丢失更改，或者需要在其他环境使用修改不能同步。由于我的博客是使用 CI/CD 自动编译并部署的，直接修改文件会比较麻烦。</p><p>这时就需要 <a href="https://github.com/ds300/patch-package" target="_blank" rel="noopener">patch-package</a> 了，patch-package 可以将更改固定，在每次安装依赖时自动应用更改。</p><h3 id="安装">安装</h3><p>首先要安装 patch-package：</p><pre class="shell"><code>yarn add patch-package postinstall-postinstall</code></pre><p>如果使用 npm 则是：</p><pre class="shell"><code>npm i patch-package</code></pre><p>然后在 package.json 的 <code>scripts</code> 字段下新增：</p><div class="sourceCode" id="cb5"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb5-1"><a href="#cb5-1"></a><span class="er">&quot;postinstall&quot;:</span> <span class="er">&quot;patch-package&quot;,</span></span></code></pre></div><p>表明在依赖安装后会执行 <code>patch-package</code>。</p><h3 id="固定修改">固定修改</h3><p>首先保存已修改的文件，然后执行：</p><pre class="shell"><code>yarn patch-package &lt;修改了的包名&gt;</code></pre><p>或者使用 npx：</p><pre class="shell"><code>npx patch-package &lt;修改了的包名&gt;</code></pre><p>此时将看到类似：</p><pre class="text"><code>yarn run v1.22.4$ patch-packagepatch-package 6.2.2Applying patches...hexo-katex@0.0.13 ✔Done in 1.13s.</code></pre><p>的输出，表明修改已经固定。</p><p>在 patches 目录下会有对应的 <code>.patch</code> 文件，本文对应的文件如下：</p><div class="sourceCode" id="cb9"><pre class="sourceCode diff"><code class="sourceCode diff"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw">diff --git a/node_modules/hexo-katex/index.js b/node_modules/hexo-katex/index.js</span></span><span id="cb9-2"><a href="#cb9-2"></a>index cf8daf8..98fb8c6 100644</span><span id="cb9-3"><a href="#cb9-3"></a><span class="dt">--- a/node_modules/hexo-katex/index.js</span></span><span id="cb9-4"><a href="#cb9-4"></a><span class="dt">+++ b/node_modules/hexo-katex/index.js</span></span><span id="cb9-5"><a href="#cb9-5"></a><span class="dt">@@ -13,7 +13,7 @@ hexo.extend.filter.register(&#39;after_post_render&#39;, function(data) {</span></span><span id="cb9-6"><a href="#cb9-6"></a> </span><span id="cb9-7"><a href="#cb9-7"></a>   if (!cheerio) cheerio = require(&#39;cheerio&#39;)</span><span id="cb9-8"><a href="#cb9-8"></a> </span><span id="cb9-9"><a href="#cb9-9"></a><span class="st">-  var $ = cheerio.load(data.content, { decodeEntities: true })</span></span><span id="cb9-10"><a href="#cb9-10"></a><span class="va">+  var $ = cheerio.load(data.content, { decodeEntities: false })</span></span><span id="cb9-11"><a href="#cb9-11"></a> </span><span id="cb9-12"><a href="#cb9-12"></a>   if ($(&#39;.math&#39;).length &gt; 0) {</span><span id="cb9-13"><a href="#cb9-13"></a>     linkTag = util.htmlTag(&#39;link&#39;, {</span></code></pre></div><h3 id="应用更改">应用更改</h3><p>只要将上述生成的文件提交到版本控制系统，在其他环境安装依赖时直接使用 <code>yarn install</code> 或 <code>npm install</code> 即可同步修改。</p><section class="footnotes" role="doc-endnotes"><hr><ol><li id="fn1" role="doc-endnote"><p><a href="https://github.com/hexojs/hexo/issues/657" target="_blank" rel="noopener">https://github.com/hexojs/hexo/issues/657</a> "網頁能正常顯示中文，但查看HTML源代碼卻出現亂碼"<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li></ol></section>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;偶然发现博客正文中的中文都被编码成了 &lt;a href=&quot;https://zh.wikipedia.org/wiki/%E5%AD%97%E7%AC%A6%E5%AE%9E%E4%BD%93%E5%BC%95%E7%94%A8&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;HTML 字符实体&lt;/a&gt;，也就是中文「静」被编码为 &lt;code&gt;&amp;amp;#x9759;&lt;/code&gt;，在 UTF-8 中一个中文字符由三个字符编码，而转成 HTML 字符实体后一个中文字符占 8 个字节，增加了 167%。一篇博客正文占据主要部分，四舍五入，转换后 HTML 文件体积比直接使用 UFT-8 编码大了一倍。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Hexo" scheme="https://blog.dreace.top/categories/Hexo/"/>
    
    
      <category term="Hexo" scheme="https://blog.dreace.top/tags/Hexo/"/>
    
      <category term="JavaScript" scheme="https://blog.dreace.top/tags/JavaScript/"/>
    
      <category term="npm" scheme="https://blog.dreace.top/tags/npm/"/>
    
  </entry>
  
  <entry>
    <title>Python 手动实现数字验证码识别</title>
    <link href="https://blog.dreace.top/2020/Use-Python-to-Manually-Realize-Mumeral-Verification-Code-Recognition/"/>
    <id>https://blog.dreace.top/2020/Use-Python-to-Manually-Realize-Mumeral-Verification-Code-Recognition/</id>
    <published>2020-07-27T14:11:37.000Z</published>
    <updated>2020-08-14T09:53:33.249Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.css" integrity="sha384-dbVIfZGuN1Yq7/1Ocstc1lUEm+AT+/rCkibIcC/OmWo5f0EA48Vf8CytHzGrSwbQ" crossorigin="anonymous"><p>（迁移文章，本文写于2019年8月3日）本人维护的一个项目 <a href="https://github.com/Dreace/NUC-Information" target="_blank" rel="noopener">中北信息</a> 小程序需要模拟登录来获取信息，这就需要在后台识别验证码。需要识别的验证码比较简单且为纯数字，有简单到可以忽略不计的变形，像下面这个样子。</p><a id="more"></a><figure><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/Use-Python-to-Manually-Realize-Mumeral-Verification-Code-Recognition/example.png" alt><figcaption>验证码样例</figcaption></figure><p>可以看到稍微有一点噪点，应该是压缩解压过程造成的（<a href="https://zh.wikipedia.org/zh-cn/JPEG" target="_blank" rel="noopener">JPG</a> 是有损压缩）。</p><p>这是近乎标准印刷体的四位数字，只是有稍微倾斜，最开始想到的办法是 OCR 。</p><p>最初使用 <a href="https://github.com/tesseract-ocr/tesseract" target="_blank" rel="noopener">Tesseract</a> 进行本地 OCR 。效果不是很理想，重要问题是 Tesseract 是通用 OCR，他会识别所有的英文字符和标点，这就造成大量的识别不准确。而且 Tesseract 是一个神经网络，在本地运行相当耗费资源。在平时可以应付大部分情况，但在访问高峰时会消耗大量时间在多个识别线程中切换，甚至直接造成服务器宕机。 在没有新的解决方案之前使用了接近一年，只能说勉强能用。</p><p>前不久，发现百度云的 OCR 提供每天 5 万次的免费调用，测试发现可以使用且效果不错。使用一段时间后发现一些问题，异步的调用方式造成的延迟不可忽略，尤其是网络延迟。测试发现这个解决方案每个验证码识别有将近 1s 的网络延迟，这使得后台响应时间被延长，影响用户体验。虽然百度云不会将数字识别成其他字符，但经常出现只识别出两位数字的情况造成大量重试，更加影响性能。</p><p>两度更换解决方案后，还是没能找到令人满意的方案。决定自己实现验证码的识别，这里不需要训练神经网络，直接通过规则匹配能得到很好的性能与效果，最终单个验证码识别时间为 4-5ms，正确率 100%。</p><p>识别步骤如下：</p><ol type="1"><li>灰度化</li><li>二值化</li><li>切割为单个数字</li><li>和字库对比</li></ol><h2 id="导入需要用到库">导入需要用到库</h2><div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="im">import</span> math</span><span id="cb1-2"><a href="#cb1-2"></a><span class="im">import</span> time</span><span id="cb1-3"><a href="#cb1-3"></a><span class="im">from</span> io <span class="im">import</span> BytesIO</span><span id="cb1-4"><a href="#cb1-4"></a></span><span id="cb1-5"><a href="#cb1-5"></a><span class="im">import</span> numpy <span class="im">as</span> np</span><span id="cb1-6"><a href="#cb1-6"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span><span id="cb1-7"><a href="#cb1-7"></a></span><span id="cb1-8"><a href="#cb1-8"></a><span class="im">import</span> data</span></code></pre></div><p>最后一行导入的是字库，后面会写到。</p><h2 id="灰度化">灰度化</h2><p>从之前的例子可以看到图像有一些噪点，为了不让其干扰识别需要进行降噪处理，第一步是将图片灰度化。所谓灰度化是将 RGB 色彩空间中三个量合并成一个量 L，这样原本的彩色图像变成灰度图了。每个像素的取值也由 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>25</mn><msup><mn>6</mn><mn>3</mn></msup></mrow><annotation encoding="application/x-tex">256^{3}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord">5</span><span class="mord"><span class="mord">6</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span></span></span></span></span>（16777216）个减少到 256 个，能够减少后继的计算量。将上面的图片灰度化之后变成下面的样子。</p><figure><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/Use-Python-to-Manually-Realize-Mumeral-Verification-Code-Recognition/图2.png" alt><figcaption>灰度化后</figcaption></figure><p>处理代码：</p><div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># 灰度处理并创建二维矩阵</span></span><span id="cb2-2"><a href="#cb2-2"></a>img_matrix <span class="op">=</span> np.array(Image.<span class="bu">open</span>(BytesIO(image_bytes)).convert(<span class="st">&quot;L&quot;</span>))</span></code></pre></div><p>其中 <code>Image.open(BytesIO(image_bytes)).convert("L")</code> 是从 <code>image_bytes</code> 中创建图像并转为灰度图， <code>image_bytes</code>  可以是从网络加载或从本地文件读入的字节数据。然后根据灰度图创建一个 <a href="https://numpy.org/" target="_blank" rel="noopener">NumPy</a> 矩阵方便后面的运算。</p><p>灰度化之后与原图好像没有区别是因为原图本身是黑白的，如果原图是彩色的话能够很明显地看出区别。</p><h2 id="二值化">二值化</h2><p>二值化是将图像的像素与某个阈值比较，若大于这个阈值则设置为灰度最大值（这里是 1，白色），小于某个值则设为灰度最小值（这里是 0，黑色）。这样上一步的灰度图就转化为二值图，便于接下来的图像分割。选择合适的阈值还可以去除图像噪点。</p><figure><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/Use-Python-to-Manually-Realize-Mumeral-Verification-Code-Recognition/图3-1595862311679.png" alt><figcaption>二值化后</figcaption></figure><p>二值化后噪点已经完全消失，数字的边界更加锐利。</p><p>处理代码：</p><div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># 获取矩阵（图像）的长宽</span></span><span id="cb3-2"><a href="#cb3-2"></a>rows, cols <span class="op">=</span> img_matrix.shape</span><span id="cb3-3"><a href="#cb3-3"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(rows):</span><span id="cb3-4"><a href="#cb3-4"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(cols):</span><span id="cb3-5"><a href="#cb3-5"></a>        <span class="co"># 与阈值比较</span></span><span id="cb3-6"><a href="#cb3-6"></a>        <span class="cf">if</span> img_matrix[i, j] <span class="op">&lt;=</span> <span class="dv">128</span>:</span><span id="cb3-7"><a href="#cb3-7"></a>            <span class="co"># 设为灰度最小值</span></span><span id="cb3-8"><a href="#cb3-8"></a>            img_matrix[i, j] <span class="op">=</span> <span class="dv">0</span></span><span id="cb3-9"><a href="#cb3-9"></a>        <span class="cf">else</span>:</span><span id="cb3-10"><a href="#cb3-10"></a>            <span class="co"># 设为灰度最大值</span></span><span id="cb3-11"><a href="#cb3-11"></a>            img_matrix[i, j] <span class="op">=</span> <span class="dv">1</span></span></code></pre></div><h2 id="切割为单个数字">切割为单个数字</h2><p>二值化后可以看到图像中有大量的空白，这对于识别会造成一些影响，并且对比多个验证码发现数字的垂直位置并非固定，也就是上下边距是浮动的。因此要将空白部分删掉只保留有图像的部分 。 先看实现：</p><div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># 每行最小值</span></span><span id="cb4-2"><a href="#cb4-2"></a>row_min <span class="op">=</span> np.<span class="bu">min</span>(img_matrix, axis<span class="op">=</span><span class="dv">1</span>)</span><span id="cb4-3"><a href="#cb4-3"></a><span class="co"># 找到第一个有图像的行</span></span><span id="cb4-4"><a href="#cb4-4"></a>row_start <span class="op">=</span> np.argmin(row_min)</span><span id="cb4-5"><a href="#cb4-5"></a><span class="co"># 找到最后一个有图像的行</span></span><span id="cb4-6"><a href="#cb4-6"></a>row_end <span class="op">=</span> np.argmin(np.flip(row_min))</span><span id="cb4-7"><a href="#cb4-7"></a><span class="co"># 只取有图像的行</span></span><span id="cb4-8"><a href="#cb4-8"></a>img_matrix <span class="op">=</span> img_matrix[row_start:<span class="op">-</span>row_end, :]</span></code></pre></div><figure><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/Use-Python-to-Manually-Realize-Mumeral-Verification-Code-Recognition/图4.png" alt><figcaption>去除上下空白</figcaption></figure><p><code>row_min</code> 的值为</p><div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a>[<span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span>]</span></code></pre></div><p>其中 1 表示该行最小值为 1 ，在本例中表示这一行都是 1 ，即没有黑色像素。0 则表示这一行有 0 的存在，即存在黑色像素，也就是这一行有图像，需要保留。<code>np.argmin()</code> 在 <code>row_min</code> 中查找最小值第一次出现的位置，即为图像开始行。将 <code>row_min</code> 反转之后再次查找最小值下标就得到了结束下标，这个下标的是从右向左计数的。 得到 <code>row_start</code> 和 <code>row_end</code> 后对矩阵进行切片，<code>row_end</code> 要取负值表示表示从右开始计数。</p><p>接下来将数字切片成单个：</p><div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a>codes <span class="op">=</span> [<span class="dv">0</span>] <span class="op">*</span> <span class="dv">4</span></span><span id="cb6-2"><a href="#cb6-2"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>):</span><span id="cb6-3"><a href="#cb6-3"></a>    <span class="co"># 切片</span></span><span id="cb6-4"><a href="#cb6-4"></a>    imag_matrix_spited <span class="op">=</span> img_matrix[:, <span class="dv">19</span> <span class="op">*</span> i:<span class="dv">19</span> <span class="op">*</span> (i <span class="op">+</span> <span class="dv">1</span>)]</span><span id="cb6-5"><a href="#cb6-5"></a>    col_min <span class="op">=</span> np.<span class="bu">min</span>(imag_matrix_spited, axis<span class="op">=</span><span class="dv">0</span>)</span><span id="cb6-6"><a href="#cb6-6"></a>    col_start <span class="op">=</span> np.argmin(col_min)</span><span id="cb6-7"><a href="#cb6-7"></a>    col_end <span class="op">=</span> np.argmin(np.flip(col_min))</span><span id="cb6-8"><a href="#cb6-8"></a>    <span class="co"># 图像宽度</span></span><span id="cb6-9"><a href="#cb6-9"></a>    width <span class="op">=</span> col_min.shape[<span class="dv">0</span>] <span class="op">-</span> (col_start <span class="op">+</span> col_end)</span><span id="cb6-10"><a href="#cb6-10"></a>    <span class="co"># 宽度扩宽到 9 像素</span></span><span id="cb6-11"><a href="#cb6-11"></a>    width_rest <span class="op">=</span> <span class="dv">9</span> <span class="op">-</span> width</span><span id="cb6-12"><a href="#cb6-12"></a>    <span class="co"># 左边界</span></span><span id="cb6-13"><a href="#cb6-13"></a>    col_start <span class="op">-=</span> <span class="bu">int</span>(math.ceil(width_rest <span class="op">/</span> <span class="fl">2.0</span>))</span><span id="cb6-14"><a href="#cb6-14"></a>    <span class="co"># 右边界</span></span><span id="cb6-15"><a href="#cb6-15"></a>    col_end <span class="op">-=</span> <span class="bu">int</span>(math.floor(width_rest <span class="op">/</span> <span class="fl">2.0</span>))</span><span id="cb6-16"><a href="#cb6-16"></a>    <span class="co"># 裁剪为 9 像素宽的图像</span></span><span id="cb6-17"><a href="#cb6-17"></a>    imag_matrix_spited <span class="op">=</span> imag_matrix_spited[:, col_start:<span class="op">-</span>col_end]</span></code></pre></div><p>先粗略裁剪为每个数字 20 像素，然后再判断左边界和右边界，同之前一样的算法。但是这里不能直接使用得到的边界，每个数字的宽度不一样，直接切片会导致矩阵大小不一样，会影响之后的计算。因此要将将宽度统一为 9 像素，即为最宽的数字宽度。</p><figure><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/Use-Python-to-Manually-Realize-Mumeral-Verification-Code-Recognition/图5-1.png" alt><figcaption>切片结果-8</figcaption></figure><figure><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/Use-Python-to-Manually-Realize-Mumeral-Verification-Code-Recognition/图5-2.png" alt><figcaption>切片结果-4</figcaption></figure><figure><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/Use-Python-to-Manually-Realize-Mumeral-Verification-Code-Recognition/图5-3.png" alt><figcaption>切片结果-0</figcaption></figure><figure><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/Use-Python-to-Manually-Realize-Mumeral-Verification-Code-Recognition/图5-4.png" alt><figcaption>切片结果-3</figcaption></figure><h2 id="和字库对比">和字库对比</h2><div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a>res <span class="op">=</span> [<span class="dv">0</span>] <span class="op">*</span> <span class="dv">10</span></span><span id="cb7-2"><a href="#cb7-2"></a><span class="co"># 展开成一维</span></span><span id="cb7-3"><a href="#cb7-3"></a>x <span class="op">=</span> imag_matrix_spited.flatten()</span><span id="cb7-4"><a href="#cb7-4"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>):</span><span id="cb7-5"><a href="#cb7-5"></a>    <span class="co"># 一次取字库中标准数据</span></span><span id="cb7-6"><a href="#cb7-6"></a>    y <span class="op">=</span> data.array_map[j]</span><span id="cb7-7"><a href="#cb7-7"></a>    <span class="co"># 通过异或计算不同元素的数量</span></span><span id="cb7-8"><a href="#cb7-8"></a>    res[j] <span class="op">=</span> np.<span class="bu">sum</span>(x <span class="op">^</span> y)</span><span id="cb7-9"><a href="#cb7-9"></a>    <span class="co"># 取差异最小的下标</span></span><span id="cb7-10"><a href="#cb7-10"></a>codes[i] <span class="op">=</span> <span class="bu">str</span>(np.argmin(res))</span></code></pre></div><p>首先将原先的二维矩阵展开为一维，再与字库中的数据对比找到差异最小的那个既是最终结果，这样整个验证码就识别出来了。字库则需要将展开后的矩阵按照顺序整理一下得到。</p><p>下面是针对这种验证码的字库（0~9）：</p><div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span><span id="cb8-2"><a href="#cb8-2"></a></span><span id="cb8-3"><a href="#cb8-3"></a>array_map <span class="op">=</span> [<span class="dv">0</span>] <span class="op">*</span> <span class="dv">10</span></span><span id="cb8-4"><a href="#cb8-4"></a>array_map[<span class="dv">0</span>] <span class="op">=</span> np.array(</span><span id="cb8-5"><a href="#cb8-5"></a>    [<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>,</span><span id="cb8-6"><a href="#cb8-6"></a>     <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>,</span><span id="cb8-7"><a href="#cb8-7"></a>     <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>])</span><span id="cb8-8"><a href="#cb8-8"></a>array_map[<span class="dv">1</span>] <span class="op">=</span> np.array(</span><span id="cb8-9"><a href="#cb8-9"></a>    [<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>,</span><span id="cb8-10"><a href="#cb8-10"></a>     <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>,</span><span id="cb8-11"><a href="#cb8-11"></a>     <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>])</span><span id="cb8-12"><a href="#cb8-12"></a>array_map[<span class="dv">2</span>] <span class="op">=</span> np.array(</span><span id="cb8-13"><a href="#cb8-13"></a>    [<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>,</span><span id="cb8-14"><a href="#cb8-14"></a>     <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>,</span><span id="cb8-15"><a href="#cb8-15"></a>     <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>])</span><span id="cb8-16"><a href="#cb8-16"></a>array_map[<span class="dv">3</span>] <span class="op">=</span> np.array(</span><span id="cb8-17"><a href="#cb8-17"></a>    [<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>,</span><span id="cb8-18"><a href="#cb8-18"></a>     <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>,</span><span id="cb8-19"><a href="#cb8-19"></a>     <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>])</span><span id="cb8-20"><a href="#cb8-20"></a>array_map[<span class="dv">4</span>] <span class="op">=</span> np.array(</span><span id="cb8-21"><a href="#cb8-21"></a>    [<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>,</span><span id="cb8-22"><a href="#cb8-22"></a>     <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,</span><span id="cb8-23"><a href="#cb8-23"></a>     <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>])</span><span id="cb8-24"><a href="#cb8-24"></a>array_map[<span class="dv">5</span>] <span class="op">=</span> np.array(</span><span id="cb8-25"><a href="#cb8-25"></a>    [<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>,</span><span id="cb8-26"><a href="#cb8-26"></a>     <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>,</span><span id="cb8-27"><a href="#cb8-27"></a>     <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>])</span><span id="cb8-28"><a href="#cb8-28"></a>array_map[<span class="dv">6</span>] <span class="op">=</span> np.array(</span><span id="cb8-29"><a href="#cb8-29"></a>    [<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>,</span><span id="cb8-30"><a href="#cb8-30"></a>     <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>,</span><span id="cb8-31"><a href="#cb8-31"></a>     <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>])</span><span id="cb8-32"><a href="#cb8-32"></a>array_map[<span class="dv">7</span>] <span class="op">=</span> np.array(</span><span id="cb8-33"><a href="#cb8-33"></a>    [<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>,</span><span id="cb8-34"><a href="#cb8-34"></a>     <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>,</span><span id="cb8-35"><a href="#cb8-35"></a>     <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>])</span><span id="cb8-36"><a href="#cb8-36"></a>array_map[<span class="dv">8</span>] <span class="op">=</span> np.array(</span><span id="cb8-37"><a href="#cb8-37"></a>    [<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>,</span><span id="cb8-38"><a href="#cb8-38"></a>     <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>,</span><span id="cb8-39"><a href="#cb8-39"></a>     <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>])</span><span id="cb8-40"><a href="#cb8-40"></a>array_map[<span class="dv">9</span>] <span class="op">=</span> np.array(</span><span id="cb8-41"><a href="#cb8-41"></a>    [<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>,</span><span id="cb8-42"><a href="#cb8-42"></a>     <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>,</span><span id="cb8-43"><a href="#cb8-43"></a>     <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>])</span></code></pre></div><p>至此验证码识别成功。</p><h2 id="最后">最后</h2><p>完整的代码和一百个测试验证码可以在 <a href="https://github.com/Dreace/IVC" target="_blank" rel="noopener">Dreace/IVC</a> 找到。</p><p>要求环境为 Python 3+，运行前请先安装 <code>requirements.txt</code> 中的依赖。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;（迁移文章，本文写于2019年8月3日）本人维护的一个项目 &lt;a href=&quot;https://github.com/Dreace/NUC-Information&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;中北信息&lt;/a&gt; 小程序需要模拟登录来获取信息，这就需要在后台识别验证码。需要识别的验证码比较简单且为纯数字，有简单到可以忽略不计的变形，像下面这个样子。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Python" scheme="https://blog.dreace.top/categories/Python/"/>
    
    
      <category term="网络" scheme="https://blog.dreace.top/tags/%E7%BD%91%E7%BB%9C/"/>
    
      <category term="Python" scheme="https://blog.dreace.top/tags/Python/"/>
    
      <category term="验证码识别" scheme="https://blog.dreace.top/tags/%E9%AA%8C%E8%AF%81%E7%A0%81%E8%AF%86%E5%88%AB/"/>
    
  </entry>
  
  <entry>
    <title>使用 TypeScript 编写命令行工具并发布到 npm</title>
    <link href="https://blog.dreace.top/2020/Use-TypeScript-to-Write-Command-Line-Tools-and-Publish-to-npm/"/>
    <id>https://blog.dreace.top/2020/Use-TypeScript-to-Write-Command-Line-Tools-and-Publish-to-npm/</id>
    <published>2020-07-25T02:01:41.000Z</published>
    <updated>2020-08-14T09:53:33.249Z</updated>
    
    <content type="html"><![CDATA[<p>最近在研究优化在国内访问静态博客的时间，其中有一个方案是将生成的文件存储在对象存储，然后再通过 CDN 回源对象存储。确定方案后使用 <a href="https://www.qiniu.com/" target="_blank" rel="noopener">七牛云</a> 做一个加速实验，由于要将生成的文件上传，又要将这个过程尽可能自动化，而七牛云只提供 SDK，要上传只能将密钥硬编码在代码中，这是很危险的。</p><p>因此有了编写一个命令行工具的想法，由于最近在学习 TypeScript，就决定用它来写。</p><a id="more"></a><h2 id="准备环境">准备环境</h2><p>在开始编写逻辑代码前需要准备一下开发环境。</p><p>首先初始化项目<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>：</p><pre class="shell"><code>yarn init -y</code></pre><p>本文将使用 yarn 作为包管理工具。</p><p>安装 TypeScript 支持：</p><pre class="shell"><code>yarn add global typescript ts-node-dev</code></pre><p><code>ts-node-dev</code> 可以直接启动 <code>.ts</code> 文件，如果使用 <code>tsc &amp;&amp; node "path/to/file.js"</code> 自行编译并启动则不需要这个依赖。</p><p>这两个依赖需要全局安装，因为他们分别提供 <code>tsc</code> 和 <code>ts-node-dev</code> 命令。</p><p>安装 Node.js 类型声明文件：</p><pre class="shell"><code>yarn add --dev @types/node</code></pre><p>以上是必备的开发依赖，除此还可以使用 ESLint 和 Prettier 来检查语法和规范格式。</p><p>以下配置内容均为可选，可以单独使用或组合使用。</p><h3 id="使用-eslint2">使用 ESLint<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></h3><p>ESLint 可以静态分析代码，能够尽早发现编码中的错误。</p><p>首先安装需要的依赖：</p><pre class="shell"><code>yarn add --dev @typescript-eslint/parser @typescript-eslint/eslint-plugin</code></pre><p>在根目录下创建 <code>.eslintrc.js</code> 文件并写入：</p><div class="sourceCode" id="cb5"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1"></a><span class="va">module</span>.<span class="at">exports</span> <span class="op">=</span> <span class="op">{</span></span><span id="cb5-2"><a href="#cb5-2"></a>    <span class="dt">parser</span><span class="op">:</span> <span class="st">&#39;@typescript-eslint/parser&#39;</span><span class="op">,</span></span><span id="cb5-3"><a href="#cb5-3"></a>    <span class="dt">extends</span><span class="op">:</span> [<span class="st">&#39;plugin:@typescript-eslint/recommended&#39;</span>]<span class="op">,</span></span><span id="cb5-4"><a href="#cb5-4"></a>    <span class="dt">plugins</span><span class="op">:</span> [<span class="st">&#39;@typescript-eslint&#39;</span>]<span class="op">,</span></span><span id="cb5-5"><a href="#cb5-5"></a>    <span class="dt">env</span><span class="op">:</span> <span class="op">{</span></span><span id="cb5-6"><a href="#cb5-6"></a>        <span class="dt">node</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span><span id="cb5-7"><a href="#cb5-7"></a>    <span class="op">}</span></span><span id="cb5-8"><a href="#cb5-8"></a><span class="op">}</span></span></code></pre></div><p>更多的配置可以查看 <a href="https://eslint.org/docs/user-guide/configuring" target="_blank" rel="noopener">Configuring ESLint</a>。</p><h3 id="使用-prettier">使用 Prettier</h3><p>Prettier 可以通过配置文件来格式化代码，非常适合团队内规范代码。</p><p>首先安装 Prettier：</p><pre class="shell"><code>yarn add --dev prettier</code></pre><p>在根目录下创建 <code>prettier.config.js</code> 文件，并写入<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>：</p><div class="sourceCode" id="cb7"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb7-1"><a href="#cb7-1"></a><span class="va">module</span>.<span class="at">exports</span> <span class="op">=</span> <span class="op">{</span></span><span id="cb7-2"><a href="#cb7-2"></a>  <span class="co">// 一行最多 100 字符</span></span><span id="cb7-3"><a href="#cb7-3"></a>  <span class="dt">printWidth</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span></span><span id="cb7-4"><a href="#cb7-4"></a>  <span class="co">// 使用 4 个空格缩进</span></span><span id="cb7-5"><a href="#cb7-5"></a>  <span class="dt">tabWidth</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span><span id="cb7-6"><a href="#cb7-6"></a>  <span class="co">// 不使用缩进符，而使用空格</span></span><span id="cb7-7"><a href="#cb7-7"></a>  <span class="dt">useTabs</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span><span id="cb7-8"><a href="#cb7-8"></a>  <span class="co">// 行尾需要有分号</span></span><span id="cb7-9"><a href="#cb7-9"></a>  <span class="dt">semi</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span><span id="cb7-10"><a href="#cb7-10"></a>  <span class="co">// 使用单引号</span></span><span id="cb7-11"><a href="#cb7-11"></a>  <span class="dt">singleQuote</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span><span id="cb7-12"><a href="#cb7-12"></a>  <span class="co">// 对象的 key 仅在必要时用引号</span></span><span id="cb7-13"><a href="#cb7-13"></a>  <span class="dt">quoteProps</span><span class="op">:</span> <span class="st">&#39;as-needed&#39;</span><span class="op">,</span></span><span id="cb7-14"><a href="#cb7-14"></a>  <span class="co">// jsx 不使用单引号，而使用双引号</span></span><span id="cb7-15"><a href="#cb7-15"></a>  <span class="dt">jsxSingleQuote</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span><span id="cb7-16"><a href="#cb7-16"></a>  <span class="co">// 末尾不需要逗号</span></span><span id="cb7-17"><a href="#cb7-17"></a>  <span class="dt">trailingComma</span><span class="op">:</span> <span class="st">&#39;all&#39;</span><span class="op">,</span></span><span id="cb7-18"><a href="#cb7-18"></a>  <span class="co">// 大括号内的首尾需要空格</span></span><span id="cb7-19"><a href="#cb7-19"></a>  <span class="dt">bracketSpacing</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span><span id="cb7-20"><a href="#cb7-20"></a>  <span class="co">// jsx 标签的反尖括号需要换行</span></span><span id="cb7-21"><a href="#cb7-21"></a>  <span class="dt">jsxBracketSameLine</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span><span id="cb7-22"><a href="#cb7-22"></a>  <span class="co">// 箭头函数，只有一个参数的时候，也需要括号</span></span><span id="cb7-23"><a href="#cb7-23"></a>  <span class="dt">arrowParens</span><span class="op">:</span> <span class="st">&#39;always&#39;</span><span class="op">,</span></span><span id="cb7-24"><a href="#cb7-24"></a>  <span class="co">// 每个文件格式化的范围是文件的全部内容</span></span><span id="cb7-25"><a href="#cb7-25"></a>  <span class="dt">rangeStart</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span><span id="cb7-26"><a href="#cb7-26"></a>  <span class="dt">rangeEnd</span><span class="op">:</span> <span class="kw">Infinity</span><span class="op">,</span></span><span id="cb7-27"><a href="#cb7-27"></a>  <span class="co">// 不需要写文件开头的 @prettier</span></span><span id="cb7-28"><a href="#cb7-28"></a>  <span class="dt">requirePragma</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span><span id="cb7-29"><a href="#cb7-29"></a>  <span class="co">// 不需要自动在文件开头插入 @prettier</span></span><span id="cb7-30"><a href="#cb7-30"></a>  <span class="dt">insertPragma</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span><span id="cb7-31"><a href="#cb7-31"></a>  <span class="co">// 使用默认的折行标准</span></span><span id="cb7-32"><a href="#cb7-32"></a>  <span class="dt">proseWrap</span><span class="op">:</span> <span class="st">&#39;preserve&#39;</span><span class="op">,</span></span><span id="cb7-33"><a href="#cb7-33"></a>  <span class="co">// 根据显示样式决定 html 要不要折行</span></span><span id="cb7-34"><a href="#cb7-34"></a>  <span class="dt">htmlWhitespaceSensitivity</span><span class="op">:</span> <span class="st">&#39;css&#39;</span><span class="op">,</span></span><span id="cb7-35"><a href="#cb7-35"></a>  <span class="co">// 换行符使用 lf</span></span><span id="cb7-36"><a href="#cb7-36"></a>  <span class="dt">endOfLine</span><span class="op">:</span> <span class="st">&#39;lf&#39;</span><span class="op">,</span></span><span id="cb7-37"><a href="#cb7-37"></a><span class="op">};</span></span></code></pre></div><p>更多配置可查看 <a href="https://prettier.io/docs/en/index.html" target="_blank" rel="noopener">What is Prettier?</a>。</p><h3 id="在-webstorm-中启用-eslint-和-prettier">在 WebStorm 中启用 ESLint 和 Prettier</h3><h4 id="启用-eslint">启用 ESLint</h4><p>找到 File | Settings | Languages &amp; Frameworks | JavaScript | Code Quality Tools | ESLint 配置项，选择 Automatic ESLint configuration。</p><p>WebStorm 会自动查找 ESLint 路径并执行检查。</p><h4 id="启用-prettier">启用 Prettier</h4><p>找到 File | Settings | Languages &amp; Frameworks | JavaScript | Prettier 配置项，选择 Prettier 路径，可以勾选 Run on save for files，在保存时自动执行检查。</p><h4 id="使用-editorconfig">使用 EditorConfig</h4><p>EditorConfig 可以通过配置文件来指定不同 IDE 或编辑器的代码格式化行为，在编码期间就能根据团队规范格式化代码。</p><p>WebStorm 已经内置实现 EditorConfig 支持，在根目录创建 <code>.editorconfig</code> 文件，并写入：</p><div class="sourceCode" id="cb8"><pre class="sourceCode ini"><code class="sourceCode ini"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># http://editorconfig.org</span></span><span id="cb8-2"><a href="#cb8-2"></a><span class="dt">root </span><span class="ot">=</span><span class="st"> </span><span class="kw">true</span></span><span id="cb8-3"><a href="#cb8-3"></a></span><span id="cb8-4"><a href="#cb8-4"></a><span class="kw">[*]</span></span><span id="cb8-5"><a href="#cb8-5"></a><span class="dt">indent_style </span><span class="ot">=</span><span class="st"> space</span></span><span id="cb8-6"><a href="#cb8-6"></a><span class="dt">indent_size </span><span class="ot">=</span><span class="st"> </span><span class="dv">2</span></span><span id="cb8-7"><a href="#cb8-7"></a><span class="dt">end_of_line </span><span class="ot">=</span><span class="st"> lf</span></span><span id="cb8-8"><a href="#cb8-8"></a><span class="dt">charset </span><span class="ot">=</span><span class="st"> utf</span><span class="dv">-8</span></span><span id="cb8-9"><a href="#cb8-9"></a><span class="dt">trim_trailing_whitespace </span><span class="ot">=</span><span class="st"> </span><span class="kw">true</span></span><span id="cb8-10"><a href="#cb8-10"></a><span class="dt">insert_final_newline </span><span class="ot">=</span><span class="st"> </span><span class="kw">true</span></span><span id="cb8-11"><a href="#cb8-11"></a></span><span id="cb8-12"><a href="#cb8-12"></a><span class="kw">[*.md]</span></span><span id="cb8-13"><a href="#cb8-13"></a><span class="dt">trim_trailing_whitespace </span><span class="ot">=</span><span class="st"> </span><span class="kw">false</span></span><span id="cb8-14"><a href="#cb8-14"></a></span><span id="cb8-15"><a href="#cb8-15"></a><span class="kw">[*.ts]</span></span><span id="cb8-16"><a href="#cb8-16"></a><span class="dt">ij_typescript_spaces_within_imports </span><span class="ot">=</span><span class="st"> </span><span class="kw">true</span></span><span id="cb8-17"><a href="#cb8-17"></a></span><span id="cb8-18"><a href="#cb8-18"></a><span class="kw">[Makefile]</span></span><span id="cb8-19"><a href="#cb8-19"></a><span class="dt">indent_style </span><span class="ot">=</span><span class="st"> tab</span></span></code></pre></div><p>以上配置效果和 Prettier 相同，更多配置可查看 <a href="https://editorconfig.org/#overview" target="_blank" rel="noopener">EditorConfig</a>。</p><h3 id="配置-typescript">配置 TypeScript</h3><p>在根目录下创建 <code>tsconfig.json</code> 文件，并写入：</p><div class="sourceCode" id="cb9"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb9-1"><a href="#cb9-1"></a><span class="fu">{</span></span><span id="cb9-2"><a href="#cb9-2"></a>  <span class="dt">&quot;compilerOptions&quot;</span><span class="fu">:</span> <span class="fu">{</span></span><span id="cb9-3"><a href="#cb9-3"></a>    <span class="dt">&quot;target&quot;</span><span class="fu">:</span> <span class="st">&quot;es5&quot;</span><span class="fu">,</span></span><span id="cb9-4"><a href="#cb9-4"></a>    <span class="dt">&quot;module&quot;</span><span class="fu">:</span> <span class="st">&quot;commonjs&quot;</span><span class="fu">,</span></span><span id="cb9-5"><a href="#cb9-5"></a>    <span class="dt">&quot;outDir&quot;</span><span class="fu">:</span> <span class="st">&quot;./dist&quot;</span><span class="fu">,</span></span><span id="cb9-6"><a href="#cb9-6"></a>    <span class="dt">&quot;strict&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span><span id="cb9-7"><a href="#cb9-7"></a>    <span class="dt">&quot;esModuleInterop&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span><span id="cb9-8"><a href="#cb9-8"></a>    <span class="dt">&quot;skipLibCheck&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span><span id="cb9-9"><a href="#cb9-9"></a>    <span class="dt">&quot;forceConsistentCasingInFileNames&quot;</span><span class="fu">:</span> <span class="kw">true</span></span><span id="cb9-10"><a href="#cb9-10"></a>  <span class="fu">}</span></span><span id="cb9-11"><a href="#cb9-11"></a><span class="fu">}</span></span></code></pre></div><p><code>outDir</code> 指定 <code>tsc</code> 命令编译结果输出路径。</p><h2 id="编写代码">编写代码</h2><h3 id="使用-commander.js">使用 Commander.js</h3><p>要编写的是命令行工具，自然要解析命令行参数，出于不重复造轮子的目的选择 <a href="https://github.com/tj/commander.js" target="_blank" rel="noopener">Commander.js</a> 来解析命令行参数。</p><p>安装 Commander.js：</p><pre class="shell"><code>yarn add commander</code></pre><p>Commander.js 使用很简单，一个例子：</p><div class="sourceCode" id="cb11"><pre class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb11-1"><a href="#cb11-1"></a><span class="im">import</span> <span class="op">{</span> program <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;commander&#39;</span><span class="op">;</span></span><span id="cb11-2"><a href="#cb11-2"></a></span><span id="cb11-3"><a href="#cb11-3"></a>program</span><span id="cb11-4"><a href="#cb11-4"></a>  .<span class="fu">version</span>(<span class="st">&#39;1.0.3&#39;</span>)</span><span id="cb11-5"><a href="#cb11-5"></a>  .<span class="fu">name</span>(<span class="st">&#39;upload-to-qiniu&#39;</span>)</span><span id="cb11-6"><a href="#cb11-6"></a>  .<span class="fu">requiredOption</span>(<span class="st">&#39;-a, --access-key [ak]&#39;</span><span class="op">,</span> <span class="st">&#39;access key&#39;</span>)</span><span id="cb11-7"><a href="#cb11-7"></a>  .<span class="fu">requiredOption</span>(<span class="st">&#39;-s, --secret-key [sk]&#39;</span><span class="op">,</span> <span class="st">&#39;secret key&#39;</span>)</span><span id="cb11-8"><a href="#cb11-8"></a>  .<span class="fu">option</span>(<span class="st">&#39;-d, --upload-dir &lt;dir&gt;&#39;</span><span class="op">,</span> <span class="st">&#39;要上传的目录&#39;</span><span class="op">,</span> <span class="st">&#39;./&#39;</span>)</span><span id="cb11-9"><a href="#cb11-9"></a>  .<span class="fu">requiredOption</span>(<span class="st">&#39;-b, --bucket [bucket]&#39;</span><span class="op">,</span> <span class="st">&#39;对象存储空间名&#39;</span>)</span><span id="cb11-10"><a href="#cb11-10"></a>  .<span class="fu">option</span>(<span class="st">&#39;-e, --exclude-prefix &lt;prefixs...&gt;&#39;</span><span class="op">,</span> <span class="st">&#39;忽略的文件名前缀，可以设置多个&#39;</span>)</span><span id="cb11-11"><a href="#cb11-11"></a>  .<span class="fu">parse</span>()<span class="op">;</span></span></code></pre></div><p><code>import { program } from 'commander';</code> 导入全局对象，<code>version</code> 指定版本号，<code>name</code> 指定 <code>-h</code> 帮助信息的名称。</p><p><code>option</code> 定义选项，一共三个参数：</p><ul><li>第一个参数指定选项名称，指定选项的短名称和长名称，使用逗号、空格或 <code>|</code> 分割，必选</li><li>第二个参数为选项描述，可选</li><li>第三个参数为默认值，可选</li></ul><p><code>option</code> 定义的选项是非必选的，如需要定义必选选项可以使用 <code>requiredOption</code>，如果使用命令行时没有指定必选选项会有报错。</p><p>有两种最常用的选项，一类是 boolean 型选项，选项无需配置参数，另一类选项则可以设置参数（使用尖括号声明）。如果在命令行中不指定具体的选项及参数，则会被定义为 <code>undefined</code>。</p><p>代码中将长名称转化成小驼峰来获取用户指定的参数值，例如：</p><div class="sourceCode" id="cb12"><pre class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb12-1"><a href="#cb12-1"></a><span class="kw">const</span> mac <span class="op">=</span> <span class="kw">new</span> <span class="va">qiniu</span><span class="op">.</span><span class="va">auth</span><span class="op">.</span><span class="va">digest</span><span class="op">.</span><span class="fu">Mac</span>(<span class="va">program</span><span class="op">.</span><span class="at">accessKey</span><span class="op">,</span> <span class="va">program</span><span class="op">.</span><span class="at">secretKey</span>)<span class="op">;</span></span></code></pre></div><p><code>program.accessKey</code> 获取的是 <code>-a</code> 参数指定的值。</p><p>定义好选项后可以使用 <code>-h</code> 查看帮助信息：</p><pre class="text"><code>&gt; upload-to-qiniu -hUsage: upload-to-qiniu [options]Options:  -V, --version                      output the version number  -a, --access-key [ak]              access key  -s, --secret-key [sk]              secret key  -d, --upload-dir &lt;dir&gt;             要上传的目录 (default: &quot;./&quot;)  -b, --bucket [bucket]              对象存储空间名  -e, --exclude-prefix &lt;prefixs...&gt;  忽略的文件名前缀，可以设置多个  -h, --help                         display help for command</code></pre><h3 id="编写逻辑代码">编写逻辑代码</h3><p>做了这么多准备终于可以正式开始编写代码了，在根目录创建 <code>src</code> 目录，然后在其中编写代码即可。</p><p>每个项目具体细节有很大差异，这里就不写具体细节了，不过有一点要注意，入口文件首行一定要加上 <code>#!/usr/bin/env node</code> 来指定解释器，否则会使用系统解释器，在 Windows 下不能正常使用。</p><p>本文涉及的具体代码可以在 <a href="https://github.com/Dreace/upload-to-qiniu" target="_blank" rel="noopener">Dreace/upload-to-qiniu</a> 找到。</p><h2 id="发布-npm-包">发布 npm 包</h2><h3 id="填写包信息">填写包信息</h3><div class="sourceCode" id="cb14"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb14-1"><a href="#cb14-1"></a><span class="fu">{</span></span><span id="cb14-2"><a href="#cb14-2"></a>  <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;upload-to-qiniu&quot;</span><span class="fu">,</span></span><span id="cb14-3"><a href="#cb14-3"></a>  <span class="dt">&quot;version&quot;</span><span class="fu">:</span> <span class="st">&quot;1.0.4&quot;</span><span class="fu">,</span></span><span id="cb14-4"><a href="#cb14-4"></a>  <span class="dt">&quot;license&quot;</span><span class="fu">:</span> <span class="st">&quot;GPL-3.0&quot;</span><span class="fu">,</span></span><span id="cb14-5"><a href="#cb14-5"></a>  <span class="dt">&quot;main&quot;</span><span class="fu">:</span> <span class="st">&quot;dist/upload.js&quot;</span><span class="fu">,</span></span><span id="cb14-6"><a href="#cb14-6"></a>  <span class="dt">&quot;bin&quot;</span><span class="fu">:</span> <span class="fu">{</span></span><span id="cb14-7"><a href="#cb14-7"></a>    <span class="dt">&quot;upload-to-qiniu&quot;</span><span class="fu">:</span> <span class="st">&quot;dist/upload.js&quot;</span></span><span id="cb14-8"><a href="#cb14-8"></a>  <span class="fu">},</span></span><span id="cb14-9"><a href="#cb14-9"></a>  <span class="dt">&quot;scripts&quot;</span><span class="fu">:</span> <span class="fu">{</span></span><span id="cb14-10"><a href="#cb14-10"></a>    <span class="dt">&quot;lint&quot;</span><span class="fu">:</span> <span class="st">&quot;eslint src --fix --ext .ts&quot;</span></span><span id="cb14-11"><a href="#cb14-11"></a>  <span class="fu">},</span></span><span id="cb14-12"><a href="#cb14-12"></a>  <span class="dt">&quot;files&quot;</span><span class="fu">:</span> <span class="ot">[</span></span><span id="cb14-13"><a href="#cb14-13"></a>    <span class="st">&quot;dist/**/*.js&quot;</span></span><span id="cb14-14"><a href="#cb14-14"></a>  <span class="ot">]</span><span class="fu">,</span></span><span id="cb14-15"><a href="#cb14-15"></a>  <span class="dt">&quot;dependencies&quot;</span><span class="fu">:</span> <span class="fu">{</span></span><span id="cb14-16"><a href="#cb14-16"></a>    <span class="dt">&quot;commander&quot;</span><span class="fu">:</span> <span class="st">&quot;^6.0.0&quot;</span><span class="fu">,</span></span><span id="cb14-17"><a href="#cb14-17"></a>    <span class="dt">&quot;qiniu&quot;</span><span class="fu">:</span> <span class="st">&quot;^7.3.2&quot;</span></span><span id="cb14-18"><a href="#cb14-18"></a>  <span class="fu">},</span></span><span id="cb14-19"><a href="#cb14-19"></a>  <span class="dt">&quot;devDependencies&quot;</span><span class="fu">:</span> <span class="fu">{</span></span><span id="cb14-20"><a href="#cb14-20"></a>    <span class="dt">&quot;@types/node&quot;</span><span class="fu">:</span> <span class="st">&quot;^14.0.24&quot;</span><span class="fu">,</span></span><span id="cb14-21"><a href="#cb14-21"></a>    <span class="dt">&quot;@typescript-eslint/eslint-plugin&quot;</span><span class="fu">:</span> <span class="st">&quot;^3.7.0&quot;</span><span class="fu">,</span></span><span id="cb14-22"><a href="#cb14-22"></a>    <span class="dt">&quot;@typescript-eslint/parser&quot;</span><span class="fu">:</span> <span class="st">&quot;^3.7.0&quot;</span><span class="fu">,</span></span><span id="cb14-23"><a href="#cb14-23"></a>    <span class="dt">&quot;eslint&quot;</span><span class="fu">:</span> <span class="st">&quot;^7.5.0&quot;</span><span class="fu">,</span></span><span id="cb14-24"><a href="#cb14-24"></a>    <span class="dt">&quot;eslint-plugin-prettier&quot;</span><span class="fu">:</span> <span class="st">&quot;^3.1.4&quot;</span><span class="fu">,</span></span><span id="cb14-25"><a href="#cb14-25"></a>    <span class="dt">&quot;prettier&quot;</span><span class="fu">:</span> <span class="st">&quot;^2.0.5&quot;</span></span><span id="cb14-26"><a href="#cb14-26"></a>  <span class="fu">}</span></span><span id="cb14-27"><a href="#cb14-27"></a><span class="fu">}</span></span></code></pre></div><p><code>name</code> 指定包名，在 npm 中全局唯一，<code>version</code> 指定当前版本，<code>license</code> 指定许可证。</p><p><code>bin</code> 指定命令行和要执行的 <code>.js</code> 脚本对应关系，一个包可以提供多个命令行工具。</p><p><code>files</code> 指定打包时要包含的文件，除此 <code>README.md</code> 和 <code>LICENSE</code> 也会被打包。</p><h3 id="本地测试">本地测试</h3><p>编写完代码后需要安装为全局包进行测试。</p><pre class="shell"><code>npm i -g .</code></pre><p>将当前目录下的文件安装为全局包，安装后可以通过 <code>bin</code> 中指定的名称来使用。</p><h3 id="发布">发布</h3><p>首先 <a href="https://www.npmjs.com/signup" target="_blank" rel="noopener">注册一个 npm 账号</a>。然后使用 <code>npm login</code> 登录到 npm。</p><p>登录后使用 <code>npm publish</code> 发布包，输出信息大致如下：</p><pre class="text"><code>&gt; npm publishnpm noticenpm notice package: upload-to-qiniu@1.0.5npm notice === Tarball Contents ===npm notice 35.8kB LICENSEnpm notice 6.0kB  dist/upload.jsnpm notice 6.6kB  dist/utils.jsnpm notice 931B   package.jsonnpm notice 1.0kB  README.mdnpm notice === Tarball Details ===npm notice name:          upload-to-qiniunpm notice version:       1.0.5npm notice package size:  16.4 kBnpm notice unpacked size: 50.4 kBnpm notice shasum:        73b867074f514761f6c6c9a442c38e83bc18aa9anpm notice integrity:     sha512-qHdhXhV/JjzMv[...]x6wD4OY1ysFnQ==npm notice total files:   5npm notice+ upload-to-qiniu@1.0.5</code></pre><p>发布成功后可以在 <a href="https://www.npmjs.com/" target="_blank" rel="noopener">https://www.npmjs.com/</a> 看到包信息。</p><section class="footnotes" role="doc-endnotes"><hr><ol><li id="fn1" role="doc-endnote"><p><a href="https://juejin.im/post/5ecdd5185188254329780b0f" target="_blank" rel="noopener">https://juejin.im/post/5ecdd5185188254329780b0f</a> "用 Node.js 写个命令行翻译工具, 发布到 npm"<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li><li id="fn2" role="doc-endnote"><p><a href="https://github.com/forthealllight/blog/issues/45" target="_blank" rel="noopener">https://github.com/forthealllight/blog/issues/45</a> "在Typescript项目中，如何优雅的使用ESLint和Prettier"<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li><li id="fn3" role="doc-endnote"><p><a href="https://ts.xcatliu.com/engineering/lint.html" target="_blank" rel="noopener">https://ts.xcatliu.com/engineering/lint.html</a> "代码检查 · TypeScript 入门教程"<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li></ol></section>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最近在研究优化在国内访问静态博客的时间，其中有一个方案是将生成的文件存储在对象存储，然后再通过 CDN 回源对象存储。确定方案后使用 &lt;a href=&quot;https://www.qiniu.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;七牛云&lt;/a&gt; 做一个加速实验，由于要将生成的文件上传，又要将这个过程尽可能自动化，而七牛云只提供 SDK，要上传只能将密钥硬编码在代码中，这是很危险的。&lt;/p&gt;
&lt;p&gt;因此有了编写一个命令行工具的想法，由于最近在学习 TypeScript，就决定用它来写。&lt;/p&gt;
    
    </summary>
    
    
      <category term="TypeScript" scheme="https://blog.dreace.top/categories/TypeScript/"/>
    
    
      <category term="npm" scheme="https://blog.dreace.top/tags/npm/"/>
    
      <category term="TypeScript" scheme="https://blog.dreace.top/tags/TypeScript/"/>
    
  </entry>
  
  <entry>
    <title>TopK 问题两种解决方案：堆、快排变形</title>
    <link href="https://blog.dreace.top/2020/Two-Solutions-to-the-Topk-Problem-Heap-Quick-Sort/"/>
    <id>https://blog.dreace.top/2020/Two-Solutions-to-the-Topk-Problem-Heap-Quick-Sort/</id>
    <published>2020-07-10T04:31:47.000Z</published>
    <updated>2020-08-14T09:53:33.249Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.css" integrity="sha384-dbVIfZGuN1Yq7/1Ocstc1lUEm+AT+/rCkibIcC/OmWo5f0EA48Vf8CytHzGrSwbQ" crossorigin="anonymous"><p>这里的 TopK 不单指最大的 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> 个元素，也可以是最小的 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> 个元素，具体的例题可以看 <a href="https://leetcode-cn.com/problems/zui-xiao-de-kge-shu-lcof/" target="_blank" rel="noopener">剑指 Offer 40. 最小的k个数</a>。本文的代码均为可以在力扣提交的题解，故不包含头文件和 <code>main</code> 函数。</p><a id="more"></a><h2 id="堆">堆</h2><p>看到这种题，最先想到的可能是直接使用已有的排序函数，但是其时间复杂度为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mi>log</mi><mo>⁡</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n \log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span>，大量的排序工作是多余。</p><p>一个优化的想法是，建立一个大小为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> 的堆（针对求最小的 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> 个元素使用最大堆），只需要一次遍历将遍历到的元素和堆顶元素比较，若比堆顶小，则替换堆顶，然后进行堆调整。遍历完成后，堆中就是要求的最小的 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> 个元素（无序的）。</p><p>通过堆优化后时间复杂度为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mi>log</mi><mo>⁡</mo><mi>k</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n \log k)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mclose">)</span></span></span></span>。</p><div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">class</span> Solution {</span><span id="cb1-2"><a href="#cb1-2"></a><span class="kw">public</span>:</span><span id="cb1-3"><a href="#cb1-3"></a>    vector&lt;<span class="dt">int</span>&gt; getLeastNumbers(<span class="at">const</span> vector&lt;<span class="dt">int</span>&gt; &amp;arr, <span class="dt">int</span> k) {</span><span id="cb1-4"><a href="#cb1-4"></a>        vector&lt;<span class="dt">int</span>&gt; ans(k, <span class="dv">0</span>);</span><span id="cb1-5"><a href="#cb1-5"></a>        <span class="cf">if</span> (k == <span class="dv">0</span>) {</span><span id="cb1-6"><a href="#cb1-6"></a>            <span class="cf">return</span> ans;</span><span id="cb1-7"><a href="#cb1-7"></a>        }</span><span id="cb1-8"><a href="#cb1-8"></a>        <span class="co">// 建堆</span></span><span id="cb1-9"><a href="#cb1-9"></a>        <span class="cf">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; k; ++i) {</span><span id="cb1-10"><a href="#cb1-10"></a>            ans[i] = arr[i];</span><span id="cb1-11"><a href="#cb1-11"></a>        }</span><span id="cb1-12"><a href="#cb1-12"></a>        <span class="cf">for</span> (<span class="dt">int</span> i = k / <span class="dv">2</span> - <span class="dv">1</span>; i &gt;= <span class="dv">0</span>; --i) {</span><span id="cb1-13"><a href="#cb1-13"></a>            adjust(ans, i);</span><span id="cb1-14"><a href="#cb1-14"></a>        }</span><span id="cb1-15"><a href="#cb1-15"></a>        <span class="dt">int</span> n = arr.size();</span><span id="cb1-16"><a href="#cb1-16"></a>        <span class="cf">for</span> (<span class="dt">int</span> i = k; i &lt; n; ++i) {</span><span id="cb1-17"><a href="#cb1-17"></a>            <span class="co">// 比堆中最大的要小</span></span><span id="cb1-18"><a href="#cb1-18"></a>            <span class="cf">if</span> (arr[i] &lt; ans[<span class="dv">0</span>]) {</span><span id="cb1-19"><a href="#cb1-19"></a>                <span class="co">// 替换</span></span><span id="cb1-20"><a href="#cb1-20"></a>                ans[<span class="dv">0</span>] = arr[i];</span><span id="cb1-21"><a href="#cb1-21"></a>                <span class="co">// 调整后堆顶是最大的元素</span></span><span id="cb1-22"><a href="#cb1-22"></a>                adjust(ans, <span class="dv">0</span><span class="bu">u</span>);</span><span id="cb1-23"><a href="#cb1-23"></a>            }</span><span id="cb1-24"><a href="#cb1-24"></a>        }</span><span id="cb1-25"><a href="#cb1-25"></a>        <span class="cf">return</span> ans;</span><span id="cb1-26"><a href="#cb1-26"></a>    }</span><span id="cb1-27"><a href="#cb1-27"></a></span><span id="cb1-28"><a href="#cb1-28"></a></span><span id="cb1-29"><a href="#cb1-29"></a>    <span class="dt">void</span> adjust(vector&lt;<span class="dt">int</span>&gt; &amp;heap, <span class="dt">uint32_t</span> index) {</span><span id="cb1-30"><a href="#cb1-30"></a>        <span class="dt">uint32_t</span> t = index;</span><span id="cb1-31"><a href="#cb1-31"></a>        <span class="co">// 左孩子</span></span><span id="cb1-32"><a href="#cb1-32"></a>        <span class="cf">if</span> ((index &lt;&lt; <span class="dv">1</span><span class="bu">u</span>) + <span class="dv">1</span> &lt; heap.size() &amp;&amp; heap[(index &lt;&lt; <span class="dv">1</span><span class="bu">u</span>) + <span class="dv">1</span>] &gt; heap[t]) {</span><span id="cb1-33"><a href="#cb1-33"></a>            t = (index &lt;&lt; <span class="dv">1</span><span class="bu">u</span>) + <span class="dv">1</span>;</span><span id="cb1-34"><a href="#cb1-34"></a>        }</span><span id="cb1-35"><a href="#cb1-35"></a>        <span class="co">// 右孩子</span></span><span id="cb1-36"><a href="#cb1-36"></a>        <span class="cf">if</span> ((index &lt;&lt; <span class="dv">1</span><span class="bu">u</span>) + <span class="dv">2</span> &lt; heap.size() &amp;&amp; heap[(index &lt;&lt; <span class="dv">1</span><span class="bu">u</span>) + <span class="dv">2</span>] &gt; heap[t]) {</span><span id="cb1-37"><a href="#cb1-37"></a>            t = (index &lt;&lt; <span class="dv">1</span><span class="bu">u</span>) + <span class="dv">2</span>;</span><span id="cb1-38"><a href="#cb1-38"></a>        }</span><span id="cb1-39"><a href="#cb1-39"></a>        <span class="co">// 孩子节点比父节点大</span></span><span id="cb1-40"><a href="#cb1-40"></a>        <span class="cf">if</span> (t != index) {</span><span id="cb1-41"><a href="#cb1-41"></a>            <span class="bu">std::</span>swap(heap[index], heap[t]);</span><span id="cb1-42"><a href="#cb1-42"></a>            <span class="co">// 递归调整</span></span><span id="cb1-43"><a href="#cb1-43"></a>            adjust(heap, t);</span><span id="cb1-44"><a href="#cb1-44"></a>        }</span><span id="cb1-45"><a href="#cb1-45"></a>    }</span><span id="cb1-46"><a href="#cb1-46"></a>};</span></code></pre></div><h2 id="快排">快排</h2><p>这里不是真的快排，而是借助快排的思想，将元素划分成比中间元素后大或小的两部分后，再对其中的一个部分再次划分。快排的思想是分治，这里解决 TopK 的思想是减治，因为划分后不符合条件的部分直接舍弃掉。</p><p>该方法的期望时间复杂度 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span>，最坏时间复杂度 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>，因为可能每次选取的中间值都是最大值，为了解决这个问题，可以随机选择中间值（被注释掉的三行代码）。</p><div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">class</span> Solution {</span><span id="cb2-2"><a href="#cb2-2"></a><span class="kw">public</span>:</span><span id="cb2-3"><a href="#cb2-3"></a>    <span class="bu">std::</span>vector&lt;<span class="dt">int</span>&gt; getLeastNumbers(<span class="bu">std::</span>vector&lt;<span class="dt">int</span>&gt; &amp;arr, <span class="dt">int</span> k) {</span><span id="cb2-4"><a href="#cb2-4"></a>        <span class="dt">uint32_t</span> left = <span class="dv">0</span>, right = arr.size() - <span class="dv">1</span>;</span><span id="cb2-5"><a href="#cb2-5"></a><span class="co">//        srand(time(nullptr));</span></span><span id="cb2-6"><a href="#cb2-6"></a>        <span class="cf">while</span> (left &lt; right) {</span><span id="cb2-7"><a href="#cb2-7"></a><span class="co">//            int t = rand() % (right - left + 1) + left;</span></span><span id="cb2-8"><a href="#cb2-8"></a><span class="co">//            std::swap(arr[left], arr[t]);</span></span><span id="cb2-9"><a href="#cb2-9"></a>            <span class="dt">int</span> pivot = arr[left];</span><span id="cb2-10"><a href="#cb2-10"></a>            <span class="dt">int</span> i = left, j = right;</span><span id="cb2-11"><a href="#cb2-11"></a>            <span class="co">// 完成后以 i 为分界，左半部分比 arr[i] 小，右半部分比 arr[i] 大</span></span><span id="cb2-12"><a href="#cb2-12"></a>            <span class="cf">while</span> (i &lt;= j) {</span><span id="cb2-13"><a href="#cb2-13"></a>                <span class="co">// 寻找左半部分比 pivot 大的元素</span></span><span id="cb2-14"><a href="#cb2-14"></a>                <span class="cf">while</span> (i &lt;= j &amp;&amp; arr[i] &lt; pivot) {</span><span id="cb2-15"><a href="#cb2-15"></a>                    ++i;</span><span id="cb2-16"><a href="#cb2-16"></a>                }</span><span id="cb2-17"><a href="#cb2-17"></a>                <span class="co">// 寻找右半部分比 pivot 小的元素</span></span><span id="cb2-18"><a href="#cb2-18"></a>                <span class="cf">while</span> (i &lt;= j &amp;&amp; arr[j] &gt; pivot) {</span><span id="cb2-19"><a href="#cb2-19"></a>                    --j;</span><span id="cb2-20"><a href="#cb2-20"></a>                }</span><span id="cb2-21"><a href="#cb2-21"></a>                <span class="cf">if</span> (i &lt;= j) {</span><span id="cb2-22"><a href="#cb2-22"></a>                    <span class="bu">std::</span>swap(arr[i], arr[j]);</span><span id="cb2-23"><a href="#cb2-23"></a>                    ++i;</span><span id="cb2-24"><a href="#cb2-24"></a>                    --j;</span><span id="cb2-25"><a href="#cb2-25"></a>                }</span><span id="cb2-26"><a href="#cb2-26"></a>            }</span><span id="cb2-27"><a href="#cb2-27"></a>            <span class="cf">if</span> (i &gt;= k) {</span><span id="cb2-28"><a href="#cb2-28"></a>                <span class="co">// 大于等于 k 个</span></span><span id="cb2-29"><a href="#cb2-29"></a>                right = i - <span class="dv">1</span>;</span><span id="cb2-30"><a href="#cb2-30"></a>            } <span class="cf">else</span> {</span><span id="cb2-31"><a href="#cb2-31"></a>                <span class="co">// 小于 k 个</span></span><span id="cb2-32"><a href="#cb2-32"></a>                left = i;</span><span id="cb2-33"><a href="#cb2-33"></a>            }</span><span id="cb2-34"><a href="#cb2-34"></a>        }</span><span id="cb2-35"><a href="#cb2-35"></a>        <span class="cf">return</span> <span class="bu">std::</span>vector&lt;<span class="dt">int</span>&gt;(arr.begin(), arr.begin() + k);</span><span id="cb2-36"><a href="#cb2-36"></a>    }</span><span id="cb2-37"><a href="#cb2-37"></a>};</span></code></pre></div><h2 id="两种算法的选择">两种算法的选择</h2><p>在数据量比较小时，两个算法没有太大的区别。</p><p>但是当数据量达到十亿级别（腾讯面试被问过这个问题）使用快排需要将所有数据读入内存（当然也可以优化，但是会更复杂）。</p><p>而使用堆只需要维护一个大小为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> 的堆（实际来说是数组），由于只需要遍历一次数据，数据读入一次就行了，对磁盘的操作可以很少。相比 CPU 的速度，磁盘 I/O 的时间有数量级上的差异。</p><p>因此在大数据量上应该选择堆。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;这里的 TopK 不单指最大的 &lt;span class=&quot;math inline&quot;&gt;k&lt;/span&gt; 个元素，也可以是最小的 &lt;span class=&quot;math inline&quot;&gt;k&lt;/span&gt; 个元素，具体的例题可以看 &lt;a href=&quot;https://leetcode-cn.com/problems/zui-xiao-de-kge-shu-lcof/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;剑指 Offer 40. 最小的k个数&lt;/a&gt;。本文的代码均为可以在力扣提交的题解，故不包含头文件和 &lt;code&gt;main&lt;/code&gt; 函数。&lt;/p&gt;
    
    </summary>
    
    
      <category term="算法" scheme="https://blog.dreace.top/categories/%E7%AE%97%E6%B3%95/"/>
    
    
      <category term="算法" scheme="https://blog.dreace.top/tags/%E7%AE%97%E6%B3%95/"/>
    
      <category term="C++" scheme="https://blog.dreace.top/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>使用 Python 实现 DES 算法</title>
    <link href="https://blog.dreace.top/2020/Use-Python-to-implement-the-DES-algorithm/"/>
    <id>https://blog.dreace.top/2020/Use-Python-to-implement-the-DES-algorithm/</id>
    <published>2020-07-07T08:15:36.000Z</published>
    <updated>2020-08-14T09:53:33.249Z</updated>
    
    <content type="html"><![CDATA[<p>没有前言，直接进入正题，若需要关于 DES 的详细介绍，请看 <a href="https://zh.wikipedia.org/wiki/%E8%B3%87%E6%96%99%E5%8A%A0%E5%AF%86%E6%A8%99%E6%BA%96" target="_blank" rel="noopener">数据加密标准 - 维基百科，自由的百科全书</a>。若无特殊说明，本文章所有配图均来自维基百科。第一次使用工具函数时会进行详细介绍。本文章使用的全部代码可以在 <a href="https://gist.github.com/Dreace/4fc39e0ec2615ad06554e4ef9b9c64b6" target="_blank" rel="noopener">Gist</a> 上找到。</p><a id="more"></a><h2 id="子密钥生成">子密钥生成</h2><figure><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/Use-Python-to-implement-the-DES-algorithm/250px-DES-key-schedule.png" alt><figcaption>子密钥生成过程</figcaption></figure><p>初始化时由外部提供密钥，若密钥长度不足 8 字节（64 位）可以在末尾使用 0 补足长度。</p><div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="cf">if</span> <span class="bu">isinstance</span>(key, <span class="bu">str</span>):</span><span id="cb1-2"><a href="#cb1-2"></a>    key <span class="op">=</span> key.encode()</span><span id="cb1-3"><a href="#cb1-3"></a><span class="cf">if</span> <span class="bu">len</span>(key) <span class="op">&gt;</span> <span class="dv">8</span>:</span><span id="cb1-4"><a href="#cb1-4"></a>    key <span class="op">=</span> key[<span class="dv">8</span>:]</span><span id="cb1-5"><a href="#cb1-5"></a><span class="cf">elif</span> <span class="bu">len</span>(key) <span class="op">&lt;</span> <span class="dv">8</span>:</span><span id="cb1-6"><a href="#cb1-6"></a>    key <span class="op">+=</span> b<span class="st">&quot;&quot;</span>.join(b<span class="st">&quot;</span><span class="ch">\x00</span><span class="st">&quot;</span> <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">8</span> <span class="op">-</span> <span class="bu">len</span>(key)))</span><span id="cb1-7"><a href="#cb1-7"></a>key_bit_list <span class="op">=</span> <span class="va">self</span>._bytes_to_bit_list(key)</span></code></pre></div><p>提供的密钥可以是字符串或者是字节，若是字符串则需要编码得到字节，方便后续的处理，最后将长度裁剪或补足到 8 字节后转换成比特列表。字节到比特列表的函数如下：</p><div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">def</span> _bytes_to_bit_list(input_bytes: <span class="bu">bytes</span>) <span class="op">-&gt;</span> List[<span class="bu">int</span>]:</span><span id="cb2-2"><a href="#cb2-2"></a>    bit_list <span class="op">=</span> [<span class="dv">0</span>] <span class="op">*</span> <span class="dv">8</span> <span class="op">*</span> <span class="bu">len</span>(input_bytes)</span><span id="cb2-3"><a href="#cb2-3"></a>    index <span class="op">=</span> <span class="dv">0</span></span><span id="cb2-4"><a href="#cb2-4"></a>    <span class="cf">for</span> char_ascii <span class="kw">in</span> input_bytes:</span><span id="cb2-5"><a href="#cb2-5"></a>        loc <span class="op">=</span> <span class="dv">7</span></span><span id="cb2-6"><a href="#cb2-6"></a>        <span class="cf">while</span> loc <span class="op">&gt;=</span> <span class="dv">0</span>:</span><span id="cb2-7"><a href="#cb2-7"></a>            bit_list[index] <span class="op">=</span> <span class="dv">0</span> <span class="cf">if</span> char_ascii <span class="op">&amp;</span> (<span class="dv">1</span> <span class="op">&lt;&lt;</span> loc) <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">1</span></span><span id="cb2-8"><a href="#cb2-8"></a>            loc <span class="op">-=</span> <span class="dv">1</span></span><span id="cb2-9"><a href="#cb2-9"></a>            index <span class="op">+=</span> <span class="dv">1</span></span><span id="cb2-10"><a href="#cb2-10"></a>    <span class="cf">return</span> bit_list</span></code></pre></div><p>字节使用 <code>for</code> 得到的元素是数字，这里命名为 <code>char_ascii</code>，从高位到低位依次取出 <code>char_ascii</code> 的每一位填充到比特列表中。</p><p>得到密钥的比特列表后需要使用 PC-1 生成两个 28 位半密钥（总共只使用了 56 位密钥，剩下的 8 位可以作为奇偶校验）。</p><div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a>left_half_key_block <span class="op">=</span> <span class="va">self</span>._transform(key_bit_list, pc1_left_table)</span><span id="cb3-2"><a href="#cb3-2"></a>right_half_key_block <span class="op">=</span> <span class="va">self</span>._transform(key_bit_list, pc1_right_table)</span></code></pre></div><p>这里使用了一个置换工具函数，这个函数在 DES 算法中应该是最常用的了，通过查表进行变换。</p><div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">def</span> _transform(raw_list: <span class="bu">list</span>, transform_table: List[<span class="bu">int</span>]) <span class="op">-&gt;</span> <span class="bu">list</span>:</span><span id="cb4-2"><a href="#cb4-2"></a>    <span class="cf">return</span> <span class="bu">list</span>(<span class="bu">map</span>(<span class="kw">lambda</span> index: raw_list[index], transform_table))</span></code></pre></div><p>在得到两个半密钥后下一步是生成 16 个子密钥，首先将两个半密钥循环左移（左移位数查表得）合并，再通过 PC-2 得到 48 位的子密钥。</p><div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a>sub_key_list <span class="op">=</span> []</span><span id="cb5-2"><a href="#cb5-2"></a><span class="cf">for</span> round_index <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">16</span>):</span><span id="cb5-3"><a href="#cb5-3"></a>    left_half_key_block <span class="op">=</span> <span class="va">self</span>._circle_left_shift(left_half_key_block, key_left_shift_bits[round_index])</span><span id="cb5-4"><a href="#cb5-4"></a>    right_half_key_block <span class="op">=</span> <span class="va">self</span>._circle_left_shift(right_half_key_block, key_left_shift_bits[round_index])</span><span id="cb5-5"><a href="#cb5-5"></a>    sub_key_list.append(<span class="va">self</span>._transform(left_half_key_block <span class="op">+</span> right_half_key_block, pc2_table))</span><span id="cb5-6"><a href="#cb5-6"></a><span class="va">self</span>._sub_key_list <span class="op">=</span> sub_key_list</span></code></pre></div><p><code>_circle_left_shift</code> 实现如下：</p><div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw">def</span> _circle_left_shift(input_list: <span class="bu">list</span>, bits: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="bu">list</span>:</span><span id="cb6-2"><a href="#cb6-2"></a>    <span class="cf">return</span> input_list[bits:] <span class="op">+</span> input_list[:bits]</span></code></pre></div><p>将输入列表切片再合并实现循环左移效果。</p><h2 id="分块加密">分块加密</h2><figure><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/Use-Python-to-implement-the-DES-algorithm/250px-DES-main-network.png" alt><figcaption>整体结构</figcaption></figure><p>一次 DES 加密针对 64 位的明文，首先将明文进行 IP 后再分为两部分。</p><div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a>plain_block <span class="op">=</span> <span class="va">self</span>._transform(plain_block, ip_table)</span><span id="cb7-2"><a href="#cb7-2"></a>left_half_block <span class="op">=</span> plain_block[:<span class="dv">32</span>]</span><span id="cb7-3"><a href="#cb7-3"></a>right_half_block <span class="op">=</span> plain_block[<span class="dv">32</span>:]</span></code></pre></div><p>将左半部分与右半部分经过 F 函数后的结果异或得到新的左半部分，原来的左半部分作为新的右半部分。如此进行十六次。</p><figure><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/Use-Python-to-implement-the-DES-algorithm/250px-DES-f-function.png" alt><figcaption>F 函数</figcaption></figure><div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a><span class="cf">for</span> round_index <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">16</span>):</span><span id="cb8-2"><a href="#cb8-2"></a>    left_half_block, right_half_block <span class="op">=</span> right_half_block, <span class="op">\</span></span><span id="cb8-3"><a href="#cb8-3"></a>                                        <span class="va">self</span>._bit_list_xor(</span><span id="cb8-4"><a href="#cb8-4"></a>                                            left_half_block,</span><span id="cb8-5"><a href="#cb8-5"></a>                                            <span class="va">self</span>._transform(</span><span id="cb8-6"><a href="#cb8-6"></a>                                                <span class="va">self</span>._s_box_transform(</span><span id="cb8-7"><a href="#cb8-7"></a>                                                    <span class="va">self</span>._bit_list_xor(</span><span id="cb8-8"><a href="#cb8-8"></a>                                                        <span class="va">self</span>._transform(right_half_block,</span><span id="cb8-9"><a href="#cb8-9"></a>                                                                        extend_table),</span><span id="cb8-10"><a href="#cb8-10"></a>                                                        <span class="va">self</span>._sub_key_list[round_index]</span><span id="cb8-11"><a href="#cb8-11"></a>                                                    )</span><span id="cb8-12"><a href="#cb8-12"></a>                                                ), p_table</span><span id="cb8-13"><a href="#cb8-13"></a>                                            )</span><span id="cb8-14"><a href="#cb8-14"></a>                                        )</span><span id="cb8-15"><a href="#cb8-15"></a><span class="cf">return</span> <span class="va">self</span>._transform(right_half_block <span class="op">+</span> left_half_block, fp_table)</span></code></pre></div><p>F 函数的过程：</p><ol type="1"><li>通过扩张置换将 32 位的半块扩展到 48 位</li><li>与 48 位的子密钥进行异或</li><li>每 6 位进行 S 盒变换，得到 4 位的输出，共 32 位</li><li>最后再进行 P 置换</li></ol><p>这里涉及到一个比特列表的异或操作，实现如下：</p><div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw">def</span> _bit_list_xor(left: <span class="bu">list</span>, right: <span class="bu">list</span>) <span class="op">-&gt;</span> List[<span class="bu">str</span>]:</span><span id="cb9-2"><a href="#cb9-2"></a>    <span class="cf">return</span> <span class="bu">list</span>(<span class="bu">map</span>(<span class="kw">lambda</span> x, y: x <span class="op">^</span> y, left, right))</span></code></pre></div><p>和 S 盒变换工具函数：</p><div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a><span class="kw">def</span> _s_box_transform(input_list: <span class="bu">list</span>) <span class="op">-&gt;</span> <span class="bu">list</span>:</span><span id="cb10-2"><a href="#cb10-2"></a>    transformed <span class="op">=</span> [<span class="dv">0</span> <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">32</span>)]</span><span id="cb10-3"><a href="#cb10-3"></a>    transformed_index <span class="op">=</span> <span class="dv">0</span></span><span id="cb10-4"><a href="#cb10-4"></a>    r <span class="op">=</span> <span class="dv">0</span></span><span id="cb10-5"><a href="#cb10-5"></a>    <span class="cf">while</span> r <span class="op">&lt;</span> <span class="dv">48</span>:</span><span id="cb10-6"><a href="#cb10-6"></a>        m <span class="op">=</span> (input_list[r] <span class="op">&lt;&lt;</span> <span class="dv">1</span>) <span class="op">+</span> input_list[r <span class="op">+</span> <span class="dv">5</span>]</span><span id="cb10-7"><a href="#cb10-7"></a>        n <span class="op">=</span> (input_list[r <span class="op">+</span> <span class="dv">1</span>] <span class="op">&lt;&lt;</span> <span class="dv">3</span>) <span class="op">+</span> (input_list[r <span class="op">+</span> <span class="dv">2</span>] <span class="op">&lt;&lt;</span> <span class="dv">2</span>) <span class="op">+</span> (input_list[r <span class="op">+</span> <span class="dv">3</span>] <span class="op">&lt;&lt;</span> <span class="dv">1</span>) <span class="op">+</span> (input_list[r <span class="op">+</span> <span class="dv">4</span>])</span><span id="cb10-8"><a href="#cb10-8"></a>        s_value <span class="op">=</span> s_box_tables[r <span class="op">//</span> <span class="dv">6</span>][(m <span class="op">&lt;&lt;</span> <span class="dv">4</span>) <span class="op">+</span> n]</span><span id="cb10-9"><a href="#cb10-9"></a>        transformed[transformed_index] <span class="op">=</span> (s_value <span class="op">&amp;</span> <span class="dv">8</span>) <span class="op">&gt;&gt;</span> <span class="dv">3</span></span><span id="cb10-10"><a href="#cb10-10"></a>        transformed[transformed_index <span class="op">+</span> <span class="dv">1</span>] <span class="op">=</span> (s_value <span class="op">&amp;</span> <span class="dv">4</span>) <span class="op">&gt;&gt;</span> <span class="dv">2</span></span><span id="cb10-11"><a href="#cb10-11"></a>        transformed[transformed_index <span class="op">+</span> <span class="dv">2</span>] <span class="op">=</span> (s_value <span class="op">&amp;</span> <span class="dv">2</span>) <span class="op">&gt;&gt;</span> <span class="dv">1</span></span><span id="cb10-12"><a href="#cb10-12"></a>        transformed[transformed_index <span class="op">+</span> <span class="dv">3</span>] <span class="op">=</span> s_value <span class="op">&amp;</span> <span class="dv">1</span></span><span id="cb10-13"><a href="#cb10-13"></a>        r <span class="op">+=</span> <span class="dv">6</span></span><span id="cb10-14"><a href="#cb10-14"></a>        transformed_index <span class="op">+=</span> <span class="dv">4</span></span><span id="cb10-15"><a href="#cb10-15"></a>    <span class="cf">return</span> transformed</span></code></pre></div><p>每次取出 6 六位，最高位和最低位计算 <code>m</code> 为行号，中间四位计算 <code>n</code> 为列号。为了方便处理这里将二维的 S 盒表格展开为一维数组，根据 <code>m</code> 和 <code>n</code> 取出 S 盒中元素。</p><p>最后将元素转换成比特填充到 <code>transformed</code> 中。</p><h2 id="明文加密">明文加密</h2><p>加密函数接受字符串和字节作为参数，若明文长度不是 8 的整数倍字节则需要补足。</p><div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a><span class="cf">if</span> <span class="bu">isinstance</span>(plain_text, <span class="bu">str</span>):</span><span id="cb11-2"><a href="#cb11-2"></a>    plain_text <span class="op">=</span> plain_text.encode()</span><span id="cb11-3"><a href="#cb11-3"></a>plain_text_len <span class="op">=</span> <span class="bu">len</span>(plain_text)</span><span id="cb11-4"><a href="#cb11-4"></a><span class="cf">if</span> plain_text_len <span class="op">%</span> <span class="dv">8</span>:</span><span id="cb11-5"><a href="#cb11-5"></a>    plain_text <span class="op">+=</span> b<span class="st">&quot;&quot;</span>.join(b<span class="st">&quot;</span><span class="ch">\x00</span><span class="st">&quot;</span> <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">8</span> <span class="op">-</span> plain_text_len <span class="op">%</span> <span class="dv">8</span>))</span></code></pre></div><p>将明文分成 8 字节长的块后分别进行加密，全部块加密完成后得到若干个 64 位长的比特列表，将这些列表合并，再转换成字节。</p><div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a>encrypted_blocks <span class="op">=</span> []</span><span id="cb12-2"><a href="#cb12-2"></a><span class="cf">for</span> block <span class="kw">in</span> <span class="bu">map</span>(<span class="kw">lambda</span> s: plain_text[s:s <span class="op">+</span> <span class="dv">8</span>], <span class="bu">range</span>(<span class="dv">0</span>, plain_text_len, <span class="dv">8</span>)):</span><span id="cb12-3"><a href="#cb12-3"></a>    encrypted_blocks.append(<span class="va">self</span>._encrypt_block(<span class="va">self</span>._bytes_to_bit_list(block)))</span><span id="cb12-4"><a href="#cb12-4"></a>encrypted_bit_list <span class="op">=</span> <span class="bu">list</span>(chain(<span class="op">*</span>encrypted_blocks))</span><span id="cb12-5"><a href="#cb12-5"></a><span class="cf">return</span> <span class="va">self</span>._bit_list_to_bytes(encrypted_bit_list)</span></code></pre></div><p>比特列表到字节函数如下：</p><div class="sourceCode" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1"></a><span class="kw">def</span> _bit_list_to_bytes(bit_list: List[<span class="bu">int</span>]) <span class="op">-&gt;</span> <span class="bu">bytes</span>:</span><span id="cb13-2"><a href="#cb13-2"></a>    char_ascii <span class="op">=</span> <span class="dv">0</span></span><span id="cb13-3"><a href="#cb13-3"></a>    byte_list <span class="op">=</span> []</span><span id="cb13-4"><a href="#cb13-4"></a>    <span class="cf">for</span> index, bit <span class="kw">in</span> <span class="bu">enumerate</span>(bit_list):</span><span id="cb13-5"><a href="#cb13-5"></a>        char_ascii <span class="op">+=</span> bit <span class="op">&lt;&lt;</span> (<span class="dv">7</span> <span class="op">-</span> index <span class="op">%</span> <span class="dv">8</span>)</span><span id="cb13-6"><a href="#cb13-6"></a>        <span class="cf">if</span> index <span class="op">%</span> <span class="dv">8</span> <span class="op">==</span> <span class="dv">7</span>:</span><span id="cb13-7"><a href="#cb13-7"></a>            byte_list.append(char_ascii)</span><span id="cb13-8"><a href="#cb13-8"></a>            char_ascii <span class="op">=</span> <span class="dv">0</span></span><span id="cb13-9"><a href="#cb13-9"></a>    <span class="cf">return</span> <span class="bu">bytes</span>(byte_list)</span></code></pre></div><h2 id="解密">解密</h2><p>解密过程和加密过程完全相同，只不过子密钥使用顺序相反。</p><div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1"></a><span class="kw">def</span> decrypt(<span class="va">self</span>, cipher_text: <span class="bu">bytes</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span><span id="cb14-2"><a href="#cb14-2"></a>    <span class="va">self</span>._sub_key_list.reverse()</span><span id="cb14-3"><a href="#cb14-3"></a>    plain_text <span class="op">=</span> <span class="va">self</span>.encrypt(cipher_text)</span><span id="cb14-4"><a href="#cb14-4"></a>    <span class="va">self</span>._sub_key_list.reverse()</span><span id="cb14-5"><a href="#cb14-5"></a>    <span class="cf">return</span> plain_text.decode().rstrip(<span class="st">&#39;</span><span class="ch">\0</span><span class="st">&#39;</span>)</span></code></pre></div>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;没有前言，直接进入正题，若需要关于 DES 的详细介绍，请看 &lt;a href=&quot;https://zh.wikipedia.org/wiki/%E8%B3%87%E6%96%99%E5%8A%A0%E5%AF%86%E6%A8%99%E6%BA%96&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;数据加密标准 - 维基百科，自由的百科全书&lt;/a&gt;。若无特殊说明，本文章所有配图均来自维基百科。第一次使用工具函数时会进行详细介绍。本文章使用的全部代码可以在 &lt;a href=&quot;https://gist.github.com/Dreace/4fc39e0ec2615ad06554e4ef9b9c64b6&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Gist&lt;/a&gt; 上找到。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Python" scheme="https://blog.dreace.top/categories/Python/"/>
    
    
      <category term="Python" scheme="https://blog.dreace.top/tags/Python/"/>
    
      <category term="DES" scheme="https://blog.dreace.top/tags/DES/"/>
    
  </entry>
  
  <entry>
    <title>解决 Clion 无法识别 WSL Ubuntu 20.04 LTS</title>
    <link href="https://blog.dreace.top/2020/Solved-that-Clion-Does-not-recognize-WSL-Ubuntu-20-04-LTS/"/>
    <id>https://blog.dreace.top/2020/Solved-that-Clion-Does-not-recognize-WSL-Ubuntu-20-04-LTS/</id>
    <published>2020-05-10T13:23:16.000Z</published>
    <updated>2020-08-14T09:53:33.249Z</updated>
    
    <content type="html"><![CDATA[<p><strong>注：本文提到的 WSL 均为 WSL 1。</strong></p><p>最近在学网络编程，需要在 Linux 下编译 C 源码，可我日常使用 Windows，在虚拟机里操作又不是很方便。于是 Clion + WSL 成了几乎完美的解决方案，在 Windows 下编码，Linux 环境下编译运行。</p><p>但是由于一个意外需要卸载已安装的 WSL（Ubuntu 18.04 LTS），凑巧巨硬最近发布了 Ubuntu 20.04 LTS 的 WSL，于是尝试了一下。尴尬的是最新版本的 Clion 还不能识别 20.04，但问题不大。</p><a id="more"></a><h2 id="修改配置文件">修改配置文件</h2><p>原本 Clion 应能识别已安装的 WSL，但 20.04 的设置还未添加，故不能识别。解决办法很简答，手动添加即可。打开 <code>C:\Users\&lt;用户名&gt;\AppData\Roaming\JetBrains\CLion&lt;版本号&gt;\options\wsl.distributions.xml</code>，在 <code>set</code> 下添加<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>：</p><div class="sourceCode" id="cb1"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">&lt;descriptor&gt;</span></span><span id="cb1-2"><a href="#cb1-2"></a>    <span class="kw">&lt;id&gt;</span>UBUNTU2004<span class="kw">&lt;/id&gt;</span></span><span id="cb1-3"><a href="#cb1-3"></a>    <span class="kw">&lt;microsoft-id&gt;</span>Ubuntu-20.04<span class="kw">&lt;/microsoft-id&gt;</span></span><span id="cb1-4"><a href="#cb1-4"></a>    <span class="kw">&lt;executable-path&gt;</span>ubuntu2004.exe<span class="kw">&lt;/executable-path&gt;</span></span><span id="cb1-5"><a href="#cb1-5"></a>    <span class="kw">&lt;presentable-name&gt;</span>Ubuntu 20.04<span class="kw">&lt;/presentable-name&gt;</span></span><span id="cb1-6"><a href="#cb1-6"></a><span class="kw">&lt;/descriptor&gt;</span></span></code></pre></div><p>保存，重启 Clion 即可。</p><h2 id="再解决一个问题">再解决一个问题</h2><p>在升级 20.04 的包时遇到 <code>sleep: cannot read realtime clock: Invalid argument</code> 错误，应该是一个 WSL 的 bug，据说已经在 Windows 2004 修复，但是 2004 要还没正式发布。目前的解决办法是降级导致问题的 <code>libc6</code> 包<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>：</p><div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">wget</span> <span class="st">&quot;https://launchpad.net/~rafaeldtinoco/+archive/ubuntu/lp1871129/+build/19152555/+files/libc6_2.31-0ubuntu8+lp1871129~1_amd64.deb&quot;</span></span><span id="cb2-2"><a href="#cb2-2"></a><span class="fu">sudo</span> dpkg -i libc6_2.31-0ubuntu8+lp1871129~1_amd64.deb</span></code></pre></div><p>在升级前将其版本冻结：</p><div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1"></a><span class="ex">apt-mark</span> hold libc6</span></code></pre></div><p>这样该问题可以解决。但是降级会导致 gcc、cmake 等一大票编译工具<strong>无法</strong>正常安装。</p><h2 id="最后">最后</h2><p>还是回到了 Ubuntu 18.04 LTS。</p><section class="footnotes" role="doc-endnotes"><hr><ol><li id="fn1" role="doc-endnote"><p><a href="https://intellij-support.jetbrains.com/hc/en-us/community/posts/360004135320-CLion-not-picking-up-WSL" target="_blank" rel="noopener">https://intellij-support.jetbrains.com/hc/en-us/community/posts/360004135320-CLion-not-picking-up-WSL</a> "CLion not picking up WSL – IDEs Support (IntelliJ Platform) | JetBrains"<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li><li id="fn2" role="doc-endnote"><p><a href="https://github.com/microsoft/WSL/issues/4898" target="_blank" rel="noopener">https://github.com/microsoft/WSL/issues/4898</a> "[WSL1] [glibc] sleep: cannot read realtime clock: Invalid argument"<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li></ol></section>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;注：本文提到的 WSL 均为 WSL 1。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;最近在学网络编程，需要在 Linux 下编译 C 源码，可我日常使用 Windows，在虚拟机里操作又不是很方便。于是 Clion + WSL 成了几乎完美的解决方案，在 Windows 下编码，Linux 环境下编译运行。&lt;/p&gt;
&lt;p&gt;但是由于一个意外需要卸载已安装的 WSL（Ubuntu 18.04 LTS），凑巧巨硬最近发布了 Ubuntu 20.04 LTS 的 WSL，于是尝试了一下。尴尬的是最新版本的 Clion 还不能识别 20.04，但问题不大。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Linux" scheme="https://blog.dreace.top/categories/Linux/"/>
    
    
      <category term="Clion" scheme="https://blog.dreace.top/tags/Clion/"/>
    
      <category term="Ubuntu" scheme="https://blog.dreace.top/tags/Ubuntu/"/>
    
      <category term="WSL" scheme="https://blog.dreace.top/tags/WSL/"/>
    
  </entry>
  
  <entry>
    <title>InfluxDB 内存优化</title>
    <link href="https://blog.dreace.top/2020/InfluxDB-Memory-Optimization/"/>
    <id>https://blog.dreace.top/2020/InfluxDB-Memory-Optimization/</id>
    <published>2020-05-08T03:27:20.000Z</published>
    <updated>2020-08-14T09:53:33.249Z</updated>
    
    <content type="html"><![CDATA[<p>最近给小程序的后端日志加上了实时输出到前端功能，为了展示就得保存日志，又考虑到日志是时序数据，自然就选择了时序数据库 <a href="https://www.influxdata.com/" target="_blank" rel="noopener">InfluxDB</a>，并且通过 Docker 部署。刚上线的一两天没有什么问题，各方面运行都很平稳，没过几天的一个早上突然收到了阿里云的报警，说内存占用超过了 95%。</p><p>这便是噩梦的开始。</p><a id="more"></a><h2 id="罪魁祸首">罪魁祸首</h2><p>收到报警后看了一下系统各项指标，不仅内存占用高，CPU、磁盘使用率都是满负荷。</p><figure><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/InfluxDB-Memory-Optimization/image-20200508120656188.png" alt><figcaption>报警时系统指标</figcaption></figure><p>在凌晨一点半左右内存暴涨，紧接着 CPU 使用率也达到 100%。这个场景似曾相识，因为之前使用过 InfluxDB，也遇到过内存暴涨，结合前几天又用上了 InfluxDB，基本可以断定是 InfluxDB 的锅。</p><p>重启服务器后一切都恢复正常，但是 InfluxDB 可能随时又出现状况，只能一直盯着各种指标，盯数据的时候发现 InfluxDB 的内存占用肉眼可见地增长，可以说很恐怖了。</p><h2 id="尝试解决">尝试解决</h2><p>好在 InfluxDB 是通过 Docker 部署的，可以很方便地限制内存使用，尝试通过 <code>docker-compose.yml</code> 配置：</p><div class="sourceCode" id="cb1"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">deploy</span><span class="kw">:</span></span><span id="cb1-2"><a href="#cb1-2"></a><span class="at">    </span><span class="fu">resources</span><span class="kw">:</span></span><span id="cb1-3"><a href="#cb1-3"></a><span class="at">    </span><span class="fu">limits</span><span class="kw">:</span></span><span id="cb1-4"><a href="#cb1-4"></a><span class="at">        </span><span class="fu">memory</span><span class="kw">:</span><span class="at"> 500M</span></span><span id="cb1-5"><a href="#cb1-5"></a><span class="fu">restart</span><span class="kw">:</span><span class="at"> always</span></span></code></pre></div><p>将 InfluxDB 可以使用的内存限制在 500MiB，超过这个数值就会被 kill，然后又自动重启。虽然这样可以避免 InfluxDB 将系统拖垮，但频繁 OOM 又重启终究不是什么好办法。</p><h3 id="更改索引方式">更改索引方式</h3><p>查了一些资料后得知 InfluxDB 默认的索引是在内存上维护的，不断地数据增长会使用越来越多的内存，并有一个参数 <code>index-version</code> 可以设置索引方式<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>。如果是直接在主机上部署的可以修改配置文件，Docker 部署则需要通过环境变量设置：</p><div class="sourceCode" id="cb2"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">environment</span><span class="kw">:</span></span><span id="cb2-2"><a href="#cb2-2"></a><span class="at">    </span><span class="fu">INFLUXDB_DATA_INDEX_VERSION</span><span class="kw">:</span><span class="at"> tsi1</span></span></code></pre></div><p>将索引数据存储在磁盘上，可以通过日志或者查看分片的目录结构验证修改是否生效，若索引方式为 <code>tsi1</code>，在分片目录下会有一个名为 <code>index</code> 的目录，<code>inmem</code> 索引则没有。</p><p>具体位置是 <code>/var/lib/influxdb/data/&lt;数据库&gt;/&lt;保留策略&gt;/&lt;分片&gt;</code>。</p><pre class="text"><code>[root@izuf6czs1dw6siz3zokdiez 1_day]# ls1  10  11  12  13  14  15  16  18  19  20  21  3  4  5  6  7  8  9[root@izuf6czs1dw6siz3zokdiez 1_day]# cd 15[root@izuf6czs1dw6siz3zokdiez 15]# ls000000001-000000001.tsm  fields.idx  index</code></pre><h3 id="更激进的方法">更激进的方法</h3><p>默认情况下 InfluxDB 会维护一个 <code>_internal</code> 库，来监控系统状态，如果禁用这个库可以减少磁盘和内容的使用，但是可能会发生一些不可预料的事故，因此官方<strong>不推荐</strong>在生产环境下禁用 <code>_internal</code> 库<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>。</p><blockquote><p>InfluxData does <strong>not</strong> recommend using the <code>_internal</code> database in a production cluster. It creates unnecessary overhead, particularly for busy clusters, that can overload an already loaded cluster. Metrics stored in the <code>_internal</code> database primarily measure workload performance and should only be tested in non-production environments.</p></blockquote><p>但是在内存极度紧张的时候还是可以考虑禁用 <code>_internal</code> 库的。由于需要 InfluxDB 的是一个小项目，部署的机器内存又很小，就决定禁用 <code>_internal</code> 了。</p><p>添加环境变量：</p><div class="sourceCode" id="cb4"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1"></a><span class="fu">environment</span><span class="kw">:</span></span><span id="cb4-2"><a href="#cb4-2"></a><span class="at">    </span><span class="fu">INFLUXDB_DATA_INDEX_VERSION</span><span class="kw">:</span><span class="at"> tsi1</span></span><span id="cb4-3"><a href="#cb4-3"></a><span class="at">    </span><span class="fu">INFLUXDB_MONITOR_STORE_ENABLED</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;false&quot;</span></span></code></pre></div><h2 id="效果验证">效果验证</h2><p><del>更改索引方式后内存使用依然在缓慢增长，但是保留策略设置的是一天，需要等到更改生效一天后才能看出真实的效果（待更新）。</del></p><p>超过保留策略（24 小时）的时间后（27 小时）内存增长停止，目前稳定在 235.3MiB，大致符合预期。</p><section class="footnotes" role="doc-endnotes"><hr><ol><li id="fn1" role="doc-endnote"><p><a href="https://www.jianshu.com/p/dbbb73b537e1" target="_blank" rel="noopener">https://www.jianshu.com/p/dbbb73b537e1</a> "InfluxDB频繁OOM问题排查 - 简书"<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li><li id="fn2" role="doc-endnote"><p><a href="https://docs.influxdata.com/platform/monitoring/influxdata-platform/tools/measurements-internal/" target="_blank" rel="noopener">https://docs.influxdata.com/platform/monitoring/influxdata-platform/tools/measurements-internal/</a> "InfluxDB _internal measurements and fields"<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li></ol></section>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最近给小程序的后端日志加上了实时输出到前端功能，为了展示就得保存日志，又考虑到日志是时序数据，自然就选择了时序数据库 &lt;a href=&quot;https://www.influxdata.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;InfluxDB&lt;/a&gt;，并且通过 Docker 部署。刚上线的一两天没有什么问题，各方面运行都很平稳，没过几天的一个早上突然收到了阿里云的报警，说内存占用超过了 95%。&lt;/p&gt;
&lt;p&gt;这便是噩梦的开始。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Docker" scheme="https://blog.dreace.top/categories/Docker/"/>
    
    
      <category term="Linux" scheme="https://blog.dreace.top/tags/Linux/"/>
    
      <category term="Docker" scheme="https://blog.dreace.top/tags/Docker/"/>
    
      <category term="InfluxDB" scheme="https://blog.dreace.top/tags/InfluxDB/"/>
    
  </entry>
  
  <entry>
    <title>Windows 上 DNS 解析慢，但 nslookup 正常</title>
    <link href="https://blog.dreace.top/2020/DNS-Resolution-is-Slow-on-Windows-but-nslookup-is-Normal/"/>
    <id>https://blog.dreace.top/2020/DNS-Resolution-is-Slow-on-Windows-but-nslookup-is-Normal/</id>
    <published>2020-04-15T09:54:12.000Z</published>
    <updated>2020-08-14T09:53:33.249Z</updated>
    
    <content type="html"><![CDATA[<p>今天一大早开始在电脑上所有的网站打开变得极慢，通过 SSH 连接服务器也非常慢，但 IP 直连速度又是正常的。初步猜测是 DNS 问题。</p><a id="more"></a><h2 id="定位问题">定位问题</h2><p>随后用 ping 测试发现需要好几秒钟才能解析出 IP，而用 nslookup 测试解析速度又是正常的。这下子基本知道问题了，又是系统 DNS 服务的锅，为什么是<strong>又</strong>呢？因为之前系统 DNS 服务把一些域名解析到了教育网，导致一些网站 CSS 加载失败，加了 hosts 之后才勉强正常。前一次的问题影响不是很大，可这次就不一样了，所有的网站打开都要等几秒钟，这可忍不了。</p><p>这里说一下为什么通过 ping 和 nslookup 就能断定系统 DNS 服务有问题呢，因为 ping 在解析域名时用的时系统 DNS 服务，而 nslookup 是直接通过 <a href="https://zh.wikipedia.org/wiki/Winsock" target="_blank" rel="noopener">Winsock</a> 建立连接查询的<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>。</p><p>用 <a href="https://www.wireshark.org/" target="_blank" rel="noopener">Wireshark</a> 抓包发现使用 ping 时 DNS 查询报文也是很快响应了的，但是 ping 客户端似乎没有收到。到这里就陷入死胡同了，我对 Windows 内部的细节不了解，不能再往下定位问题。</p><h2 id="解决问题">解决问题</h2><p>由于上午事情比较多就暂时把这个问题放下了。</p><p>到了下午突然想起会不会又是 <a href="https://www.vmware.com/" target="_blank" rel="noopener">VMware</a> 虚拟网卡的问题，这里又是一个<strong>又</strong>😫，因为之前遇到过虚拟网卡导致移动热点 IP 冲突问题。尝试禁用以 <code>VMware Virtual Ethernet Adapter</code> 开头的网卡，再次测试，ping 和打开网页都已正常。</p><h2 id="后记">后记</h2><p>这次虽然解决了问题，但是具体原因还不清楚，日后搞清楚问题再更新这篇文章</p><section class="footnotes" role="doc-endnotes"><hr><ol><li id="fn1" role="doc-endnote"><p><a href="https://superuser.com/questions/495759/why-is-ping-unable-to-resolve-a-name-when-nslookup-works-fine" target="_blank" rel="noopener">https://superuser.com/questions/495759/why-is-ping-unable-to-resolve-a-name-when-nslookup-works-fine</a> "Why is 'ping' unable to resolve a name when 'nslookup' works fine?"<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li></ol></section>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;今天一大早开始在电脑上所有的网站打开变得极慢，通过 SSH 连接服务器也非常慢，但 IP 直连速度又是正常的。初步猜测是 DNS 问题。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Windows" scheme="https://blog.dreace.top/categories/Windows/"/>
    
    
      <category term="DNS" scheme="https://blog.dreace.top/tags/DNS/"/>
    
      <category term="Windows" scheme="https://blog.dreace.top/tags/Windows/"/>
    
  </entry>
  
  <entry>
    <title>MySQL 多关键词匹配</title>
    <link href="https://blog.dreace.top/2020/MySQL-Multiple-Keyword-Matching/"/>
    <id>https://blog.dreace.top/2020/MySQL-Multiple-Keyword-Matching/</id>
    <published>2020-03-20T08:47:09.000Z</published>
    <updated>2020-08-14T09:53:33.249Z</updated>
    
    <content type="html"><![CDATA[<p>在 MySQL 中像搜索引擎一样查找多个关键词只使用 <code>LIKE</code> 实现比较困难，如果硬写也可以拼接很长的 SQL 实现，但有点太暴力了。因此需要一个简洁的方法来实现这个需求，这就是这篇文章要探讨的问题。</p><a id="more"></a><h2 id="分析">分析</h2><p>使用搜索引擎可以搜索使用空格分割的多个关键词，例如 <code>Python MySQL 回滚</code> 能够搜索到同时包含这个三个关键词的结果，并且是顺序无关的。要是用 <code>LIKE</code> 来进行模糊匹配就要拼接一个又臭又长的 SQL，这个可能并不是我们想要的，除了 <code>LIKE</code> 还有什么好的办法呢。正则表达式！用正则表达式可以很容易实现这个需求。</p><p>既然有了办法开始写代码，首先考虑如何根据搜索输入 <code>Python MySQL 回滚</code> 匹配下面的字符串：</p><div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a>Python 中回滚 MySQL 操作。</span></code></pre></div><p>这个字符串中关键词输入顺序和输入的关键词顺序不同，但是顺序对结果不会产生影响。为了同时匹配多个关键词可以先拆分为多个独立的关键词分开匹配，若前一个成功则继续匹配知道所有关键词都成功匹配。</p><p>我们可以使用正则中的零宽先行断言（<code>(?=exp)</code>）<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>，它可以匹配以 <code>exp</code> 为后缀的字符串，之后的匹配将从 <code>exp</code> 前一个位置继续。</p><p>如果写成 <code>(?=.*exp)</code>，它将从后向前匹配以 <code>exp</code> 为后缀的字符串，若匹配式中包含多个零宽先行断言每一次匹配都从最后开始。</p><p>这样关键问题已解决，对于 <code>Python MySQL 回滚</code> 完整的表达式为：</p><div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a>(?<span class="op">=</span>.<span class="op">*</span>Python)(?<span class="op">=</span>.<span class="op">*</span>MySQL)(?<span class="op">=</span>.<span class="op">*</span>回滚)</span></code></pre></div><p>上面这个正则表达式可以判断一个字符串是否包含这三个关键词，若要提取成功匹配的字符串可以写成：</p><div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a>(?<span class="op">=</span>.<span class="op">*</span>Python)(?<span class="op">=</span>.<span class="op">*</span>MySQL)(?<span class="op">=</span>.<span class="op">*</span>回滚)<span class="op">^</span>.<span class="op">*</span>$</span></code></pre></div><h2 id="代码实现">代码实现</h2><p>下面写一个用正则在 MySQL 中进行多关键词查找的实例。</p><p>假设有一张表，结构如下：</p><pre><code>CREATE TABLE `课程-2020-1`  (  `教学班编号` varchar(32) CHARACTER SET utf8 COLLATE utf8_bin NOT NULL,  `学院` varchar(50) CHARACTER SET utf8 COLLATE utf8_bin NOT NULL,  `课程名` varchar(255) CHARACTER SET utf8 COLLATE utf8_bin NOT NULL,  `教师` varchar(25) CHARACTER SET utf8 COLLATE utf8_bin NULL DEFAULT NULL,  `周次` varchar(20) CHARACTER SET utf8 COLLATE utf8_bin NULL DEFAULT NULL,  `星期` int(11) NOT NULL,  `开始节次` int(11) NULL DEFAULT NULL,  `时长节次` int(11) NULL DEFAULT NULL,  `教学楼` varchar(50) CHARACTER SET utf8 COLLATE utf8_bin NULL DEFAULT NULL,  `教室` varchar(50) CHARACTER SET utf8 COLLATE utf8_bin NULL DEFAULT NULL,  PRIMARY KEY (`教学班编号`, `课程名`, `星期`) USING BTREE) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_bin ROW_FORMAT = Dynamic;</code></pre><p>我们希望能够同时匹配 <code>学院</code>、 <code>课程名</code>、<code>教师</code>三个字段中的值，例如输入 <code>工程 数据</code>，能够同时查找出「大数据学院」的「物联网工程技术基础」 和「信息与通信工程学院」的「大数据与云计算」课程，对应的 SQL 如下：</p><pre><code>SELECT * FROM `课程-2020-1` WHERE CONCAT_WS(&#39;&#39;, `学院`, `课程名`, `教师`) REGEXP &#39;(?=.*工程)(?=.*数据)&#39;</code></pre><p>其中 <code>CONCAT_WS('', `学院`, `课程名`, `教师`)</code> 将每行中 <code>学院</code>、 <code>课程名</code>、<code>教师</code> 字段的值连接形成一个字符串，第一个参数作为剩余参数间的分隔符<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>，<code>CONCAT_WS</code> 的作用类似 Python 和 JavaScript 中的 <code>join</code>。这里不使用 <code>CONCAT</code> 是因为 <code>教师</code> 字段可能为空值，进而导致 <code>CONCAT</code> 的返回结果也为空， 而 <code>CONCAT_WS</code> 会忽略空值。</p><p>搜索结果为：</p><figure><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/MySQL-Multiple-Keyword-Matching/image-20200320183837050.png" alt><figcaption>关键词"工程 数据"的搜索结果</figcaption></figure><p>完美实现！下面是输入关键词字符串生成对应 SQL 的 Python 代码：</p><pre><code>keywords_map = &quot;&quot;.join(map(lambda k: &quot;(?=.*%s)&quot; % k, keywords.split(&quot; &quot;)))sql = &quot;SELECT * FROM `课程-2020-1` WHERE CONCAT_WS(&#39;&#39;, `学院`, `课程名`, `教师`) REGEXP &#39;%s^.*$&#39;&quot; % keywords_map</code></pre><section class="footnotes" role="doc-endnotes"><hr><ol><li id="fn1" role="doc-endnote"><p><a href="https://www.cnblogs.com/symbol441/articles/957950.html" target="_blank" rel="noopener">https://www.cnblogs.com/symbol441/articles/957950.html</a> "正则表达式的分组"<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li><li id="fn2" role="doc-endnote"><p><a href="https://www.cnblogs.com/locoy/archive/2006/10/28/542751.html" target="_blank" rel="noopener">https://www.cnblogs.com/locoy/archive/2006/10/28/542751.html</a> "CONCAT_WS的用法"<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li></ol></section>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在 MySQL 中像搜索引擎一样查找多个关键词只使用 &lt;code&gt;LIKE&lt;/code&gt; 实现比较困难，如果硬写也可以拼接很长的 SQL 实现，但有点太暴力了。因此需要一个简洁的方法来实现这个需求，这就是这篇文章要探讨的问题。&lt;/p&gt;
    
    </summary>
    
    
      <category term="MySQL" scheme="https://blog.dreace.top/categories/MySQL/"/>
    
    
      <category term="MySQL" scheme="https://blog.dreace.top/tags/MySQL/"/>
    
      <category term="数据库" scheme="https://blog.dreace.top/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
      <category term="SQL" scheme="https://blog.dreace.top/tags/SQL/"/>
    
      <category term="正则表达式" scheme="https://blog.dreace.top/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>解决“由于系统缓冲区空间不足或队列已满，不能执行套接字上的操作”</title>
    <link href="https://blog.dreace.top/2020/Solve-An-operation-on-a-socket-could-not-be-performed-because-the-system-lacked-sufficient-buffer-space-or-because-a-queue-was-full/"/>
    <id>https://blog.dreace.top/2020/Solve-An-operation-on-a-socket-could-not-be-performed-because-the-system-lacked-sufficient-buffer-space-or-because-a-queue-was-full/</id>
    <published>2020-02-21T11:05:53.000Z</published>
    <updated>2020-08-14T09:53:33.249Z</updated>
    
    <content type="html"><![CDATA[<p>最近写了个小工具，需要往 MySQL 中快速写入数据（5000 条数据左右）。刚开始很正常，跑了几分钟后报了一个错误 <code>由于系统缓冲区空间不足或队列已满，不能执行套接字上的操作</code>，这个问题以前也遇到过，只是通过简单的重启解决。虽然这次也通过重启把系统恢复正常了，可数据还没写到数据库里呢，于是花了点事件把这个问题彻底解决。</p><a id="more"></a><h2 id="问题分析">问题分析</h2><p>从报错的字面意思就能看出来系统的 Socket 资源耗尽无法建立新的链接。经查询得知 Windows 10 中默认允许用户使用的端口数是 1500，并且端口关闭后需要经过 60 秒才能重新被使用<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>。查看数据库已写入的数据在 1600 条左右，和 1500 这个限制比较接近，由此问题被大致定位。</p><h2 id="解决问题">解决问题</h2><p>既然已经知道问题的根本原因，解决方法也呼之欲出：修改限制。在“注册表编辑器中”找到 <code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters</code>。，修改 <code>MaxUserPort</code> 的值为 <code>65534</code>（十进制）或 <code>fffe</code>（十六进制）。同时也可以修改端口关闭后可重新使用的等待时间，在相同位置新建一个 <code>DWORD</code> 类型名称为 <code>TcpTimedWaitDelay</code> 的项目，其值表示等待多少秒后端口可以被重新使用。</p><p>完成之后重启。</p><p>再次运行，问题已经解决。</p><section class="footnotes" role="doc-endnotes"><hr><ol><li id="fn1" role="doc-endnote"><p><a href="https://support.microsoft.com/en-us/help/196271/when-you-try-to-connect-from-tcp-ports-greater-than-5000-you-receive-t" target="_blank" rel="noopener">https://support.microsoft.com/en-us/help/196271/when-you-try-to-connect-from-tcp-ports-greater-than-5000-you-receive-t</a> "When you try to connect from TCP ports greater than 5000 you receive the error 'WSAENOBUFS (10055)'"<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li></ol></section>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最近写了个小工具，需要往 MySQL 中快速写入数据（5000 条数据左右）。刚开始很正常，跑了几分钟后报了一个错误 &lt;code&gt;由于系统缓冲区空间不足或队列已满，不能执行套接字上的操作&lt;/code&gt;，这个问题以前也遇到过，只是通过简单的重启解决。虽然这次也通过重启把系统恢复正常了，可数据还没写到数据库里呢，于是花了点事件把这个问题彻底解决。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Windows" scheme="https://blog.dreace.top/categories/Windows/"/>
    
    
      <category term="Windows" scheme="https://blog.dreace.top/tags/Windows/"/>
    
      <category term="注册表" scheme="https://blog.dreace.top/tags/%E6%B3%A8%E5%86%8C%E8%A1%A8/"/>
    
  </entry>
  
  <entry>
    <title>Electron + Vue.js 打造桌面端跨平台应用#1 环境搭建</title>
    <link href="https://blog.dreace.top/2020/Electron-Vue-js-for-Desktop-Cross-platform-Application-1-Environment-Setup/"/>
    <id>https://blog.dreace.top/2020/Electron-Vue-js-for-Desktop-Cross-platform-Application-1-Environment-Setup/</id>
    <published>2020-01-20T14:03:48.000Z</published>
    <updated>2020-08-14T09:53:33.249Z</updated>
    
    <content type="html"><![CDATA[<p>最近突然有个想法打算做一个桌面应用，打算跨平台，技术选型在 Qt 和 Electron 之间定，经过一晚上的深思熟虑（并没有）最终决定采用 Electron + Vue.js 方案。谁让咱是个末流程序猿👨‍💻，UI / UX 不会做，图也不会画，只能用用别人造好的轮子。Web 这边 UI 组件问题不用担心，起码做出来的东西外观看起来还可以，希望如此。</p><p>下面将使用最新的 Electron 和 Vue CLI 搭建一个 demo 出来。</p><a id="more"></a><h2 id="环境搭建1">环境搭建<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></h2><h3 id="x01-环境配置">0x01 环境配置</h3><p>Node.js 是必须的，如果还没有安装请看<a href="https://nodejs.org/zh-cn/" target="_blank" rel="noopener">这里</a>。</p><p>由于众所周知的原因，在国内下载一些东西会很慢，所以需要使用国内的镜像来加速之后的安装过程。</p><p>设置 NPM 的环境变量：</p><div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1"></a><span class="ex">npm</span> config set registry http://registry.npm.taobao.org/</span><span id="cb1-2"><a href="#cb1-2"></a><span class="ex">npm</span> config set electron_mirror https://cdn.npm.taobao.org/dist/electron/</span></code></pre></div><h3 id="x02-安装工具">0x02 安装工具</h3><p>执行：</p><div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1"></a><span class="ex">npm</span> install @vue/cli -g</span></code></pre></div><h3 id="x03-创建初始项目">0x03 创建初始项目</h3><p>切换到存放项目的目录，这里假设新建的项目名为 <code>electron-vue-demo</code></p><p>创建项目：</p><div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1"></a><span class="ex">vue</span> create electron-vue-demo</span></code></pre></div><p>接下来设置项目的基础配置。</p><h4 id="选择预设">选择预设</h4><figure><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/Electron-Vue-js-for-Desktop-Cross-platform-Application-1-Environment-Setup/image-20200120225427901.png" alt><figcaption>选择预设</figcaption></figure><p>这里我选择手动设置（Manually select features）。</p><h4 id="选择工具">选择工具</h4><figure><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/Electron-Vue-js-for-Desktop-Cross-platform-Application-1-Environment-Setup/image-20200120225453779.png" alt><figcaption>选择工具</figcaption></figure><p>根据项目的需要选择工具（<code>空格</code> 选择），然后 <code>回车</code> 确认。</p><h4 id="选择路由模式">选择路由模式</h4><figure><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/Electron-Vue-js-for-Desktop-Cross-platform-Application-1-Environment-Setup/image-20200120225857040.png" alt><figcaption>选择路由模式</figcaption></figure><p>选择 history 还是 hash 样式的路由，history 链接格式比较好看，但是需要服务器支持，由于这是 Electron 项目只能选择 hash 样式（<code>n</code>）。反正用户看不到具体的链接，难看点也能接受。</p><h4 id="选择-eslint-配置">选择 ESLint 配置</h4><figure><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/Electron-Vue-js-for-Desktop-Cross-platform-Application-1-Environment-Setup/image-20200120225624117.png" alt><figcaption>选择 ESLint 配置</figcaption></figure><p>这里选择标准配置（ESLint + Standard config）。</p><h4 id="选择何时进行格式检查">选择何时进行格式检查</h4><figure><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/Electron-Vue-js-for-Desktop-Cross-platform-Application-1-Environment-Setup/image-20200120225701244.png" alt><figcaption>选择何时进行格式检查</figcaption></figure><p>这里选择仅在保存时检查（Lint on save）。</p><h4 id="选择单元测试方案">选择单元测试方案</h4><figure><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/Electron-Vue-js-for-Desktop-Cross-platform-Application-1-Environment-Setup/image-20200120225724202.png" alt><figcaption>选择单元测试方案</figcaption></figure><p>如果之前未选择单元测试则不会出现这个选项。</p><p>这里选择 Mocha + Chai。</p><h4 id="选择在何处存放配置信息">选择在何处存放配置信息</h4><figure><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/Electron-Vue-js-for-Desktop-Cross-platform-Application-1-Environment-Setup/image-20200120231432550.png" alt><figcaption>选择在何处存放配置信息</figcaption></figure><p>这里选择放在 <code>package.json</code> 文件中。</p><h4 id="选择是否保存配置">选择是否保存配置</h4><figure><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/Electron-Vue-js-for-Desktop-Cross-platform-Application-1-Environment-Setup/image-20200120225816311.png" alt><figcaption>选择是否保存配置</figcaption></figure><p>如果选择 <code>y</code> 先前的配置会保存为预设备以后的项目使用，这里选择 <code>n</code>。</p><h4 id="等待安装">等待安装</h4><p>等待所有依赖安装完成，时间取决于网络情况。</p><h3 id="x04-安装-electron-builder">0x04 安装 electron-builder</h3><p>electron-builder 是一个功能强大的 Electron 打包工具。</p><p>使用 Vue CLI 添加：</p><div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1"></a><span class="ex">vue</span> add electron-builder</span></code></pre></div><p>可能会出现更改未提交的提示，跳过即可。</p><figure><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/Electron-Vue-js-for-Desktop-Cross-platform-Application-1-Environment-Setup/image-20200121110345907.png" alt><figcaption>更改未提交</figcaption></figure><h4 id="选择-electron-版本">选择 Electron 版本</h4><figure><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/Electron-Vue-js-for-Desktop-Cross-platform-Application-1-Environment-Setup/image-20200121111053872.png" alt><figcaption>选择 Electron 版本</figcaption></figure><p>目前 Electron 最新版本是 7.x，但是这里没有 7.0.0 选择，先选择 6.0.0 安装完成后再手动升级。</p><h4 id="是否添加测试">是否添加测试</h4><figure><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/Electron-Vue-js-for-Desktop-Cross-platform-Application-1-Environment-Setup/image-20200121111846090.png" alt><figcaption>是否添加测试</figcaption></figure><p>根据项目需要添加测试，这里选择 <code>y</code>。</p><h4 id="启用-devtools">启用 Devtools</h4><p>在 Electron 6.0.0 及更新版中，若开启了 Windows 10 黑暗模式 Devtools 会出现问题，如果没有开启黑暗模式，或者是非 Windows 平台则没有影响。</p><p>目前为止（2020年1月21日）相关问题 <a href="https://github.com/nklayman/vue-cli-plugin-electron-builder/issues/378" target="_blank" rel="noopener">Electron 6.0.0 does not launch in Windows 10 Dark Mode</a> 还没有解决。</p><p>在 <code>background.js</code> 找到如下代码：</p><div class="sourceCode" id="cb5"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1"></a><span class="va">app</span>.<span class="at">on</span>(<span class="st">&#39;ready&#39;</span><span class="op">,</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> <span class="op">{</span></span><span id="cb5-2"><a href="#cb5-2"></a>  <span class="cf">if</span> (isDevelopment <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="va">process</span>.<span class="va">env</span>.<span class="at">IS_TEST</span>) <span class="op">{</span></span><span id="cb5-3"><a href="#cb5-3"></a>    <span class="co">// Install Vue Devtools</span></span><span id="cb5-4"><a href="#cb5-4"></a>    <span class="co">// Devtools extensions are broken in Electron 6.0.0 and greater</span></span><span id="cb5-5"><a href="#cb5-5"></a>    <span class="co">// See https://github.com/nklayman/vue-cli-plugin-electron-builder/issues/378 for more info</span></span><span id="cb5-6"><a href="#cb5-6"></a>    <span class="co">// Electron will not launch with Devtools extensions installed on Windows 10 with dark mode</span></span><span id="cb5-7"><a href="#cb5-7"></a>    <span class="co">// If you are not using Windows 10 dark mode, you may uncomment these lines</span></span><span id="cb5-8"><a href="#cb5-8"></a>    <span class="co">// In addition, if the linked issue is closed, you can upgrade electron and uncomment these lines</span></span><span id="cb5-9"><a href="#cb5-9"></a>    <span class="co">// try {</span></span><span id="cb5-10"><a href="#cb5-10"></a>    <span class="co">//   await installVueDevtools()</span></span><span id="cb5-11"><a href="#cb5-11"></a>    <span class="co">// } catch (e) {</span></span><span id="cb5-12"><a href="#cb5-12"></a>    <span class="co">//   console.error(&#39;Vue Devtools failed to install:&#39;, e.toString())</span></span><span id="cb5-13"><a href="#cb5-13"></a>    <span class="co">// }</span></span><span id="cb5-14"><a href="#cb5-14"></a></span><span id="cb5-15"><a href="#cb5-15"></a>  <span class="op">}</span></span><span id="cb5-16"><a href="#cb5-16"></a>  <span class="at">createWindow</span>()</span><span id="cb5-17"><a href="#cb5-17"></a><span class="op">}</span>)</span></code></pre></div><p>取消注释：</p><div class="sourceCode" id="cb6"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb6-1"><a href="#cb6-1"></a><span class="va">app</span>.<span class="at">on</span>(<span class="st">&#39;ready&#39;</span><span class="op">,</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> <span class="op">{</span></span><span id="cb6-2"><a href="#cb6-2"></a>  <span class="cf">if</span> (isDevelopment <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="va">process</span>.<span class="va">env</span>.<span class="at">IS_TEST</span>) <span class="op">{</span></span><span id="cb6-3"><a href="#cb6-3"></a>    <span class="cf">try</span> <span class="op">{</span></span><span id="cb6-4"><a href="#cb6-4"></a>      <span class="cf">await</span> <span class="at">installVueDevtools</span>()</span><span id="cb6-5"><a href="#cb6-5"></a>    <span class="op">}</span> <span class="cf">catch</span> (e) <span class="op">{</span></span><span id="cb6-6"><a href="#cb6-6"></a>      <span class="va">console</span>.<span class="at">error</span>(<span class="st">&#39;Vue Devtools failed to install:&#39;</span><span class="op">,</span> <span class="va">e</span>.<span class="at">toString</span>())</span><span id="cb6-7"><a href="#cb6-7"></a>    <span class="op">}</span></span><span id="cb6-8"><a href="#cb6-8"></a>  <span class="op">}</span></span><span id="cb6-9"><a href="#cb6-9"></a>  <span class="at">createWindow</span>()</span><span id="cb6-10"><a href="#cb6-10"></a><span class="op">}</span>)</span></code></pre></div><p>这样就能正常使用 Devtools。</p><h4 id="修改-electron-版本">修改 Electron 版本</h4><p>修改 <code>package.json</code> 中：</p><div class="sourceCode" id="cb7"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb7-1"><a href="#cb7-1"></a><span class="er">&quot;electron&quot;:</span> <span class="er">&quot;^6.0.0&quot;,</span></span></code></pre></div><p>为</p><div class="sourceCode" id="cb8"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb8-1"><a href="#cb8-1"></a><span class="er">&quot;electron&quot;:</span> <span class="er">&quot;^7.0.0&quot;,</span></span></code></pre></div><p>然后执行 <code>npm install</code> 安装最新的 Electron。</p><h2 id="安装完成">安装完成</h2><h3 id="x01-运行开发版">0x01 运行开发版</h3><p>执行：</p><div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1"></a><span class="ex">npm</span> run electron:serve</span></code></pre></div><p>即可运行开发版本的应用， Devtools 可以正常使用。</p><figure><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/Electron-Vue-js-for-Desktop-Cross-platform-Application-1-Environment-Setup/image-20200121135306530.png" alt><figcaption>运行成功</figcaption></figure><h3 id="x02-构建生产版">0x02 构建生产版</h3><p>在项目根目录新建 <code>vue.config.js</code> 文件，并写入<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>：</p><div class="sourceCode" id="cb10"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb10-1"><a href="#cb10-1"></a><span class="va">module</span>.<span class="at">exports</span> <span class="op">=</span> <span class="op">{</span></span><span id="cb10-2"><a href="#cb10-2"></a>  <span class="dt">pluginOptions</span><span class="op">:</span> <span class="op">{</span></span><span id="cb10-3"><a href="#cb10-3"></a>    <span class="dt">electronBuilder</span><span class="op">:</span> <span class="op">{</span></span><span id="cb10-4"><a href="#cb10-4"></a>      <span class="dt">builderOptions</span><span class="op">:</span> <span class="op">{</span></span><span id="cb10-5"><a href="#cb10-5"></a>        <span class="dt">productName</span><span class="op">:</span> <span class="st">&#39;electron-vue-demo&#39;</span><span class="op">,</span></span><span id="cb10-6"><a href="#cb10-6"></a>        <span class="dt">appId</span><span class="op">:</span> <span class="st">&#39;com.dreace.electron-vue-demo&#39;</span><span class="op">,</span></span><span id="cb10-7"><a href="#cb10-7"></a>        <span class="dt">directories</span><span class="op">:</span> <span class="op">{</span></span><span id="cb10-8"><a href="#cb10-8"></a>          <span class="dt">output</span><span class="op">:</span> <span class="st">&#39;dist_electron&#39;</span></span><span id="cb10-9"><a href="#cb10-9"></a>        <span class="op">},</span></span><span id="cb10-10"><a href="#cb10-10"></a>        <span class="dt">nsis</span><span class="op">:</span> <span class="op">{</span></span><span id="cb10-11"><a href="#cb10-11"></a>          <span class="dt">oneClick</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span><span id="cb10-12"><a href="#cb10-12"></a>          <span class="dt">allowElevation</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span><span id="cb10-13"><a href="#cb10-13"></a>          <span class="dt">allowToChangeInstallationDirectory</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span><span id="cb10-14"><a href="#cb10-14"></a>          <span class="dt">installerIcon</span><span class="op">:</span> <span class="st">&#39;public/icon.ico&#39;</span><span class="op">,</span></span><span id="cb10-15"><a href="#cb10-15"></a>          <span class="dt">uninstallerIcon</span><span class="op">:</span> <span class="st">&#39;public/icon.ico&#39;</span><span class="op">,</span></span><span id="cb10-16"><a href="#cb10-16"></a>          <span class="dt">installerHeaderIcon</span><span class="op">:</span> <span class="st">&#39;public/icon.ico&#39;</span><span class="op">,</span></span><span id="cb10-17"><a href="#cb10-17"></a>          <span class="dt">createDesktopShortcut</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span><span id="cb10-18"><a href="#cb10-18"></a>          <span class="dt">createStartMenuShortcut</span><span class="op">:</span> <span class="kw">true</span></span><span id="cb10-19"><a href="#cb10-19"></a>        <span class="op">},</span></span><span id="cb10-20"><a href="#cb10-20"></a>        <span class="dt">dmg</span><span class="op">:</span> <span class="op">{</span></span><span id="cb10-21"><a href="#cb10-21"></a>          <span class="dt">contents</span><span class="op">:</span> [</span><span id="cb10-22"><a href="#cb10-22"></a>            <span class="op">{</span></span><span id="cb10-23"><a href="#cb10-23"></a>              <span class="dt">x</span><span class="op">:</span> <span class="dv">410</span><span class="op">,</span></span><span id="cb10-24"><a href="#cb10-24"></a>              <span class="dt">y</span><span class="op">:</span> <span class="dv">150</span><span class="op">,</span></span><span id="cb10-25"><a href="#cb10-25"></a>              <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;link&#39;</span><span class="op">,</span></span><span id="cb10-26"><a href="#cb10-26"></a>              <span class="dt">path</span><span class="op">:</span> <span class="st">&#39;/Applications&#39;</span></span><span id="cb10-27"><a href="#cb10-27"></a>            <span class="op">},</span></span><span id="cb10-28"><a href="#cb10-28"></a>            <span class="op">{</span></span><span id="cb10-29"><a href="#cb10-29"></a>              <span class="dt">x</span><span class="op">:</span> <span class="dv">130</span><span class="op">,</span></span><span id="cb10-30"><a href="#cb10-30"></a>              <span class="dt">y</span><span class="op">:</span> <span class="dv">150</span><span class="op">,</span></span><span id="cb10-31"><a href="#cb10-31"></a>              <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;file&#39;</span></span><span id="cb10-32"><a href="#cb10-32"></a>            <span class="op">}</span></span><span id="cb10-33"><a href="#cb10-33"></a>          ]</span><span id="cb10-34"><a href="#cb10-34"></a>        <span class="op">},</span></span><span id="cb10-35"><a href="#cb10-35"></a>        <span class="dt">mac</span><span class="op">:</span> <span class="op">{</span></span><span id="cb10-36"><a href="#cb10-36"></a>          <span class="dt">icon</span><span class="op">:</span> <span class="st">&#39;public/icon.icns&#39;</span></span><span id="cb10-37"><a href="#cb10-37"></a>        <span class="op">},</span></span><span id="cb10-38"><a href="#cb10-38"></a>        <span class="dt">win</span><span class="op">:</span> <span class="op">{</span></span><span id="cb10-39"><a href="#cb10-39"></a>          <span class="dt">icon</span><span class="op">:</span> <span class="st">&#39;public/icon.ico&#39;</span><span class="op">,</span></span><span id="cb10-40"><a href="#cb10-40"></a>          <span class="dt">target</span><span class="op">:</span> [</span><span id="cb10-41"><a href="#cb10-41"></a>            <span class="op">{</span></span><span id="cb10-42"><a href="#cb10-42"></a>              <span class="dt">target</span><span class="op">:</span> <span class="st">&#39;nsis&#39;</span></span><span id="cb10-43"><a href="#cb10-43"></a>            <span class="op">}</span></span><span id="cb10-44"><a href="#cb10-44"></a>          ]</span><span id="cb10-45"><a href="#cb10-45"></a>        <span class="op">},</span></span><span id="cb10-46"><a href="#cb10-46"></a>        <span class="dt">linux</span><span class="op">:</span> <span class="op">{</span></span><span id="cb10-47"><a href="#cb10-47"></a>          <span class="dt">icon</span><span class="op">:</span> <span class="st">&#39;public/icon.icons&#39;</span></span><span id="cb10-48"><a href="#cb10-48"></a>        <span class="op">}</span></span><span id="cb10-49"><a href="#cb10-49"></a>      <span class="op">}</span></span><span id="cb10-50"><a href="#cb10-50"></a>    <span class="op">}</span></span><span id="cb10-51"><a href="#cb10-51"></a>  <span class="op">}</span></span><span id="cb10-52"><a href="#cb10-52"></a><span class="op">}</span></span></code></pre></div><p>并将图标放置在 <code>./public</code> 路径下。</p><figure><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/Electron-Vue-js-for-Desktop-Cross-platform-Application-1-Environment-Setup/image-20200121140443054.png" alt><figcaption>图标位置</figcaption></figure><p>这里配置在 Windows 环境下将构建 NSIS 安装包，并允许用户自定义安目录，更多的配置选项可查看 <a href="https://www.electron.build/" target="_blank" rel="noopener">electron-builder 文档</a>。</p><p>然后执行：</p><div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1"></a><span class="ex">npm</span> run electron:build</span></code></pre></div><p><strong>若首次运行出现 winCodeSign 下载失败，可尝试将安全软件关闭后重试</strong></p><p>执行完成后在 <code>./dist_electron</code> 路径下可找到构建的安装包，双击即可执行安装。</p><figure><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/Electron-Vue-js-for-Desktop-Cross-platform-Application-1-Environment-Setup/image-20200121141255491.png" alt><figcaption>构建的安装包</figcaption></figure><figure><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/Electron-Vue-js-for-Desktop-Cross-platform-Application-1-Environment-Setup/image-20200121141916527.png" alt><figcaption>安装后的桌面图标</figcaption></figure><figure><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/Electron-Vue-js-for-Desktop-Cross-platform-Application-1-Environment-Setup/image-20200121142011185.png" alt><figcaption>运行生产构建版本</figcaption></figure><h2 id="写在后面">写在后面</h2><p>到此为止，一个最基础的 Electron + Vue.js 跨平台应用搭建完成，接下来就是具体的逻辑编写，希望这个项目不会流产。</p><p>更多内容可查看 <a href="https://electronjs.org/" target="_blank" rel="noopener">Electron 文档</a> 与 <a href="https://cn.vuejs.org/v2/guide/" target="_blank" rel="noopener">Vue.js 教程</a>。</p><section class="footnotes" role="doc-endnotes"><hr><ol><li id="fn1" role="doc-endnote"><p><a href="https://youyou-tech.com/2019/12/17/Electron7%2BVueCli4%E5%BC%80%E5%8F%91%E8%B7%A8/" target="_blank" rel="noopener">https://youyou-tech.com/2019/12/17/Electron7%2BVueCli4%E5%BC%80%E5%8F%91%E8%B7%A8/</a> "Electron7+VueCli4开发跨平台桌面应用"<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li><li id="fn2" role="doc-endnote"><p><a href="https://juejin.im/post/5bc53aade51d453df0447927" target="_blank" rel="noopener">https://juejin.im/post/5bc53aade51d453df0447927</a> "electron-builder打包见解"<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li></ol></section>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最近突然有个想法打算做一个桌面应用，打算跨平台，技术选型在 Qt 和 Electron 之间定，经过一晚上的深思熟虑（并没有）最终决定采用 Electron + Vue.js 方案。谁让咱是个末流程序猿👨‍💻，UI / UX 不会做，图也不会画，只能用用别人造好的轮子。Web 这边 UI 组件问题不用担心，起码做出来的东西外观看起来还可以，希望如此。&lt;/p&gt;
&lt;p&gt;下面将使用最新的 Electron 和 Vue CLI 搭建一个 demo 出来。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Vue.js" scheme="https://blog.dreace.top/categories/Vue-js/"/>
    
    
      <category term="Vue.js" scheme="https://blog.dreace.top/tags/Vue-js/"/>
    
      <category term="Electron" scheme="https://blog.dreace.top/tags/Electron/"/>
    
      <category term="跨平台" scheme="https://blog.dreace.top/tags/%E8%B7%A8%E5%B9%B3%E5%8F%B0/"/>
    
      <category term="桌面端" scheme="https://blog.dreace.top/tags/%E6%A1%8C%E9%9D%A2%E7%AB%AF/"/>
    
  </entry>
  
  <entry>
    <title>博客迁移日志其二 使用 Github Actions 自动部署 Hexo</title>
    <link href="https://blog.dreace.top/2020/Blog-Transfer-Record-2-Automate-Hexo-Deployment-with-GitHub-Actions/"/>
    <id>https://blog.dreace.top/2020/Blog-Transfer-Record-2-Automate-Hexo-Deployment-with-GitHub-Actions/</id>
    <published>2020-01-10T05:59:18.000Z</published>
    <updated>2020-08-14T09:53:33.249Z</updated>
    
    <content type="html"><![CDATA[<p>上一篇博客<a href="/2019/Blog-Transfer-Record-1-From-WordPress-to-Hexo/" title="博客迁移日志其一 从 WordPress 到 Hexo">博客迁移日志其一 从 WordPress 到 Hexo</a>中已经完成将 WordPress 中的数据迁移到 Hexo，但是每次修改内容后都要手动生成静态网页然后同步到服务器，这些步骤还是很繁琐的。因此需要一个自动化的流程来帮助部署博客，<a href="https://github.com/features/actions" target="_blank" rel="noopener">GitHub Actions</a> 可以很好的满足这个需求。</p><a id="more"></a><h2 id="配置目标服务器">配置目标服务器</h2><p>在开始前需要在部署 Hexo 的服务器新建一个空的 Git 仓库，以及设置通过私钥登录。以下使用的命令以 CentOS 为例，其他 Linux 版本同理。</p><h3 id="x01-安装-git1">0x01 安装 Git<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></h3><p>直接安装：</p><div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">sudo</span> yum install git</span></code></pre></div><h3 id="x02-创建新用户">0x02 创建新用户</h3><p>为了控制权限，可新建立一个名为 git 的用户：</p><div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">sudo</span> adduser git</span></code></pre></div><h3 id="x03-生成-ssh-密钥2">0x03 生成 SSH 密钥<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></h3><p>SSH 密钥用于部署时免密登录。使用 <code>ssh-keygen</code> 生成密钥，注意将 <code>your_email@example.com</code> 替换成自己的邮箱。</p><div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">ssh-keygen</span> -t rsa -b 4096 -C <span class="st">&quot;your_email@example.com&quot;</span></span></code></pre></div><p>询问存放位置：</p><pre><code>Enter file in which to save the key (/root/.ssh/id_rsa): </code></pre><p>直接回车使用默认设置即可（<code>/root/.ssh/id_rsa</code>）。</p><p>提示输入密码：</p><pre><code>Enter passphrase (empty for no passphrase): Enter same passphrase again: </code></pre><p>输入一个密码并重复，直接回车表示密码留空。</p><h3 id="x04-复制-ssh-密钥">0x04 复制 SSH 密钥</h3><p>将 <code>~/.ssh/id_rsa.pub</code> 中的内容添加到 <code>/home/git/.ssh/authorized_keys</code> 中，若该文件不存在可以手动创建。</p><h3 id="x05-创建裸仓库">0x05 创建裸仓库</h3><p>在 <code>/var/repo</code> 新建名为 <code>blog.git</code> 的仓库：</p><div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">sudo</span> mkdir /var/repo</span><span id="cb6-2"><a href="#cb6-2"></a><span class="bu">cd</span> /var/repo</span><span id="cb6-3"><a href="#cb6-3"></a><span class="fu">sudo</span> git init --bare blog.git</span></code></pre></div><p>裸仓库没有工作区，只是为了共享。</p><h3 id="x06-创建存放静态网页目录">0x06 创建存放静态网页目录</h3><p>创建目录：</p><div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1"></a><span class="bu">cd</span> /var/</span><span id="cb7-2"><a href="#cb7-2"></a><span class="fu">sudo</span> mkdir www</span><span id="cb7-3"><a href="#cb7-3"></a><span class="bu">cd</span> www</span><span id="cb7-4"><a href="#cb7-4"></a><span class="fu">sudo</span> mkdir html</span><span id="cb7-5"><a href="#cb7-5"></a><span class="bu">cd</span> html</span><span id="cb7-6"><a href="#cb7-6"></a><span class="fu">sudo</span> mkdir hexo</span></code></pre></div><p>以后生成的文件将存放在 <code>/var/www/html/hexo</code> 下。</p><p>更改权限：</p><div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1"></a><span class="bu">cd</span> /var/</span><span id="cb8-2"><a href="#cb8-2"></a><span class="fu">sudo</span> chmod -R 777 www</span><span id="cb8-3"><a href="#cb8-3"></a><span class="bu">cd</span> www</span><span id="cb8-4"><a href="#cb8-4"></a><span class="fu">sudo</span> chmod -R 777 html</span><span id="cb8-5"><a href="#cb8-5"></a><span class="bu">cd</span> html</span><span id="cb8-6"><a href="#cb8-6"></a><span class="fu">sudo</span> chmod -R 777 hexo</span></code></pre></div><h3 id="x07-配置-git-钩子">0x07 配置 Git 钩子</h3><p>进入 <code>/var/repo/blog.git/hooks</code>，创建编辑 <code>post-receive</code> 文件：</p><div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1"></a><span class="bu">cd</span> /var/repo/blog.git/hooks</span><span id="cb9-2"><a href="#cb9-2"></a><span class="fu">sudo</span> vim post-receive</span></code></pre></div><p>在 <code>post-receive</code> 写入：</p><div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1"></a><span class="fu">git</span> --work-tree=/var/www/html/hexo --git-dir=/var/repo/blog.git checkout -f</span></code></pre></div><p>表示每次 <code>push</code> 是文件将存放在 <code>/var/www/html/hexo</code> 下。</p><p>保存后赋予 <code>post-receive</code> 可执行权限：</p><div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1"></a><span class="fu">chmod</span> +x post-receive</span></code></pre></div><h3 id="x08-更改仓库目录所有者">0x08 更改仓库目录所有者</h3><p>将 <code>blog.git</code> 目录的所有者更改为 git 用户：</p><div class="sourceCode" id="cb12"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1"></a><span class="fu">sudo</span> chown -R git:git blog.git</span></code></pre></div><h3 id="x09-禁止-git-用户登录-shell">0x09 禁止 git 用户登录 shell</h3><p>编辑 <code>/etc/passwd</code>，找到</p><pre><code>git:x:1001:1001:git,,,:/home/git:/bin/bash</code></pre><p>修改为：</p><pre><code>git:x:1001:1001:,,,:/home/git:/usr/bin/git-shell</code></pre><p>这样 git 用户可以通过 SSH 使用 git，但不能使用 shell。</p><h2 id="配置-github-actions">配置 GitHub Actions</h2><h3 id="x01-添加私钥到-github-仓库">0x01 添加私钥到 GitHub 仓库</h3><p>如果存放 Hexo 源文件的仓库是公开的，为了不暴露私钥需要将之前生成的私钥保存到 <code>Secrets</code> 当中，需要时通过环境变量访问。</p><figure><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/Blog-Transfer-Record-2-Automate-Hexo-Deployment-with-GitHub-Actions/image-20200110155500166.png" alt><figcaption>添加 Secrets</figcaption></figure><p><code>Name</code> 填写为 <code>id_rsa</code>， <code>Value</code> 中填写之前生成的 <code>id_rsa</code> 文件中的内容，形如：</p><pre><code>-----BEGIN RSA PRIVATE KEY-----MIIJKQIBAAKCAgEAq0XtV523Wcgs/2DqFAxqicbHb4x0tvwt/mNe7pKBCLzkL551DyCHEYVoOVUbO3Fu80h5M7Ku4+ojWSZpCXwqabObTn1tTNUrubWi2OIfkqnzGn+T...6FEmudj4Bb1+GZPu7muNWYamydlCK8D7cAu6I/iRyC0ya5j9wDZpYXYr2fRzd4HfrsTNxNy45COZWr7IBbrb0+WBXlXwTrSx+XioRxEyukk1U79aIk3uvSP6C/4F-----END RSA PRIVATE KEY-----</code></pre><h3 id="x02-添加-github-actions">0x02 添加 GitHub Actions</h3><p>首先创建一个新的配置文件：</p><figure><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/Blog-Transfer-Record-2-Automate-Hexo-Deployment-with-GitHub-Actions/image-20200110155919909.png" alt><figcaption>新建配置文件</figcaption></figure><p>写入<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>：</p><div class="sourceCode" id="cb16"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb16-1"><a href="#cb16-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> Node CI</span></span><span id="cb16-2"><a href="#cb16-2"></a></span><span id="cb16-3"><a href="#cb16-3"></a><span class="fu">on</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">push</span><span class="kw">]</span></span><span id="cb16-4"><a href="#cb16-4"></a></span><span id="cb16-5"><a href="#cb16-5"></a><span class="fu">jobs</span><span class="kw">:</span></span><span id="cb16-6"><a href="#cb16-6"></a><span class="at">  </span><span class="fu">build</span><span class="kw">:</span></span><span id="cb16-7"><a href="#cb16-7"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span><span id="cb16-8"><a href="#cb16-8"></a><span class="at">    </span><span class="fu">strategy</span><span class="kw">:</span></span><span id="cb16-9"><a href="#cb16-9"></a><span class="at">      </span><span class="fu">matrix</span><span class="kw">:</span></span><span id="cb16-10"><a href="#cb16-10"></a><span class="at">        </span><span class="fu">node-version</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">10.x</span><span class="kw">]</span></span><span id="cb16-11"><a href="#cb16-11"></a></span><span id="cb16-12"><a href="#cb16-12"></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span><span id="cb16-13"><a href="#cb16-13"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v1</span></span><span id="cb16-14"><a href="#cb16-14"></a><span class="kw">      - </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Use Node.js $&lt;!--￼1--</span><span class="ch">&gt;</span></span><span id="cb16-15"><a href="#cb16-15"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/setup-node@v1</span></span><span id="cb16-16"><a href="#cb16-16"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span><span id="cb16-17"><a href="#cb16-17"></a><span class="fu">          node-version</span><span class="kw">: </span><span class="at">$&lt;!--￼2--</span><span class="ch">&gt;</span></span><span id="cb16-18"><a href="#cb16-18"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Configuration environment</span></span><span id="cb16-19"><a href="#cb16-19"></a><span class="at">        </span><span class="fu">env</span><span class="kw">:</span></span><span id="cb16-20"><a href="#cb16-20"></a><span class="fu">          ID_RSA</span><span class="kw">: </span><span class="at">$&lt;!--￼3--</span><span class="ch">&gt;</span></span><span id="cb16-21"><a href="#cb16-21"></a><span class="fu">        run</span><span class="kw">: </span><span class="ch">|</span></span><span id="cb16-22"><a href="#cb16-22"></a>          mkdir -p ~/.ssh/</span><span id="cb16-23"><a href="#cb16-23"></a>          echo &quot;$ID_RSA&quot; &gt; ~/.ssh/id_rsa</span><span id="cb16-24"><a href="#cb16-24"></a>          chmod 600 ~/.ssh/id_rsa</span><span id="cb16-25"><a href="#cb16-25"></a>          ssh-keyscan &lt;your_host&gt; &gt;&gt; ~/.ssh/known_hosts</span><span id="cb16-26"><a href="#cb16-26"></a>          git config --global user.name &#39;&lt;your_user_name&gt;&#39;</span><span id="cb16-27"><a href="#cb16-27"></a>          git config --global user.email &#39;&lt;your_email&gt;&#39;</span><span id="cb16-28"><a href="#cb16-28"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Install dependencies</span></span><span id="cb16-29"><a href="#cb16-29"></a><span class="fu">        run</span><span class="kw">: </span><span class="ch">|</span></span><span id="cb16-30"><a href="#cb16-30"></a>          npm i -g hexo-cli</span><span id="cb16-31"><a href="#cb16-31"></a>          npm i</span><span id="cb16-32"><a href="#cb16-32"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Deploy hexo</span></span><span id="cb16-33"><a href="#cb16-33"></a><span class="fu">        run</span><span class="kw">: </span><span class="ch">|</span></span><span id="cb16-34"><a href="#cb16-34"></a>          hexo g -d</span></code></pre></div><p>注意将 <code>&lt;your_host&gt;</code>、<code>&lt;your_user_name&gt;</code>、<code>&lt;your_email&gt;</code> 替换成自己的域名、用户名和邮箱。</p><h2 id="配置-hexo">配置 Hexo</h2><p>修改 Hexo 根目录下的 <code>_config.yml</code> 文件，添加：</p><div class="sourceCode" id="cb17"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb17-1"><a href="#cb17-1"></a><span class="fu">deploy</span><span class="kw">:</span></span><span id="cb17-2"><a href="#cb17-2"></a><span class="at">  </span><span class="fu">type</span><span class="kw">:</span><span class="at"> git</span></span><span id="cb17-3"><a href="#cb17-3"></a><span class="at">  </span><span class="fu">repo</span><span class="kw">:</span><span class="at"> git@&lt;your_host&gt;:/var/repo/blog.git</span></span><span id="cb17-4"><a href="#cb17-4"></a><span class="at">  </span><span class="fu">branch</span><span class="kw">:</span><span class="at"> master</span></span></code></pre></div><p>将 <code>&lt;your_host&gt;</code> 替换成自己的域名。</p><p>最后别忘了安装 <a href="https://github.com/hexojs/hexo-deployer-git" target="_blank" rel="noopener">hexo-deployer-git</a> 插件<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>。</p><div class="sourceCode" id="cb18"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1"></a><span class="ex">npm</span> install hexo-deployer-git --save</span></code></pre></div><h2 id="配置-nginx">配置 Nginx</h2><p>在 <code>/etc/nginx/conf.d</code> 下新增配置 <code>blog.conf</code>。</p><pre class="nginx"><code>server {    listen 443 ssl;    server_name &lt;your_host&gt;;    index index.html;      location / {        root &quot;/var/www/html/hexo&quot;;    }}server {    listen 80;    server_name &lt;your_host&gt;;    rewrite ^(.*) https://$host$1 permanent;}</code></pre><p>将 <code>&lt;your_host&gt;</code> 替换成自己的域名。</p><p>如果没有配置 SSL，<code>blog.conf</code> 应该写入：</p><pre class="nginx"><code>server {    listen 80;    server_name &lt;your_host&gt;;    index index.html;      location / {        root &quot;/var/www/html/hexo&quot;;    }}</code></pre><h2 id="测试">测试</h2><p>将本地文件推送至远程仓库，可以在 Actions 选项下看到触发了一次 GitHub Actions。</p><figure><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/Blog-Transfer-Record-2-Automate-Hexo-Deployment-with-GitHub-Actions/image-20200110161901448.png" alt><figcaption>Actions 执行成功</figcaption></figure><h2 id="最后">最后</h2><p>然后重启 Nginx 即可通过 <code>&lt;your_host&gt;</code> 访问博客。</p><section class="footnotes" role="doc-endnotes"><hr><ol><li id="fn1" role="doc-endnote"><p><a href="https://calton007.github.io/2018/05/08/n-deploy-vps/" target="_blank" rel="noopener">https://calton007.github.io/2018/05/08/n-deploy-vps/</a> "使用 Git Hook 自动部署 Hexo 到个人 VPS"<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li><li id="fn2" role="doc-endnote"><p><a href="https://help.github.com/en/github/authenticating-to-github/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent" target="_blank" rel="noopener">https://help.github.com/en/github/authenticating-to-github/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent</a> "Generating a new SSH key and adding it to the ssh-agent"<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li><li id="fn3" role="doc-endnote"><p><a href="https://suikastar.com/posts/24967/" target="_blank" rel="noopener">https://suikastar.com/posts/24967/</a> "使用 GitHub Actions 自动化部署 Hexo"<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li><li id="fn4" role="doc-endnote"><p><a href="https://hexo.io/zh-cn/docs/one-command-deployment.html" target="_blank" rel="noopener">https://hexo.io/zh-cn/docs/one-command-deployment.html</a> "部署"<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li></ol></section>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;上一篇博客&lt;a href=&quot;/2019/Blog-Transfer-Record-1-From-WordPress-to-Hexo/&quot; title=&quot;博客迁移日志其一 从 WordPress 到 Hexo&quot;&gt;博客迁移日志其一 从 WordPress 到 Hexo&lt;/a&gt;中已经完成将 WordPress 中的数据迁移到 Hexo，但是每次修改内容后都要手动生成静态网页然后同步到服务器，这些步骤还是很繁琐的。因此需要一个自动化的流程来帮助部署博客，&lt;a href=&quot;https://github.com/features/actions&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;GitHub Actions&lt;/a&gt; 可以很好的满足这个需求。&lt;/p&gt;
    
    </summary>
    
    
      <category term="建设日志" scheme="https://blog.dreace.top/categories/%E5%BB%BA%E8%AE%BE%E6%97%A5%E5%BF%97/"/>
    
    
      <category term="Hexo" scheme="https://blog.dreace.top/tags/Hexo/"/>
    
      <category term="Github Actions" scheme="https://blog.dreace.top/tags/Github-Actions/"/>
    
  </entry>
  
  <entry>
    <title>Windows 下将“使用 VS Code 打开”注册到右键菜单</title>
    <link href="https://blog.dreace.top/2019/Set-VS-Code-As-The-Default-Editor/"/>
    <id>https://blog.dreace.top/2019/Set-VS-Code-As-The-Default-Editor/</id>
    <published>2019-11-18T08:49:18.000Z</published>
    <updated>2020-08-14T09:53:33.249Z</updated>
    
    <content type="html"><![CDATA[<p>在 Windows 下安装 <a href="https://code.visualstudio.com/" target="_blank" rel="noopener">VS Code</a> 时会询问是否注册为受支持类型编辑器，这样右击文件就可以使用 VS Code 编辑文件。如果安装时没有选择可以通过修改注册表达到这种效果。</p><a id="more"></a><h2 id="正文">正文</h2><p>首先新建一个 <code>code.txt</code> 文件然后修改后缀为 <code>.reg</code>，键入如下内容。</p><pre><code>Windows Registry Editor Version 5.00[HKEY_CLASSES_ROOT\*\shell\VSCode]@=&quot;使用 VS Code 打开&quot;&quot;Icon&quot;=&quot;C:\\Users\\Dreace\\AppData\\Local\\Programs\\Microsoft VS Code\\Code.exe&quot;[HKEY_CLASSES_ROOT\*\shell\VSCode\command]@=&quot;\&quot;C:\\Users\\Dreace\\AppData\\Local\\Programs\\Microsoft VS Code\\Code.exe\&quot; \&quot;%1\&quot;&quot;Windows Registry Editor Version 5.00[HKEY_CLASSES_ROOT\Directory\shell\VSCode]@=&quot;使用 VS Code 打开&quot;&quot;Icon&quot;=&quot;C:\\Users\\Dreace\\AppData\\Local\\Programs\\Microsoft VS Code\\Code.exe&quot;[HKEY_CLASSES_ROOT\Directory\shell\VSCode\command]@=&quot;\&quot;C:\\Users\\Dreace\\AppData\\Local\\Programs\\Microsoft VS Code\\Code.exe\&quot; \&quot;%V\&quot;&quot;Windows Registry Editor Version 5.00[HKEY_CLASSES_ROOT\Directory\Background\shell\VSCode]@=&quot;使用 VS Code 打开&quot;&quot;Icon&quot;=&quot;C:\\Users\\Dreace\\AppData\\Local\\Programs\\Microsoft VS Code\\Code.exe&quot;[HKEY_CLASSES_ROOT\Directory\Background\shell\VSCode\command]@=&quot;\&quot;C:\\Users\\Dreace\\AppData\\Local\\Programs\\Microsoft VS Code\\Code.exe\&quot; \&quot;%V\&quot;&quot;</code></pre><p>注意将里面的路径设置为自己的 VS Code 安装路径，<strong>路径分割要使用 <code>\\</code> 或者 <code>/</code></strong>。</p><p>保存之后双击执行可以为<strong>所有的</strong>文件、目录、目录背景右击菜单添加 <code>使用 VS Code 打开</code> 选项。</p><figure><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/Set-VS-Code-As-The-Default-Editor/image-20191118171606890.png" alt><figcaption>添加之后右击文件</figcaption></figure><p>文件分为三段，内容基本相同，这里拿第一段作为例子介绍一下。</p><p><code>[HKEY_CLASSES_ROOT\*\shell\VSCode]</code> 表示的是文件右击菜单中的名称及图标，可以自行修改。</p><p><code>[HKEY_CLASSES_ROOT\*\shell\VSCode\command]</code> 表示的是要打开的程序及参数。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在 Windows 下安装 &lt;a href=&quot;https://code.visualstudio.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;VS Code&lt;/a&gt; 时会询问是否注册为受支持类型编辑器，这样右击文件就可以使用 VS Code 编辑文件。如果安装时没有选择可以通过修改注册表达到这种效果。&lt;/p&gt;
    
    </summary>
    
    
    
      <category term="Windows" scheme="https://blog.dreace.top/tags/Windows/"/>
    
      <category term="VS Code" scheme="https://blog.dreace.top/tags/VS-Code/"/>
    
  </entry>
  
  <entry>
    <title>博客迁移日志其一 从 WordPress 到 Hexo</title>
    <link href="https://blog.dreace.top/2019/Blog-Transfer-Record-1-From-WordPress-to-Hexo/"/>
    <id>https://blog.dreace.top/2019/Blog-Transfer-Record-1-From-WordPress-to-Hexo/</id>
    <published>2019-11-10T03:03:36.000Z</published>
    <updated>2020-08-14T09:53:33.249Z</updated>
    
    <content type="html"><![CDATA[<p>用 WordPress 写博客已经很长时间，虽然写的东西不多，从最开始的托管空间开始到迁移至阿里的 ECS 上，这个博客已经存在了四五年了。也从最开始感叹 WordPress 功能强大到现在抱怨种种问题，例如 Markdown 支持不完善、由于主机上传带宽很小后台管理打开很慢等等。越用越感觉 WordPress 似乎不适合我，操作过于繁琐。一句话就是「<strong>不够 Geek</strong>」。</p><a id="more"></a><h2 id="开始-hexo">开始 Hexo</h2><p>其实最开始搭建博客时也考虑过 Hexo，当初认为 Hexo 过于简陋而使用了 WordPress。现在来看 Hexo 才是最适合我的。</p><ul><li>Markdown 编写文章配合上 Typora 不要太爽</li><li>静态页面没有后台管理</li><li>每个细节可高度定制化</li><li>快速部署到任何地方</li></ul><p>安装、使用 Hexo 很简单就不介绍了，可以看一下 <a href="/2019/hello-world/" title="Hello World">Hello World</a>。主题选择的是 <a href="https://github.com/nexmoe/hexo-theme-nexmoe" target="_blank" rel="noopener">Nexmoe</a>，有部分修改。</p><p>文章在本地编写后 Push 到 <a href="https://github.com/Dreace233/Hexo" target="_blank" rel="noopener">Dreace233/Hexo</a> 仓库，这个仓库配置了 Github Actions 每次 Push 之后会自动生成静态 HTML 文件并推送到 ECS 上。实际上这个博客是自动生成并部署到 ECS 的，详细内容会在之后的文章中说明。整个过程看起来有点复杂，但是呢，整体设置完成后会很方便，可以在任何地方用任何设备写文章，然后上传到 GitHub 即可😃。</p><h2 id="从-wordpress-导出">从 WordPress 导出</h2><p>登录 WordPress 后台，点击 <code>工具-&gt;导出</code> 然后下载 XML 文件即可。</p><p>安装插件<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>。</p><pre class="shell"><code>npm install hexo-migrator-wordpress --save</code></pre><p>导入 XML 文件。</p><pre class="shell"><code>hexo migrate wordpress &lt;source&gt;</code></pre><p>其中 <code>&lt;source&gt;</code> 是文件路径。</p><figure><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/Blog-Transfer-Record-1-From-WordPress-to-Hexo/image-20191110180243358.png" alt><figcaption>导入完成</figcaption></figure><p>导入成功，虽然内容转移过来了但是排版惨不忍睹。比如文章中部分代码代码格式丢失、不忍直视的文件名。</p><figure><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/Blog-Transfer-Record-1-From-WordPress-to-Hexo/image-20191110182226873.png" alt><figcaption>丢失样式的 Python 代码</figcaption></figure><figure><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/Blog-Transfer-Record-1-From-WordPress-to-Hexo/image-20191110182507063.png" alt><figcaption>不忍直视的文件名</figcaption></figure><p>只能先把这些文章移到 <code>_drafts</code> 文件夹中以后来慢慢整理。</p><h2 id="最后">最后</h2><p>新的博客算是基本搭建好了，其中也没什么坑点，感觉很好。下一篇文章会详细说一下自动化构建流程。</p><section class="footnotes" role="doc-endnotes"><hr><ol><li id="fn1" role="doc-endnote"><p><a href="https://hexo.io/zh-cn/docs/migration" target="_blank" rel="noopener">https://hexo.io/zh-cn/docs/migration</a> "迁移 | Hexo"<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li></ol></section>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;用 WordPress 写博客已经很长时间，虽然写的东西不多，从最开始的托管空间开始到迁移至阿里的 ECS 上，这个博客已经存在了四五年了。也从最开始感叹 WordPress 功能强大到现在抱怨种种问题，例如 Markdown 支持不完善、由于主机上传带宽很小后台管理打开很慢等等。越用越感觉 WordPress 似乎不适合我，操作过于繁琐。一句话就是「&lt;strong&gt;不够 Geek&lt;/strong&gt;」。&lt;/p&gt;
    
    </summary>
    
    
      <category term="建设日志" scheme="https://blog.dreace.top/categories/%E5%BB%BA%E8%AE%BE%E6%97%A5%E5%BF%97/"/>
    
    
      <category term="记录" scheme="https://blog.dreace.top/tags/%E8%AE%B0%E5%BD%95/"/>
    
      <category term="博客" scheme="https://blog.dreace.top/tags/%E5%8D%9A%E5%AE%A2/"/>
    
      <category term="迁移" scheme="https://blog.dreace.top/tags/%E8%BF%81%E7%A7%BB/"/>
    
      <category term="Hexo" scheme="https://blog.dreace.top/tags/Hexo/"/>
    
  </entry>
  
  <entry>
    <title>安装 Python</title>
    <link href="https://blog.dreace.top/2019/How-to-Install-Python/"/>
    <id>https://blog.dreace.top/2019/How-to-Install-Python/</id>
    <published>2019-11-03T04:05:21.000Z</published>
    <updated>2020-08-14T09:53:33.249Z</updated>
    
    <content type="html"><![CDATA[<p>Python 2.x 将在「 <strong>2020年1月1日</strong>」停止支持，因此本文介绍的都是 Python 3.x 的安装。如果你还在用 Python 2.x，转向 Python 3.x 是一个明智的决定。</p><a id="more"></a><h2 id="windows-下安装">Windows 下安装</h2><h3 id="下载">下载</h3><p>Python 3.8.0 64位 安装包: <a href="https://www.python.org/ftp/python/3.7.5/python-3.7.5-amd64.exe" target="_blank" rel="noopener">官网下载</a> <a href="https://pan.baidu.com/s/1QEPxt8Lf3LTEE_fnIc8oAA" target="_blank" rel="noopener">百度云下载</a></p><p>Python 3.8.0 32位 安装包: <a href="https://www.python.org/ftp/python/3.8.0/python-3.8.0.exe" target="_blank" rel="noopener">官网下载</a> <a href="https://pan.baidu.com/s/1VCIjSfY1jDJKIBL4VQsJkQ" target="_blank" rel="noopener">百度云下载</a></p><p><strong>注意：Python 3.8 不支持 Windows XP 及更早期系统</strong></p><h3 id="安装">安装</h3><p>双击下载的安装包即可开始安装。</p><figure><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/How-to-Install-Python/image-20191103132315293.png" alt><figcaption>准备安装 Python</figcaption></figure><p>如果你不熟悉如何设置环境变量可以勾选自动添加 Python 环境变量，若你需要安装多个 Python 版本请谨慎添加环境变量，否则会造成版本管理困难。</p><p>点击「<strong>Insatall Now</strong>」开始安装。</p><h3 id="安装完成">安装完成</h3><figure><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/How-to-Install-Python/image-20191104123856064.png" alt><figcaption>安装完成</figcaption></figure><p>点击「<strong>Close</strong>」关闭安装窗口。</p><h3 id="验证安装">验证安装</h3><p>Python 3.8.0 默认安装在 <code>C:\Users\&lt;用户名&gt;\AppData\Local\Programs\Python\Python38</code> 目录，其中 <code>&lt;用户名&gt;</code> 是当前登录的用户名。该目录下有 <code>python.exe</code> 可执行文件，双击可打开 Python 的交互式命令行。如果已经配置环境变量可以在 <code>cmd</code> 中直接使用 <code>python</code> 命令完成上面的操作，或者使用 <code>python --version</code> 命令查看 Python 版本。</p><figure><img class="lazyload" src="data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-src="https://cdn.jsdelivr.net/gh/dreace/dreace.github.io@master/images/How-to-Install-Python/image-20191104124631417.png" alt><figcaption>Python 交互式命令行</figcaption></figure><h2 id="linux-下安装">Linux 下安装</h2><p>在很多 Linux 发行版中 Python 已经内置，可以通过 <code>python</code> 命令来判断是否已安装 Python 及版本。若没有安装需要下载源代码自行编译，这需要一定的 Linux 管理经验，这里不展开介绍。Ubuntu 中可以使用 <code>sudo apt-get install python3.7</code> 直接安装 Python 3.7，如果你使用的发行版包管理提供安装也可以通过类似方法安装，否则需要自行编译源代码。</p><h2 id="macos-下安装-1">macOS 下安装 <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></h2><h3 id="下载安装程序安装">下载安装程序安装</h3><p>Python 3.8.0 macOS 安装包: <a href="https://www.python.org/ftp/python/3.8.0/python-3.8.0-macosx10.9.pkg" target="_blank" rel="noopener">官网下载</a> <a href="https://pan.baidu.com/s/1KofWqeNkaYYHZFjfwdDPZQ" target="_blank" rel="noopener">百度云下载</a></p><p>下载后双击运行并安装 。</p><h3 id="使用命令行安装">使用命令行安装</h3><p>如果安装了 <a href="https://brew.sh/" target="_blank" rel="noopener">Homebrew</a>，直接通过命令 <code>brew install python3</code> 安装即可 。</p><section class="footnotes" role="doc-endnotes"><hr><ol><li id="fn1" role="doc-endnote"><p><a href="https://www.liaoxuefeng.com/wiki/1016959663602400/1016959856222624" target="_blank" rel="noopener">https://www.liaoxuefeng.com/wiki/1016959663602400/1016959856222624</a> "安装Python - 廖雪峰的官方网站"<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li></ol></section>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Python 2.x 将在「 &lt;strong&gt;2020年1月1日&lt;/strong&gt;」停止支持，因此本文介绍的都是 Python 3.x 的安装。如果你还在用 Python 2.x，转向 Python 3.x 是一个明智的决定。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Python" scheme="https://blog.dreace.top/categories/Python/"/>
    
    
      <category term="教程" scheme="https://blog.dreace.top/tags/%E6%95%99%E7%A8%8B/"/>
    
      <category term="Windows" scheme="https://blog.dreace.top/tags/Windows/"/>
    
      <category term="Python" scheme="https://blog.dreace.top/tags/Python/"/>
    
      <category term="Linux" scheme="https://blog.dreace.top/tags/Linux/"/>
    
      <category term="macOS" scheme="https://blog.dreace.top/tags/macOS/"/>
    
  </entry>
  
  <entry>
    <title>Python 从 Zero 到 Hero</title>
    <link href="https://blog.dreace.top/2019/Python-From-Zero-To-Hero/"/>
    <id>https://blog.dreace.top/2019/Python-From-Zero-To-Hero/</id>
    <published>2019-11-01T09:12:15.000Z</published>
    <updated>2020-08-14T09:53:33.249Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.css" integrity="sha384-dbVIfZGuN1Yq7/1Ocstc1lUEm+AT+/rCkibIcC/OmWo5f0EA48Vf8CytHzGrSwbQ" crossorigin="anonymous"><p>本文旨在快速介绍 Python 的特性帮助读者能够在短时间内了解如何使用 Python， 因此不会有很复杂的内容或者原理性剖析。本文会涉及 Python 基本的语法、操作和简单的面向对象内容，可能会与 C++，Java 中相应内容对比。不过也不用担心，只需要有一些 C 语言编程基础就可以开始阅读本文。<strong>后文给出的所有代码需要在 Python 3 下才能运行。</strong></p><a id="more"></a><p>本文只能介绍 Python 基础及一些常用操作，其他进阶内容需要读者自己取探索或查询相关资料。</p><p>当然，在开始阅读之前得先安装 Python 环境，可以看这里 <a href="/2019/How-to-Install-Python/" title="安装 Python">安装 Python</a></p><h2 id="x00-输入与输出">0x00 输入与输出</h2><p>Python 中输入与输出非常简单，第一个例子是经典的 <code>Hello, world</code>。</p><div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="bu">print</span>(<span class="st">&quot;Hello, world&quot;</span>)</span></code></pre></div><p>在 IDE 或 Shell 中运行这段代码你将看到：</p><div class="sourceCode" id="cb2"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb2-1"><a href="#cb2-1"></a>Hello, world</span></code></pre></div><p>接下来是输入，将你的输入原样输出。Python 3 默认使用 UTF-8 编码，因此可以在代码中直接使用中文。</p><div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="bu">print</span>(<span class="bu">input</span>(<span class="st">&quot;输入:&quot;</span>))</span></code></pre></div><pre><code>输入：你好你好  </code></pre><h2 id="x01-变量与数据类型">0x01 变量与数据类型</h2><p>Python 中使用变量时不需要手动指定类型，由系统（解释器）自动推导类型。</p><div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a>a <span class="op">=</span> <span class="dv">1</span></span><span id="cb5-2"><a href="#cb5-2"></a>b <span class="op">=</span> <span class="fl">2.0</span></span><span id="cb5-3"><a href="#cb5-3"></a>c <span class="op">=</span> <span class="va">True</span></span><span id="cb5-4"><a href="#cb5-4"></a>d <span class="op">=</span> <span class="st">&quot;345&quot;</span></span></code></pre></div><p>上边的代码分别定义了一个整型（int）,浮点型（float），布尔型（bool）,字符串（str）变量并使用 <code>print()</code> 将其输出。</p><div class="sourceCode" id="cb6"><pre class="sourceCode txt"><code class="sourceCode default"><span id="cb6-1"><a href="#cb6-1"></a>1</span><span id="cb6-2"><a href="#cb6-2"></a>2.0</span><span id="cb6-3"><a href="#cb6-3"></a>True</span><span id="cb6-4"><a href="#cb6-4"></a>345</span></code></pre></div><p>Python 提供了与其他编程语言相似的运算符操作：</p><div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a><span class="bu">print</span>(<span class="dv">1</span> <span class="op">+</span> <span class="dv">2</span>)</span><span id="cb7-2"><a href="#cb7-2"></a><span class="bu">print</span>(<span class="dv">2</span> <span class="op">-</span> <span class="dv">3</span>)</span><span id="cb7-3"><a href="#cb7-3"></a><span class="bu">print</span>(<span class="dv">2</span> <span class="op">*</span> <span class="dv">5</span>)</span><span id="cb7-4"><a href="#cb7-4"></a><span class="bu">print</span>(<span class="dv">2</span> <span class="op">/</span> <span class="dv">3</span>)  <span class="co"># 结果为浮点数</span></span><span id="cb7-5"><a href="#cb7-5"></a><span class="bu">print</span>(<span class="dv">10</span> <span class="op">//</span> <span class="dv">3</span>)  <span class="co"># 结果为整数，小数点后截断</span></span><span id="cb7-6"><a href="#cb7-6"></a><span class="bu">print</span>(<span class="dv">10</span> <span class="op">%</span> <span class="dv">3</span>)</span><span id="cb7-7"><a href="#cb7-7"></a></span><span id="cb7-8"><a href="#cb7-8"></a>a <span class="op">=</span> <span class="dv">2</span> <span class="op">/</span> <span class="dv">7</span></span><span id="cb7-9"><a href="#cb7-9"></a><span class="bu">print</span>(a)</span><span id="cb7-10"><a href="#cb7-10"></a></span><span id="cb7-11"><a href="#cb7-11"></a><span class="bu">print</span>()</span><span id="cb7-12"><a href="#cb7-12"></a></span><span id="cb7-13"><a href="#cb7-13"></a>b <span class="op">=</span> <span class="bu">float</span>(<span class="bu">input</span>())</span><span id="cb7-14"><a href="#cb7-14"></a><span class="bu">print</span>(b <span class="op">/</span> <span class="dv">2</span>)</span></code></pre></div><p>Python 3 中 <code>input</code> 得到的输入是字符串，因此需要先转化为数字（这里是转换成浮点数）再计算。</p><div class="sourceCode" id="cb8"><pre class="sourceCode txt"><code class="sourceCode default"><span id="cb8-1"><a href="#cb8-1"></a>3</span><span id="cb8-2"><a href="#cb8-2"></a>-1</span><span id="cb8-3"><a href="#cb8-3"></a>10</span><span id="cb8-4"><a href="#cb8-4"></a>0.6666666666666666</span><span id="cb8-5"><a href="#cb8-5"></a>3</span><span id="cb8-6"><a href="#cb8-6"></a>1</span><span id="cb8-7"><a href="#cb8-7"></a>0.2857142857142857</span><span id="cb8-8"><a href="#cb8-8"></a></span><span id="cb8-9"><a href="#cb8-9"></a>5</span><span id="cb8-10"><a href="#cb8-10"></a>2.5</span></code></pre></div><h2 id="x02-注释">0x02 注释</h2><p>注释是编码中非常重要的部分，Python 使用 <code>#</code> 开始单行注释，使用 <code>'''</code> 或 <code>"""</code> 包裹多行注释。</p><div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># 这是单行注释</span></span><span id="cb9-2"><a href="#cb9-2"></a></span><span id="cb9-3"><a href="#cb9-3"></a><span class="bu">print</span>(<span class="st">&quot;Hello, world&quot;</span>)</span><span id="cb9-4"><a href="#cb9-4"></a></span><span id="cb9-5"><a href="#cb9-5"></a><span class="co">&#39;&#39;&#39;</span></span><span id="cb9-6"><a href="#cb9-6"></a><span class="co">这是多行</span></span><span id="cb9-7"><a href="#cb9-7"></a><span class="co">注释</span></span><span id="cb9-8"><a href="#cb9-8"></a><span class="co">！</span></span><span id="cb9-9"><a href="#cb9-9"></a><span class="co">&#39;&#39;&#39;</span></span></code></pre></div><h2 id="x03-常用数据结构">0x03 常用数据结构</h2><h3 id="列表list">列表（List）</h3><p>列表是 Python 中最常用的数据结构，与数组类似，列表的下标从 0 开始，且列表中元素的个数是可变的，下面的代码演示了列表的一些常用操作。</p><div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a>the_list <span class="op">=</span> [<span class="st">&quot;I&quot;</span>, <span class="st">&quot;love&quot;</span>, <span class="st">&quot;Python&quot;</span>, <span class="dv">233</span>, [<span class="st">&quot;list&quot;</span>]]</span><span id="cb10-2"><a href="#cb10-2"></a><span class="bu">print</span>(the_list[<span class="dv">2</span>])  <span class="co"># 取小标为 2 的元素</span></span><span id="cb10-3"><a href="#cb10-3"></a>the_list[<span class="dv">2</span>] <span class="op">=</span> <span class="st">&quot;Python!&quot;</span></span><span id="cb10-4"><a href="#cb10-4"></a><span class="bu">print</span>(the_list[<span class="dv">2</span>])</span><span id="cb10-5"><a href="#cb10-5"></a><span class="bu">print</span>(<span class="st">&quot;-----&quot;</span>)</span><span id="cb10-6"><a href="#cb10-6"></a></span><span id="cb10-7"><a href="#cb10-7"></a><span class="bu">print</span>(the_list[<span class="dv">1</span>:<span class="dv">3</span>])  <span class="co"># 截取下标 1 到下标为 3 的元素（不包含下标 3）</span></span><span id="cb10-8"><a href="#cb10-8"></a><span class="bu">print</span>(<span class="st">&quot;-----&quot;</span>)</span><span id="cb10-9"><a href="#cb10-9"></a></span><span id="cb10-10"><a href="#cb10-10"></a><span class="bu">print</span>(the_list[<span class="dv">2</span>:])  <span class="co"># 截取下标 2 以后的所有元素</span></span><span id="cb10-11"><a href="#cb10-11"></a><span class="bu">print</span>(<span class="st">&quot;-----&quot;</span>)</span><span id="cb10-12"><a href="#cb10-12"></a></span><span id="cb10-13"><a href="#cb10-13"></a><span class="cf">for</span> i <span class="kw">in</span> the_list:</span><span id="cb10-14"><a href="#cb10-14"></a>    <span class="bu">print</span>(i)</span><span id="cb10-15"><a href="#cb10-15"></a><span class="bu">print</span>(<span class="st">&quot;-----&quot;</span>)</span><span id="cb10-16"><a href="#cb10-16"></a></span><span id="cb10-17"><a href="#cb10-17"></a><span class="kw">del</span> the_list[<span class="dv">3</span>] <span class="co"># 删除下标为 3 的元素</span></span><span id="cb10-18"><a href="#cb10-18"></a><span class="cf">for</span> i <span class="kw">in</span> the_list:</span><span id="cb10-19"><a href="#cb10-19"></a>    <span class="bu">print</span>(i)</span><span id="cb10-20"><a href="#cb10-20"></a><span class="bu">print</span>(<span class="st">&quot;-----&quot;</span>)</span><span id="cb10-21"><a href="#cb10-21"></a></span><span id="cb10-22"><a href="#cb10-22"></a><span class="bu">print</span>(<span class="bu">len</span>(the_list))</span></code></pre></div><p>列表中元素可以是任意类型，甚至列表中元素类型可以不相同，上例中的 <code>the_list</code> 包含了字符串、数字和另一个列表。Python 中使用方括号 <code>[]</code> 配合下标的形式访问访问和修改元素。第 7 行代码展示了对列表的切片操作， <code>[a:b]</code> 表示截取下标从 <code>a</code> 到 <code>b</code> 的所有元素，若省略一个参数则表示到列表开头或末尾的最大范围，例如 <code>[:5]</code> 表示截取下标从 0 到 4 的所有元素，这个操作称之为<strong>切片（Slice）</strong>。需要注意的是这个范围是 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo fence="true">[</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo fence="true">)</mo></mrow><annotation encoding="application/x-tex">\left[a,b\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">[</span><span class="mord mathdefault">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">b</span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span> 即不包含下标为 <code>b</code> 的元素 。<strong>切片可以使用负值下标，表示从最右侧开始计数，最右侧第一个下标为 -1。</strong></p><p>第 13、 14 行展示了 Python 的 <code>for</code> 循环，这和 C/C++ 中的 <code>for</code> 不太一样，Python 中可以使用 <code>for</code> 直接对列表进行迭代，依次取出其中的每个值，而不需要使用下标遍历访问。这样的操作同样适用于字符串。</p><p>再之后使用 <code>del</code> 删除了列表中下标为 3 的元素，并再次迭代输出。</p><p>你应该已经注意到了在 <code>for</code> 循环之内的 <code>print</code> 前面有四个空格，这是 Python 最有特色的地方<strong>「强制缩进」</strong>，Python 要求不同层次的语句块之间必须有缩进。仔细观察可以发现 <code>for</code> 语句所在行最后一个字符都是冒号（<code>:</code>），表示之后有缩进的语句包含在 <code>for</code> 语句内部，直到出现与之同级缩进的语句。</p><p><code>len</code> 可以获取列表的长度，这里已经删除了一个元素所以长度为 4。</p><div class="sourceCode" id="cb11"><pre class="sourceCode txt"><code class="sourceCode default"><span id="cb11-1"><a href="#cb11-1"></a>Python</span><span id="cb11-2"><a href="#cb11-2"></a>Python!</span><span id="cb11-3"><a href="#cb11-3"></a>-----</span><span id="cb11-4"><a href="#cb11-4"></a>[&#39;love&#39;, &#39;Python!&#39;]</span><span id="cb11-5"><a href="#cb11-5"></a>-----</span><span id="cb11-6"><a href="#cb11-6"></a>[&#39;Python!&#39;, 233, [&#39;list&#39;]]</span><span id="cb11-7"><a href="#cb11-7"></a>-----</span><span id="cb11-8"><a href="#cb11-8"></a>I</span><span id="cb11-9"><a href="#cb11-9"></a>love</span><span id="cb11-10"><a href="#cb11-10"></a>Python!</span><span id="cb11-11"><a href="#cb11-11"></a>233</span><span id="cb11-12"><a href="#cb11-12"></a>[&#39;list&#39;]</span><span id="cb11-13"><a href="#cb11-13"></a>-----</span><span id="cb11-14"><a href="#cb11-14"></a>I</span><span id="cb11-15"><a href="#cb11-15"></a>love</span><span id="cb11-16"><a href="#cb11-16"></a>Python!</span><span id="cb11-17"><a href="#cb11-17"></a>[&#39;list&#39;]</span><span id="cb11-18"><a href="#cb11-18"></a>-----</span><span id="cb11-19"><a href="#cb11-19"></a>4</span></code></pre></div><h3 id="元组tuple">元组（Tuple）</h3><p>元组与列表相似，可以使用下标访问、切片操作、迭代元素。但是，元组<strong>不可修改</strong>。如尝试修改元组将抛出 <code>TypeError: 'tuple' object does not support item assignment</code> 错误。</p><div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a>the_tuple <span class="op">=</span> (<span class="st">&quot;I&quot;</span>, <span class="st">&quot;love&quot;</span>, <span class="st">&quot;Python&quot;</span>, <span class="dv">233</span>, [<span class="st">&quot;list&quot;</span>])</span><span id="cb12-2"><a href="#cb12-2"></a><span class="bu">print</span>(the_tuple[<span class="dv">2</span>])  <span class="co"># 取小标为 2 的元素</span></span><span id="cb12-3"><a href="#cb12-3"></a><span class="bu">print</span>(<span class="st">&quot;-----&quot;</span>)</span><span id="cb12-4"><a href="#cb12-4"></a></span><span id="cb12-5"><a href="#cb12-5"></a><span class="bu">print</span>(the_tuple[<span class="dv">1</span>:<span class="dv">3</span>])  <span class="co"># 截取下标 1 到下标为 3 的元素（不包含下标 3）</span></span><span id="cb12-6"><a href="#cb12-6"></a><span class="bu">print</span>(<span class="st">&quot;-----&quot;</span>)</span><span id="cb12-7"><a href="#cb12-7"></a></span><span id="cb12-8"><a href="#cb12-8"></a><span class="bu">print</span>(the_tuple[<span class="dv">2</span>:])  <span class="co"># 截取下标 2 以后的所有元素</span></span><span id="cb12-9"><a href="#cb12-9"></a><span class="bu">print</span>(<span class="st">&quot;-----&quot;</span>)</span><span id="cb12-10"><a href="#cb12-10"></a></span><span id="cb12-11"><a href="#cb12-11"></a><span class="cf">for</span> i <span class="kw">in</span> the_tuple:</span><span id="cb12-12"><a href="#cb12-12"></a>    <span class="bu">print</span>(i)</span><span id="cb12-13"><a href="#cb12-13"></a><span class="bu">print</span>(<span class="st">&quot;-----&quot;</span>)</span><span id="cb12-14"><a href="#cb12-14"></a></span><span id="cb12-15"><a href="#cb12-15"></a><span class="bu">print</span>(<span class="bu">len</span>(the_tuple))</span></code></pre></div><p>因为元组不可修改的特性，它常被用来作函数的返回值，以防返回值被意外修改。</p><pre><code>Python-----(&#39;love&#39;, &#39;Python&#39;)-----(&#39;Python&#39;, 233, [&#39;list&#39;])-----IlovePython233[&#39;list&#39;]-----5</code></pre><h3 id="字典dict">字典（Dict）</h3><p>字典是一种键（key）值（value）对的映射，可以通过键确定唯一的值。</p><div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1"></a>the_dict <span class="op">=</span> {<span class="st">&quot;Alice&quot;</span>: <span class="dv">18</span>, <span class="st">&quot;Bob&quot;</span>: <span class="dv">19</span>, <span class="st">&quot;Tom&quot;</span>: <span class="dv">21</span>}</span><span id="cb14-2"><a href="#cb14-2"></a><span class="bu">print</span>(the_dict[<span class="st">&quot;Alice&quot;</span>])</span><span id="cb14-3"><a href="#cb14-3"></a>the_dict[<span class="st">&quot;Alice&quot;</span>] <span class="op">=</span> <span class="dv">20</span></span><span id="cb14-4"><a href="#cb14-4"></a><span class="bu">print</span>(the_dict[<span class="st">&quot;Alice&quot;</span>])</span><span id="cb14-5"><a href="#cb14-5"></a><span class="bu">print</span>(<span class="st">&quot;-----&quot;</span>)</span><span id="cb14-6"><a href="#cb14-6"></a></span><span id="cb14-7"><a href="#cb14-7"></a><span class="cf">for</span> k <span class="kw">in</span> the_dict:</span><span id="cb14-8"><a href="#cb14-8"></a>    <span class="bu">print</span>(k, the_dict[k])</span><span id="cb14-9"><a href="#cb14-9"></a><span class="bu">print</span>(<span class="st">&quot;-----&quot;</span>)</span><span id="cb14-10"><a href="#cb14-10"></a><span class="bu">print</span>(<span class="st">&quot;Peter&quot;</span> <span class="kw">in</span> the_dict.keys())</span><span id="cb14-11"><a href="#cb14-11"></a>the_dict[<span class="st">&quot;Peter&quot;</span>] <span class="op">=</span> <span class="dv">30</span></span><span id="cb14-12"><a href="#cb14-12"></a><span class="bu">print</span>(<span class="st">&quot;Peter&quot;</span> <span class="kw">in</span> the_dict.keys())</span><span id="cb14-13"><a href="#cb14-13"></a><span class="bu">print</span>(the_dict[<span class="st">&quot;Peter&quot;</span>])</span></code></pre></div><p>可以直接使用键名来访问字典或修改字典，通过 <code>for</code> 像列表和元组一样迭代字典，不过迭代的是字典中的键。如果访问了不存在的键将抛出 <code>KeyError</code> 错误，因此在访问之前可以先使用 <code>key in the_dict.keys()</code> 来判断键 <code>key</code> 是否在字典 <code>the_dict</code> 的键集合中，若存在则为真（<code>True</code>）否则为假（<code>False</code>）。如果在键名还不存在时对这个键赋值，键名将会被自动创建。</p><pre><code>1820-----Alice 20Bob 19Tom 21-----FalseTrue30</code></pre><h3 id="集合set">集合（Set）</h3><p>集合是一个元素无序且唯一的序列。</p><div class="sourceCode" id="cb16"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1"></a>the_set <span class="op">=</span> {<span class="st">&quot;apple&quot;</span>, <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;apple&quot;</span>, <span class="st">&quot;pear&quot;</span>, <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;banana&quot;</span>}</span><span id="cb16-2"><a href="#cb16-2"></a><span class="bu">print</span>(the_set)</span><span id="cb16-3"><a href="#cb16-3"></a><span class="cf">for</span> i <span class="kw">in</span> the_set:</span><span id="cb16-4"><a href="#cb16-4"></a>    <span class="bu">print</span>(i)</span><span id="cb16-5"><a href="#cb16-5"></a><span class="bu">print</span>(<span class="bu">len</span>(the_set))</span><span id="cb16-6"><a href="#cb16-6"></a><span class="bu">print</span>(<span class="st">&quot;-----&quot;</span>)</span><span id="cb16-7"><a href="#cb16-7"></a></span><span id="cb16-8"><a href="#cb16-8"></a>the_set.add(<span class="st">&quot;pear&quot;</span>)</span><span id="cb16-9"><a href="#cb16-9"></a><span class="bu">print</span>(<span class="bu">len</span>(the_set))</span><span id="cb16-10"><a href="#cb16-10"></a><span class="bu">print</span>(<span class="st">&quot;-----&quot;</span>)</span><span id="cb16-11"><a href="#cb16-11"></a></span><span id="cb16-12"><a href="#cb16-12"></a>the_set.add(<span class="st">&quot;grape&quot;</span>)</span><span id="cb16-13"><a href="#cb16-13"></a><span class="cf">for</span> i <span class="kw">in</span> the_set:</span><span id="cb16-14"><a href="#cb16-14"></a>    <span class="bu">print</span>(i)</span><span id="cb16-15"><a href="#cb16-15"></a><span class="bu">print</span>(<span class="st">&quot;-----&quot;</span>)</span><span id="cb16-16"><a href="#cb16-16"></a></span><span id="cb16-17"><a href="#cb16-17"></a>the_set.remove(<span class="st">&quot;apple&quot;</span>)</span><span id="cb16-18"><a href="#cb16-18"></a><span class="cf">for</span> i <span class="kw">in</span> the_set:</span><span id="cb16-19"><a href="#cb16-19"></a>    <span class="bu">print</span>(i)</span><span id="cb16-20"><a href="#cb16-20"></a><span class="bu">print</span>(<span class="st">&quot;-----&quot;</span>)</span><span id="cb16-21"><a href="#cb16-21"></a></span><span id="cb16-22"><a href="#cb16-22"></a><span class="bu">print</span>(<span class="st">&quot;apple&quot;</span> <span class="kw">in</span> the_set)</span></code></pre></div><p>可以使用 <code>{}</code> 或 <code>set()</code> 创建集合，但要创建空集合只能使用 <code>set()</code>，因为 <code>{}</code> 创建的是空字典。通过 <code>add()</code> 或 <code>remove()</code> 向集合中添加、删除元素，如果添加重复元素将被合并。前面已经提到过可以使用 <code>in</code> 判断一个值是否在集合中。</p><pre><code>{&#39;orange&#39;, &#39;banana&#39;, &#39;pear&#39;, &#39;apple&#39;}orangebananapearapple4-----4-----orangegrapebananapearapple-----orangegrapebananapear-----False</code></pre><h2 id="x04-函数">0x04 函数</h2><p>定义并调用一个参数的函数：</p><div class="sourceCode" id="cb18"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1"></a><span class="kw">def</span> fun(a):</span><span id="cb18-2"><a href="#cb18-2"></a>    <span class="cf">return</span> a <span class="op">*</span> <span class="dv">10</span></span><span id="cb18-3"><a href="#cb18-3"></a></span><span id="cb18-4"><a href="#cb18-4"></a></span><span id="cb18-5"><a href="#cb18-5"></a><span class="bu">print</span>(fun(<span class="dv">10</span>))</span></code></pre></div><p>这个函数接受一个参数并将参数值乘以 10 返回。</p><div class="sourceCode" id="cb19"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb19-1"><a href="#cb19-1"></a>100</span></code></pre></div><p>定义有多个参数并参数有默认值的函数：</p><div class="sourceCode" id="cb20"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1"></a><span class="kw">def</span> fun(a, b<span class="op">=</span><span class="dv">2</span>):</span><span id="cb20-2"><a href="#cb20-2"></a>    <span class="cf">return</span> a <span class="op">**</span> b</span><span id="cb20-3"><a href="#cb20-3"></a></span><span id="cb20-4"><a href="#cb20-4"></a></span><span id="cb20-5"><a href="#cb20-5"></a><span class="bu">print</span>(fun(<span class="dv">5</span>))</span><span id="cb20-6"><a href="#cb20-6"></a><span class="bu">print</span>(fun(<span class="dv">5</span>, <span class="dv">3</span>))</span></code></pre></div><p>这个函数中第二个参数 <code>b</code> 是可选的，若不提供则默认为 <code>2</code>，函数内用到的 <code>**</code> 是 Python 中幂运算即 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>a</mi><mi>b</mi></msup></mrow><annotation encoding="application/x-tex">{a^{b}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.849108em;vertical-align:0em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span></span></span></span></span></span></span></span></span></span></span></span></span>。若调用时只提供一个参数则计算 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle scriptlevel="0" displaystyle="true"><msup><mi>a</mi><mn>2</mn></msup></mstyle></mrow><annotation encoding="application/x-tex">{\displaystyle a^{2}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8641079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></span>。</p><pre><code>25125</code></pre><h2 id="x05-流程控制">0x05 流程控制</h2><h3 id="if-语句">if 语句</h3><div class="sourceCode" id="cb22"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1"></a>foo <span class="op">=</span> <span class="dv">5</span></span><span id="cb22-2"><a href="#cb22-2"></a>bar <span class="op">=</span> <span class="dv">6</span></span><span id="cb22-3"><a href="#cb22-3"></a><span class="cf">if</span> foo <span class="op">==</span> bar:</span><span id="cb22-4"><a href="#cb22-4"></a>    <span class="bu">print</span>(<span class="st">&quot;foo equals bar&quot;</span>)</span><span id="cb22-5"><a href="#cb22-5"></a><span class="cf">elif</span> foo <span class="op">&gt;</span> bar:</span><span id="cb22-6"><a href="#cb22-6"></a>    <span class="bu">print</span>(<span class="st">&quot;foo is greater than bar&quot;</span>)</span><span id="cb22-7"><a href="#cb22-7"></a><span class="cf">else</span>:</span><span id="cb22-8"><a href="#cb22-8"></a>    <span class="bu">print</span>(<span class="st">&quot;foo less than bar&quot;</span>)</span></code></pre></div><p>若 <code>if</code> 后面的条件为真则执行其中的语句块，否则进行 <code>elif</code> 判断，若为真则执行其中语句，如果还是为假将执行 <code>else</code> 中语句。</p><pre><code>foo less than bar</code></pre><h3 id="for-语句">for 语句</h3><p>前面已经简单介绍过 Python 中的 <code>for</code> 语句，和其他语言一样是一种循环语句。例如可是使用 <code>for in foo</code> 来遍历 <code>foo</code> 中的元素， <code>foo</code> 可以是列表、元组、字典、集合，甚至字符串。</p><div class="sourceCode" id="cb24"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1"></a>foo <span class="op">=</span> <span class="st">&quot;I love Python&quot;</span></span><span id="cb24-2"><a href="#cb24-2"></a><span class="cf">for</span> i <span class="kw">in</span> foo:</span><span id="cb24-3"><a href="#cb24-3"></a>    <span class="bu">print</span>(i)</span></code></pre></div><pre><code>I love Python</code></pre><p>若需要指定循环次数或者要通过下标遍历一个序列则要使用 <code>range()</code>。</p><div class="sourceCode" id="cb26"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>, <span class="dv">9</span>):</span><span id="cb26-2"><a href="#cb26-2"></a>    <span class="bu">print</span>(i)</span><span id="cb26-3"><a href="#cb26-3"></a><span class="bu">print</span>(<span class="st">&quot;-----&quot;</span>)</span><span id="cb26-4"><a href="#cb26-4"></a></span><span id="cb26-5"><a href="#cb26-5"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span><span id="cb26-6"><a href="#cb26-6"></a>    <span class="bu">print</span>(i)</span><span id="cb26-7"><a href="#cb26-7"></a><span class="bu">print</span>(<span class="st">&quot;-----&quot;</span>)</span><span id="cb26-8"><a href="#cb26-8"></a></span><span id="cb26-9"><a href="#cb26-9"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">3</span>):</span><span id="cb26-10"><a href="#cb26-10"></a>    <span class="bu">print</span>(i)</span></code></pre></div><p>当有有两个参数 <code>a</code>，<code>b</code> 则从 <code>a</code> 迭代到 <code>b</code>（不包含 <code>b</code>），这跟切片的限制是一样的。</p><p>只有一个参数时从 0 开始迭代。</p><p>若提供三个参数，第三个参数 <code>c</code> 表示步长即相邻两个元素的差值。</p><pre><code>5678-----01234-----0369</code></pre><h3 id="while-语句">while 语句</h3><p>当需要循环在某个条件为真时一直运行，直到这个条件不再满足则退出，便需要 <code>while</code> 循环了。</p><div class="sourceCode" id="cb28"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1"></a>res <span class="op">=</span> <span class="dv">1</span></span><span id="cb28-2"><a href="#cb28-2"></a>limit <span class="op">=</span> <span class="dv">1</span></span><span id="cb28-3"><a href="#cb28-3"></a><span class="cf">while</span> limit <span class="op">&lt;=</span> <span class="dv">50</span>:</span><span id="cb28-4"><a href="#cb28-4"></a>    res <span class="op">*=</span> limit</span><span id="cb28-5"><a href="#cb28-5"></a>    limit <span class="op">+=</span> <span class="dv">1</span></span><span id="cb28-6"><a href="#cb28-6"></a><span class="bu">print</span>(res)</span></code></pre></div><p><code>limit</code> 初始值为 1，每轮循环会增加 1，<code>while</code> 内部的语句会一直循环执行，直到 <code>limit &lt;= 50</code> 的条件不再满足即 <code>limit</code> 大于 50 时终止。<code>res *= limit</code> 是 <code>res = res * limit</code> 的简写形式，下一行的 <code>+=</code> 同理。你可能已经注意到了这段程序计算的是 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>50</mn><mo stretchy="false">!</mo></mrow><annotation encoding="application/x-tex">50!</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord">5</span><span class="mord">0</span><span class="mclose">!</span></span></span></span> 的值，其结果远远大于 64 位有符号整数所能表示的最大值 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mn>23</mn></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">{2^{23}-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">3</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span></span></span>，但是在 Python 中可以直接计算，因为 Python 原生支持大数运算。</p><pre><code>30414093201713378043612608166064768844377641568960512000000000000</code></pre><h3 id="循环内部的控制">循环内部的控制</h3><p>在 <code>for</code> 循环和 <code>while</code> 循环内部可以使用 <code>break</code> 来跳出循环，使用 <code>continue</code> 跳过本次循环但不终止循环。</p><div class="sourceCode" id="cb30"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1"></a>foo <span class="op">=</span> <span class="dv">0</span></span><span id="cb30-2"><a href="#cb30-2"></a><span class="cf">while</span> foo <span class="op">&lt;</span> <span class="dv">10</span>:</span><span id="cb30-3"><a href="#cb30-3"></a>    <span class="cf">if</span> foo <span class="op">&gt;=</span> <span class="dv">5</span>:</span><span id="cb30-4"><a href="#cb30-4"></a>        <span class="cf">break</span></span><span id="cb30-5"><a href="#cb30-5"></a>    <span class="bu">print</span>(foo)</span><span id="cb30-6"><a href="#cb30-6"></a>    foo <span class="op">+=</span> <span class="dv">1</span></span><span id="cb30-7"><a href="#cb30-7"></a><span class="bu">print</span>(<span class="st">&quot;-----&quot;</span>)</span><span id="cb30-8"><a href="#cb30-8"></a></span><span id="cb30-9"><a href="#cb30-9"></a>bar <span class="op">=</span> <span class="dv">0</span></span><span id="cb30-10"><a href="#cb30-10"></a><span class="cf">while</span> bar <span class="op">&lt;</span> <span class="dv">5</span>:</span><span id="cb30-11"><a href="#cb30-11"></a>    bar <span class="op">+=</span> <span class="dv">1</span></span><span id="cb30-12"><a href="#cb30-12"></a>    <span class="cf">if</span> bar <span class="op">==</span> <span class="dv">2</span>:</span><span id="cb30-13"><a href="#cb30-13"></a>        <span class="cf">continue</span></span><span id="cb30-14"><a href="#cb30-14"></a>    <span class="bu">print</span>(bar)</span></code></pre></div><p>第一个循环中当 <code>foo &gt;= 5</code> 时跳出循环，后面的值不会被打印。第二个循环当 <code>bar == 2</code> 时跳过本次循环，只有 2 不会被打印。</p><pre><code>01234-----1345</code></pre><h2 id="x06-文件操作">0x06 文件操作</h2><p>文件操作在日常中出现频率非常高， Python 提供了非常方便的文件操作。</p><h3 id="写文件">写文件</h3><p>首先打开一个文件并像其中写入一些数据。</p><div class="sourceCode" id="cb32"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1"></a>foo <span class="op">=</span> <span class="bu">open</span>(<span class="st">&quot;foo.txt&quot;</span>, <span class="st">&quot;w&quot;</span>)</span><span id="cb32-2"><a href="#cb32-2"></a>foo.write(<span class="st">&quot;This is foo.txt&quot;</span>)</span><span id="cb32-3"><a href="#cb32-3"></a>foo.close()</span></code></pre></div><p>运行这段代码后可以看到在脚本相同路径下出现了 <code>foo.txt</code> 文件，其中的内容是 <code>This is foo.txt</code>。</p><p>Python 中使用 <code>open()</code> 函数打开文件，第一个参数是文件路径，默认是相对路径，也就是说打开的是与脚本相同目录下的那个文件。第二个参数是打开文件的模式，这里的 <code>w</code> 表示要写文件，如果是 <code>r</code> 表示要读文件。还有其他的文件模式请读者自行了解，本文不再做介绍。</p><p>使用 <code>write()</code> 函数像文件中写入数据，使用完文件后一定要调用 <code>close()</code> 函数关闭文件。</p><h3 id="读文件">读文件</h3><div class="sourceCode" id="cb33"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">&quot;foo.txt&quot;</span>,<span class="st">&quot;r&quot;</span>) <span class="im">as</span> <span class="bu">file</span>:</span><span id="cb33-2"><a href="#cb33-2"></a>    foo <span class="op">=</span> <span class="bu">file</span>.read()</span><span id="cb33-3"><a href="#cb33-3"></a>    <span class="bu">print</span>(foo)</span></code></pre></div><p>与写文件类似，但这里使用了 <code>with</code> 语句来保证无论什么情况下文件都会被关闭。通常文件操作都是使用 <code>with</code> 语句来进行的，这样不会忘记关闭文件，并且发生异常时文件也会被自动关闭。</p><pre><code>This is foo.txt</code></pre><p>执行上面的代码后文件内容会被打印出来。</p><h2 id="x07-模块">0x07 模块</h2><p>Python 中可以可以使用 <code>import</code> 导入系统模块或其他外部模块。</p><div class="sourceCode" id="cb35"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1"></a><span class="im">import</span> sys</span><span id="cb35-2"><a href="#cb35-2"></a><span class="cf">for</span> i <span class="kw">in</span> sys.argv:</span><span id="cb35-3"><a href="#cb35-3"></a>    <span class="bu">print</span>(i)</span></code></pre></div><p>导入系统的 <code>sys</code> 模块并输出执行脚本时的参数，假设将上面的代码保存为 <code>foo.py</code>，并通过命令行执行</p><div class="sourceCode" id="cb36"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1"></a><span class="ex">python</span> foo.py bar1 bar2</span></code></pre></div><p>可以看到打印出了脚本名及后面的两个参数。</p><pre><code>foo.pybar1bar2</code></pre><p><code>import</code> 除了可以导入系统模块外，还能导入自定义模块。首先创建 <code>foo.py</code> 文件编写</p><div class="sourceCode" id="cb38"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1"></a><span class="kw">def</span> func(a, b):</span><span id="cb38-2"><a href="#cb38-2"></a>    <span class="cf">return</span> a <span class="op">**</span> b</span></code></pre></div><p>在相同目录下创建 <code>bar.py</code> 编写</p><div class="sourceCode" id="cb39"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1"></a><span class="im">import</span> foo</span><span id="cb39-2"><a href="#cb39-2"></a></span><span id="cb39-3"><a href="#cb39-3"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&#39;__main__&#39;</span>:</span><span id="cb39-4"><a href="#cb39-4"></a>    <span class="bu">print</span>(foo.func(<span class="dv">10</span>, <span class="dv">3</span>))</span></code></pre></div><p><code>bar.py</code> 导入了 <code>foo.py</code> 的所有内容并调用了函数 <code>func()</code> 函数。<code>bar.py</code> 与之前的内容有所不同，多了一个 <code>__name__ == '__main__'</code>，作用是判断当前文件是否直接使用运行而不是被其他模块调用。<code>__name__</code> 是 Python 的内部变量，若值为 <code>__main__</code> 则是被直接运行，相当于其他语言中 <code>mian()</code> 作为程序入口的作用。</p><p><code>import foo</code> 会导入 <code>foo.py</code> 中所有的函数、变量等，如要导入部分内容可以使用 <code>from foo import func</code> 只导入 <code>func()</code> 函数，若要导入多个内容需使用逗号（<code>,</code>）分隔。</p><h2 id="x08-面向对象">0x08 面向对象</h2><p>在 Python 中进行面向对象编程也非常简单。如果你还不熟悉面向对象内容，先看这里 <a href="https://zh.wikipedia.org/wiki/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1" target="_blank" rel="noopener">面向对象程序设计</a>。</p><div class="sourceCode" id="cb40"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1"></a><span class="kw">class</span> Person:</span><span id="cb40-2"><a href="#cb40-2"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, name):</span><span id="cb40-3"><a href="#cb40-3"></a>        <span class="va">self</span>.name <span class="op">=</span> name</span><span id="cb40-4"><a href="#cb40-4"></a></span><span id="cb40-5"><a href="#cb40-5"></a>    <span class="kw">def</span> greet(<span class="va">self</span>):</span><span id="cb40-6"><a href="#cb40-6"></a>        <span class="cf">return</span> <span class="st">&quot;Hello, I&#39;am </span><span class="sc">%s</span><span class="st">&quot;</span> <span class="op">%</span> <span class="va">self</span>.name</span></code></pre></div><p>首先建立一个名为 <code>Person</code> 的类，有两个方法。<code>__init__</code> 方法相当于其他语言中的构造函数，实例化对象时由系统调用。 Python 中使用 <code>self</code> 来访问内部成员，类似其他语言中的 <code>this</code> 指针，实例化之后指向对象本身。这个例子中 <code>__init__</code> 方法有两个参数，第一个是 <code>self</code>，这个参数不能手动指定，调用时由系统添加，第二个是 <code>name</code>，这个参数是需要在实例化时传入。构造函数被调用时将传入的 <code>name</code> 赋值给内部成员 <code>name</code>，这样在内部其他地方也能使用 <code>name</code> 的值。</p><p><code>Person</code> 类还有一个方法 <code>greet</code>，实例化之后调用这个方法会返回一个包含名字的字符串。这里用到了字符串格式化，原本的字符串中的 <code>%s</code> 会被替换成 <code>self.name</code> 的值。可以使用多个值进行字符串格式化，例如 <code>"%s + %s = %s" % (1, 2, 1 + 2)</code> 得到的字符串时 <code>1 + 2 = 3</code>。</p><div class="sourceCode" id="cb41"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&#39;__main__&#39;</span>:</span><span id="cb41-2"><a href="#cb41-2"></a>    alice <span class="op">=</span> Person(<span class="st">&quot;Alice&quot;</span>)</span><span id="cb41-3"><a href="#cb41-3"></a>    <span class="bu">print</span>(alice.greet())</span></code></pre></div><p>实例化一个对象并调用 <code>greet()</code> 方法。</p><div class="sourceCode" id="cb42"><pre class="sourceCode txt"><code class="sourceCode default"><span id="cb42-1"><a href="#cb42-1"></a>Hello, I&#39;am Alice</span></code></pre></div><p>面向对象中少不了类的继承。</p><div class="sourceCode" id="cb43"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1"></a><span class="kw">class</span> Student(Person):</span><span id="cb43-2"><a href="#cb43-2"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, name, grade):</span><span id="cb43-3"><a href="#cb43-3"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>(name)</span><span id="cb43-4"><a href="#cb43-4"></a>        <span class="va">self</span>._grade <span class="op">=</span> grade</span><span id="cb43-5"><a href="#cb43-5"></a></span><span id="cb43-6"><a href="#cb43-6"></a>    <span class="kw">def</span> get_grade(<span class="va">self</span>):</span><span id="cb43-7"><a href="#cb43-7"></a>        <span class="cf">return</span> <span class="va">self</span>._grade</span></code></pre></div><p><code>class Student(Person)</code> 表明 <code>Student</code> 类继承自 <code>Person</code>，在 <code>__init__</code> 中新增了一个 <code>grade</code> 参数，并将它的值配给了内部变量 <code>_grade</code>。以下划线开头的变量和方法是内部成员，无法被外部访问 ，因此增加了 <code>get_grade</code> 方法来获取 <code>_grade</code> 的值。</p><p>千万<strong>别忘了</strong>在 <code>__init__</code> 中调用父类的构造方法。</p><div class="sourceCode" id="cb44"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&#39;__main__&#39;</span>:</span><span id="cb44-2"><a href="#cb44-2"></a>    bob <span class="op">=</span> Student(<span class="st">&quot;Bob&quot;</span>, <span class="dv">90</span>)</span><span id="cb44-3"><a href="#cb44-3"></a>    <span class="bu">print</span>(bob.greet())</span><span id="cb44-4"><a href="#cb44-4"></a>    <span class="bu">print</span>(bob.get_grade())</span></code></pre></div><p>和之前的使用方法相同，直接调用即可。</p><div class="sourceCode" id="cb45"><pre class="sourceCode txt"><code class="sourceCode default"><span id="cb45-1"><a href="#cb45-1"></a>Hello, I&#39;am Bob</span><span id="cb45-2"><a href="#cb45-2"></a>90</span></code></pre></div><h2 id="x09-写在最后">0x09 写在最后</h2><p>这篇文章就到这里结束了。</p><p>如果你花了三十分钟读完本文，相信你已经对 Python 已经有了基本的了解，接下来可以去查阅官方文档了解更深入的内容，或者学习一些 Python 实际应用。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本文旨在快速介绍 Python 的特性帮助读者能够在短时间内了解如何使用 Python， 因此不会有很复杂的内容或者原理性剖析。本文会涉及 Python 基本的语法、操作和简单的面向对象内容，可能会与 C++，Java 中相应内容对比。不过也不用担心，只需要有一些 C 语言编程基础就可以开始阅读本文。&lt;strong&gt;后文给出的所有代码需要在 Python 3 下才能运行。&lt;/strong&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="Python" scheme="https://blog.dreace.top/categories/Python/"/>
    
    
      <category term="Python" scheme="https://blog.dreace.top/tags/Python/"/>
    
      <category term="编程" scheme="https://blog.dreace.top/tags/%E7%BC%96%E7%A8%8B/"/>
    
      <category term="入门" scheme="https://blog.dreace.top/tags/%E5%85%A5%E9%97%A8/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="https://blog.dreace.top/2019/hello-world/"/>
    <id>https://blog.dreace.top/2019/hello-world/</id>
    <published>2019-10-31T16:00:00.000Z</published>
    <updated>2020-08-14T09:53:33.249Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><a id="more"></a><h2 id="quick-start">Quick Start</h2><h3 id="create-a-new-post">Create a new post</h3><div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1"></a>$ <span class="ex">hexo</span> new <span class="st">&quot;My New Post&quot;</span></span></code></pre></div><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="run-server">Run server</h3><div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1"></a>$ <span class="ex">hexo</span> server</span></code></pre></div><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="generate-static-files">Generate static files</h3><div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1"></a>$ <span class="ex">hexo</span> generate</span></code></pre></div><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="deploy-to-remote-sites">Deploy to remote sites</h3><div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1"></a>$ <span class="ex">hexo</span> deploy</span></code></pre></div><p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.io/docs/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;documentation&lt;/a&gt; for more info. If you get any problems when using Hexo, you can find the answer in &lt;a href=&quot;https://hexo.io/docs/troubleshooting.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;troubleshooting&lt;/a&gt; or you can ask me on &lt;a href=&quot;https://github.com/hexojs/hexo/issues&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;GitHub&lt;/a&gt;.&lt;/p&gt;
    
    </summary>
    
    
    
  </entry>
  
</feed>
